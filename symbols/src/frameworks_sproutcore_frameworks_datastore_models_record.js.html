<html><head><meta http-equiv="content-type" content="text/html; charset=utf8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Project:   SproutCore - JavaScript Application Framework</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Copyright: ©2006-2011 Strobe Inc. and contributors.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">//            Portions ©2008-2011 Apple Inc. All rights reserved.</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="COMM">// License:   Licensed under MIT license (see license.js)</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="NAME">sc_require</span><span class="PUNC">(</span><span class="STRN">'system/query'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  9</span> 
<span class='line'> 10</span> </span><span class="COMM">/**
<span class='line'> 11</span>   @class
<span class='line'> 12</span> 
<span class='line'> 13</span>   A Record is the core model class in SproutCore. It is analogous to
<span class='line'> 14</span>   NSManagedObject in Core Data and EOEnterpriseObject in the Enterprise
<span class='line'> 15</span>   Objects Framework (aka WebObjects), or ActiveRecord::Base in Rails.
<span class='line'> 16</span> 
<span class='line'> 17</span>   To create a new model class, in your SproutCore workspace, do:
<span class='line'> 18</span> 
<span class='line'> 19</span>       $ sc-gen model MyApp.MyModel
<span class='line'> 20</span> 
<span class='line'> 21</span>   This will create MyApp.MyModel in clients/my_app/models/my_model.js.
<span class='line'> 22</span> 
<span class='line'> 23</span>   The core attributes hash is used to store the values of a record in a
<span class='line'> 24</span>   format that can be easily passed to/from the server.  The values should
<span class='line'> 25</span>   generally be stored in their raw string form.  References to external
<span class='line'> 26</span>   records should be stored as primary keys.
<span class='line'> 27</span> 
<span class='line'> 28</span>   Normally you do not need to work with the attributes hash directly.
<span class='line'> 29</span>   Instead you should use get/set on normal record properties.  If the
<span class='line'> 30</span>   property is not defined on the object, then the record will check the
<span class='line'> 31</span>   attributes hash instead.
<span class='line'> 32</span> 
<span class='line'> 33</span>   You can bulk update attributes from the server using the
<span class='line'> 34</span>   `updateAttributes()` method.
<span class='line'> 35</span> 
<span class='line'> 36</span>   # Polymorphic Records
<span class='line'> 37</span> 
<span class='line'> 38</span>   SC.Record also supports polymorphism, which allows subclasses of a record type to share a common
<span class='line'> 39</span>   identity. Polymorphism is similar to inheritance (i.e. a polymorphic subclass inherits its parents
<span class='line'> 40</span>   properties), but differs in that polymorphic subclasses can be considered to be "equal" to each
<span class='line'> 41</span>   other and their superclass. This means that any memmber of the polymorphic class group should be
<span class='line'> 42</span>   able to stand in for any other member.
<span class='line'> 43</span> 
<span class='line'> 44</span>   These examples may help identify the difference. First, let's look at the classic inheritance
<span class='line'> 45</span>   model,
<span class='line'> 46</span> 
<span class='line'> 47</span>     // This is the "root" class. All subclasses of MyApp.Person will be unique from MyApp.Person.
<span class='line'> 48</span>     MyApp.Person = SC.Record.extend({});
<span class='line'> 49</span> 
<span class='line'> 50</span>     // As a subclass, MyApp.Female inherits from a MyApp.Person, but is not "equal" to it.
<span class='line'> 51</span>     MyApp.Female = MyApp.Person.extend({
<span class='line'> 52</span>       isFemale: true
<span class='line'> 53</span>     });
<span class='line'> 54</span> 
<span class='line'> 55</span>     // As a subclass, MyApp.Male inherits from a MyApp.Person, but is not "equal" to it.
<span class='line'> 56</span>     MyApp.Male = MyApp.Person.extend({
<span class='line'> 57</span>       isMale: true
<span class='line'> 58</span>     });
<span class='line'> 59</span> 
<span class='line'> 60</span>     // Load two unique records into the store.
<span class='line'> 61</span>     MyApp.store.createRecord(MyApp.Female, { guid: '1' });
<span class='line'> 62</span>     MyApp.store.createRecord(MyApp.Male, { guid: '2' });
<span class='line'> 63</span> 
<span class='line'> 64</span>     // Now we can see that these records are isolated from each other.
<span class='line'> 65</span>     var female = MyApp.store.find(MyApp.Person, '1'); // Returns an SC.Record.EMPTY record.
<span class='line'> 66</span>     var male = MyApp.store.find(MyApp.Person, '2'); // Returns an SC.Record.EMPTY record.
<span class='line'> 67</span> 
<span class='line'> 68</span>     // These records are MyApp.Person only.
<span class='line'> 69</span>     SC.kindOf(female, MyApp.Female); // false
<span class='line'> 70</span>     SC.kindOf(male, MyApp.Male); // false
<span class='line'> 71</span> 
<span class='line'> 72</span>   Next, let's make MyApp.Person a polymorphic class,
<span class='line'> 73</span> 
<span class='line'> 74</span>     // This is the "root" polymorphic class. All subclasses of MyApp.Person will be able to stand-in as a MyApp.Person.
<span class='line'> 75</span>     MyApp.Person = SC.Record.extend({
<span class='line'> 76</span>       isPolymorphic: true
<span class='line'> 77</span>     });
<span class='line'> 78</span> 
<span class='line'> 79</span>     // As a polymorphic subclass, MyApp.Female is "equal" to a MyApp.Person.
<span class='line'> 80</span>     MyApp.Female = MyApp.Person.extend({
<span class='line'> 81</span>       isFemale: true
<span class='line'> 82</span>     });
<span class='line'> 83</span> 
<span class='line'> 84</span>     // As a polymorphic subclass, MyApp.Male is "equal" to a MyApp.Person.
<span class='line'> 85</span>     MyApp.Male = MyApp.Person.extend({
<span class='line'> 86</span>       isMale: true
<span class='line'> 87</span>     });
<span class='line'> 88</span> 
<span class='line'> 89</span>     // Load two unique records into the store.
<span class='line'> 90</span>     MyApp.store.createRecord(MyApp.Female, { guid: '1' });
<span class='line'> 91</span>     MyApp.store.createRecord(MyApp.Male, { guid: '2' });
<span class='line'> 92</span> 
<span class='line'> 93</span>     // Now we can see that these records are in fact "equal" to each other. Which means that if we
<span class='line'> 94</span>     // search for "people", we will get "males" & "females".
<span class='line'> 95</span>     var female = MyApp.store.find(MyApp.Person, '1'); // Returns record.
<span class='line'> 96</span>     var male = MyApp.store.find(MyApp.Person, '2'); // Returns record.
<span class='line'> 97</span> 
<span class='line'> 98</span>     // These records are MyApp.Person as well as their unique subclass.
<span class='line'> 99</span>     SC.kindOf(female, MyApp.Female); // true
<span class='line'>100</span>     SC.kindOf(male, MyApp.Male); // true
<span class='line'>101</span> 
<span class='line'>102</span>   @extends SC.Object
<span class='line'>103</span>   @see SC.RecordAttribute
<span class='line'>104</span>   @since SproutCore 1.0
<span class='line'>105</span> */</span><span class="WHIT">
<span class='line'>106</span> </span><span class="NAME">SC.Record</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Object.extend</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>107</span> </span><span class="COMM">/** @scope SC.Record.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>108</span> 
<span class='line'>109</span> </span><span class="WHIT">  </span><span class="COMM">//@if(debug)</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">  </span><span class="COMM">/* BEGIN DEBUG ONLY PROPERTIES AND METHODS */</span><span class="WHIT">
<span class='line'>111</span> 
<span class='line'>112</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>113</span>     Creates string representation of record, with status.
<span class='line'>114</span> 
<span class='line'>115</span>     @returns {String}
<span class='line'>116</span>   */</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">  </span><span class="NAME">toString</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">    </span><span class="COMM">// We won't use 'readOnlyAttributes' here because accessing them directly</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">    </span><span class="COMM">// avoids a SC.clone() -- we'll be careful not to edit anything.</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">readDataHash</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"%@(%@) %@"</span><span class="PUNC">.</span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="NAME">this.constructor.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.inspect</span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.statusString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>123</span> 
<span class='line'>124</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>125</span>     Creates string representation of record, with status.
<span class='line'>126</span> 
<span class='line'>127</span>     @returns {String}
<span class='line'>128</span>   */</span><span class="WHIT">
<span class='line'>129</span> 
<span class='line'>130</span> </span><span class="WHIT">  </span><span class="NAME">statusString</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">status</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>132</span> 
<span class='line'>133</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">SC.Record</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">prop.match</span><span class="PUNC">(</span><span class="REGX">/[A-Z_]$/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.Record</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">status</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">        </span><span class="NAME">ret.push</span><span class="PUNC">(</span><span class="NAME">prop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>138</span> 
<span class='line'>139</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret.join</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>141</span> 
<span class='line'>142</span> </span><span class="WHIT">  </span><span class="COMM">/* END DEBUG ONLY PROPERTIES AND METHODS */</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT">  </span><span class="COMM">//@endif</span><span class="WHIT">
<span class='line'>144</span> 
<span class='line'>145</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>146</span>     Walk like a duck
<span class='line'>147</span> 
<span class='line'>148</span>     @type Boolean
<span class='line'>149</span>     @default YES
<span class='line'>150</span>   */</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">  </span><span class="NAME">isRecord</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>152</span> 
<span class='line'>153</span> </span><span class="WHIT">  </span><span class="COMM">// ----------------------------------------------------------------------------------------------</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">  </span><span class="COMM">// Properties</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>156</span> 
<span class='line'>157</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>158</span>     Returns the id for the record instance.  The id is used to uniquely
<span class='line'>159</span>     identify this record instance from all others of the same type.  If you
<span class='line'>160</span>     have a `primaryKey set on this class, then the id will be the value of the
<span class='line'>161</span>     `primaryKey` property on the underlying JSON hash.
<span class='line'>162</span> 
<span class='line'>163</span>     @type String
<span class='line'>164</span>     @property
<span class='line'>165</span>     @dependsOn storeKey
<span class='line'>166</span>   */</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">  </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">      </span><span class="NAME">this.writeAttribute</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'primaryKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.Store.idFor</span><span class="PUNC">(</span><span class="NAME">this.storeKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>175</span> 
<span class='line'>176</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>177</span>     If you have nested records
<span class='line'>178</span> 
<span class='line'>179</span>     @type Boolean
<span class='line'>180</span>     @default NO
<span class='line'>181</span>   */</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">  </span><span class="NAME">isParentRecord</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>183</span> 
<span class='line'>184</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>185</span>     This is the primary key used to distinguish records.  If the keys
<span class='line'>186</span>     match, the records are assumed to be identical.
<span class='line'>187</span> 
<span class='line'>188</span>     @type String
<span class='line'>189</span>     @default 'guid'
<span class='line'>190</span>   */</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">  </span><span class="NAME">primaryKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'guid'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>192</span> 
<span class='line'>193</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>194</span>     All records generally have a life cycle as they are created or loaded into
<span class='line'>195</span>     memory, modified, committed and finally destroyed.  This life cycle is
<span class='line'>196</span>     managed by the status property on your record.
<span class='line'>197</span> 
<span class='line'>198</span>     The status of a record is modelled as a finite state machine.  Based on the
<span class='line'>199</span>     current state of the record, you can determine which operations are
<span class='line'>200</span>     currently allowed on the record and which are not.
<span class='line'>201</span> 
<span class='line'>202</span>     In general, a record can be in one of five primary states:
<span class='line'>203</span>     `SC.Record.EMPTY`, `SC.Record.BUSY`, `SC.Record.READY`,
<span class='line'>204</span>     `SC.Record.DESTROYED`, `SC.Record.ERROR`.  These are all described in
<span class='line'>205</span>     more detail in the class mixin (below) where they are defined.
<span class='line'>206</span> 
<span class='line'>207</span>     @type Number
<span class='line'>208</span>     @property
<span class='line'>209</span>     @dependsOn storeKey
<span class='line'>210</span>   */</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">  </span><span class="NAME">status</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.store.readStatus</span><span class="PUNC">(</span><span class="NAME">this.storeKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>214</span> 
<span class='line'>215</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>216</span>     The store that owns this record.  All changes will be buffered into this
<span class='line'>217</span>     store and committed to the rest of the store chain through here.
<span class='line'>218</span> 
<span class='line'>219</span>     This property is set when the record instance is created and should not be
<span class='line'>220</span>     changed or else it will break the record behavior.
<span class='line'>221</span> 
<span class='line'>222</span>     @type SC.Store
<span class='line'>223</span>     @default null
<span class='line'>224</span>   */</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">  </span><span class="NAME">store</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>226</span> 
<span class='line'>227</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>228</span>     This is the store key for the record, it is used to link it back to the
<span class='line'>229</span>     dataHash. If a record is reused, this value will be replaced.
<span class='line'>230</span> 
<span class='line'>231</span>     You should not edit this store key but you may sometimes need to refer to
<span class='line'>232</span>     this store key when implementing a Server object.
<span class='line'>233</span> 
<span class='line'>234</span>     @type Number
<span class='line'>235</span>     @default null
<span class='line'>236</span>   */</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">  </span><span class="NAME">storeKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>238</span> 
<span class='line'>239</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>240</span>     YES when the record has been destroyed
<span class='line'>241</span> 
<span class='line'>242</span>     @type Boolean
<span class='line'>243</span>     @property
<span class='line'>244</span>     @dependsOn status
<span class='line'>245</span>   */</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">  </span><span class="NAME">isDestroyed</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">SC.Record.DESTROYED</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>249</span> 
<span class='line'>250</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>251</span>     `YES` when the record is in an editable state.  You can use this property to
<span class='line'>252</span>     quickly determine whether attempting to modify the record would raise an
<span class='line'>253</span>     exception or not.
<span class='line'>254</span> 
<span class='line'>255</span>     This property is both readable and writable.  Note however that if you
<span class='line'>256</span>     set this property to `YES` but the status of the record is anything but
<span class='line'>257</span>     `SC.Record.READY`, the return value of this property may remain `NO`.
<span class='line'>258</span> 
<span class='line'>259</span>     @type Boolean
<span class='line'>260</span>     @property
<span class='line'>261</span>     @dependsOn status
<span class='line'>262</span>   */</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">  </span><span class="NAME">isEditable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._screc_isEditable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">SC.Record.READY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._screc_isEditable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>268</span> 
<span class='line'>269</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>270</span>     @private
<span class='line'>271</span> 
<span class='line'>272</span>     Backing value for isEditable
<span class='line'>273</span>   */</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">  </span><span class="NAME">_screc_isEditable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// default</span><span class="WHIT">
<span class='line'>275</span> 
<span class='line'>276</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>277</span>     `YES` when the record's contents have been loaded for the first time.  You
<span class='line'>278</span>     can use this to quickly determine if the record is ready to display.
<span class='line'>279</span> 
<span class='line'>280</span>     @type Boolean
<span class='line'>281</span>     @property
<span class='line'>282</span>     @dependsOn status
<span class='line'>283</span>   */</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">  </span><span class="NAME">isLoaded</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">K</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Record</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">        </span><span class="NAME">status</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">status</span><span class="PUNC">===</span><span class="NAME">K.EMPTY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">status</span><span class="PUNC">===</span><span class="NAME">K.BUSY_LOADING</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">status</span><span class="PUNC">===</span><span class="NAME">K.ERROR</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>289</span> 
<span class='line'>290</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>291</span>     If set, this should be an array of active relationship objects that need
<span class='line'>292</span>     to be notified whenever the underlying record properties change.
<span class='line'>293</span>     Currently this is only used by toMany relationships, but you could
<span class='line'>294</span>     possibly patch into this yourself also if you are building your own
<span class='line'>295</span>     relationships.
<span class='line'>296</span> 
<span class='line'>297</span>     Note this must be a regular Array - NOT any object implementing SC.Array.
<span class='line'>298</span> 
<span class='line'>299</span>     @type Array
<span class='line'>300</span>     @default null
<span class='line'>301</span>   */</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">  </span><span class="NAME">relationships</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>303</span> 
<span class='line'>304</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>305</span>     This will return the raw attributes that you can edit directly.  If you
<span class='line'>306</span>     make changes to this hash, be sure to call `beginEditing()` before you get
<span class='line'>307</span>     the attributes and `endEditing()` afterwards.
<span class='line'>308</span> 
<span class='line'>309</span>     @type Hash
<span class='line'>310</span>     @property
<span class='line'>311</span>   **/</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">  </span><span class="NAME">attributes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">        </span><span class="NAME">storeKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.storeKey</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">store.readEditableDataHash</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>317</span> 
<span class='line'>318</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>319</span>     This will return the raw attributes that you cannot edit directly.  It is
<span class='line'>320</span>     useful if you want to efficiently look at multiple attributes in bulk.  If
<span class='line'>321</span>     you would like to edit the attributes, see the `attributes` property
<span class='line'>322</span>     instead.
<span class='line'>323</span> 
<span class='line'>324</span>     @type Hash
<span class='line'>325</span>     @property
<span class='line'>326</span>   **/</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">  </span><span class="NAME">readOnlyAttributes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">        </span><span class="NAME">storeKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.storeKey</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.readDataHash</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>331</span> 
<span class='line'>332</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.clone</span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>333</span> 
<span class='line'>334</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>336</span> 
<span class='line'>337</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>338</span>     The namespace which to retrieve the childRecord Types from
<span class='line'>339</span> 
<span class='line'>340</span>     @type String
<span class='line'>341</span>     @default null
<span class='line'>342</span>   */</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">  </span><span class="NAME">nestedRecordNamespace</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>344</span> 
<span class='line'>345</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>346</span>     Whether or not this is a nested Record.
<span class='line'>347</span> 
<span class='line'>348</span>     @type Boolean
<span class='line'>349</span>     @property
<span class='line'>350</span>   */</span><span class="WHIT">
<span class='line'>351</span> </span><span class="WHIT">  </span><span class="NAME">isNestedRecord</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>352</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">        </span><span class="NAME">sk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">        </span><span class="NAME">prKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.parentStoreKeyExists</span><span class="PUNC">(</span><span class="NAME">sk</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>355</span> 
<span class='line'>356</span> </span><span class="WHIT">    </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prKey</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>359</span> 
<span class='line'>360</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>361</span>     The parent record if this is a nested record.
<span class='line'>362</span> 
<span class='line'>363</span>     @type Boolean
<span class='line'>364</span>     @property
<span class='line'>365</span>   */</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">  </span><span class="NAME">parentRecord</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.storeKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">store.materializeParentRecord</span><span class="PUNC">(</span><span class="NAME">sk</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>370</span> 
<span class='line'>371</span> </span><span class="WHIT">  </span><span class="COMM">// ...............................</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">  </span><span class="COMM">// CRUD OPERATIONS</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>374</span> 
<span class='line'>375</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>376</span>     Refresh the record from the persistent store.  If the record was loaded
<span class='line'>377</span>     from a persistent store, then the store will be asked to reload the
<span class='line'>378</span>     record data from the server.  If the record is new and exists only in
<span class='line'>379</span>     memory then this call will have no effect.
<span class='line'>380</span> 
<span class='line'>381</span>     @param {boolean} recordOnly optional param if you want to only THIS record
<span class='line'>382</span>       even if it is a child record.
<span class='line'>383</span>     @param {Function} callback optional callback that will fire when request finishes
<span class='line'>384</span> 
<span class='line'>385</span>     @returns {SC.Record} receiver
<span class='line'>386</span>   */</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">  </span><span class="NAME">refresh</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">recordOnly</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ro</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">        </span><span class="NAME">sk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">        </span><span class="NAME">prKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.parentStoreKeyExists</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>391</span> 
<span class='line'>392</span> </span><span class="WHIT">    </span><span class="COMM">// If we only want to commit this record or it doesn't have a parent record</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">    </span><span class="COMM">// we will commit this record</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">    </span><span class="NAME">ro</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">recordOnly</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">recordOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ro</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">      </span><span class="NAME">store.refreshRecord</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">      </span><span class="NAME">rec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.materializeRecord</span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">      </span><span class="NAME">rec.refresh</span><span class="PUNC">(</span><span class="NAME">recordOnly</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>401</span> 
<span class='line'>402</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>404</span> 
<span class='line'>405</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>406</span>     Deletes the record along with any dependent records.  This will mark the
<span class='line'>407</span>     records destroyed in the store as well as changing the isDestroyed
<span class='line'>408</span>     property on the record to YES.  If this is a new record, this will avoid
<span class='line'>409</span>     creating the record in the first place.
<span class='line'>410</span> 
<span class='line'>411</span>     @param {boolean} recordOnly optional param if you want to only THIS record
<span class='line'>412</span>       even if it is a child record.
<span class='line'>413</span> 
<span class='line'>414</span>     @returns {SC.Record} receiver
<span class='line'>415</span>   */</span><span class="WHIT">
<span class='line'>416</span> </span><span class="WHIT">  </span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">recordOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ro</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>418</span> </span><span class="WHIT">        </span><span class="NAME">sk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">        </span><span class="NAME">prKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.parentStoreKeyExists</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>420</span> 
<span class='line'>421</span> </span><span class="WHIT">    </span><span class="COMM">// If we only want to commit this record or it doesn't have a parent record</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">    </span><span class="COMM">// we will commit this record</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">    </span><span class="NAME">ro</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">recordOnly</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">recordOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ro</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">      </span><span class="NAME">store.destroyRecord</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sk</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">      </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">      </span><span class="COMM">// If there are any aggregate records, we might need to propagate our new</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">      </span><span class="COMM">// status to them.</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">      </span><span class="NAME">this.propagateToAggregates</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>430</span> 
<span class='line'>431</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">      </span><span class="NAME">rec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.materializeRecord</span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">      </span><span class="NAME">rec.destroy</span><span class="PUNC">(</span><span class="NAME">recordOnly</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>435</span> 
<span class='line'>436</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>438</span> 
<span class='line'>439</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>440</span>     You can invoke this method anytime you need to make the record as dirty.
<span class='line'>441</span>     This will cause the record to be committed when you `commitChanges()`
<span class='line'>442</span>     on the underlying store.
<span class='line'>443</span> 
<span class='line'>444</span>     If you use the `writeAttribute()` primitive, this method will be called
<span class='line'>445</span>     for you.
<span class='line'>446</span> 
<span class='line'>447</span>     If you pass the key that changed it will ensure that observers are fired
<span class='line'>448</span>     only once for the changed property instead of `allPropertiesDidChange()`
<span class='line'>449</span> 
<span class='line'>450</span>     @param {String} key key that changed (optional)
<span class='line'>451</span>     @returns {SC.Record} receiver
<span class='line'>452</span>   */</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">  </span><span class="NAME">recordDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>454</span> 
<span class='line'>455</span> </span><span class="WHIT">    </span><span class="COMM">// If we have a parent, they changed too!</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'parentRecord'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">p.recordDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>458</span> 
<span class='line'>459</span> </span><span class="WHIT">    </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">recordDidChange</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>460</span> </span><span class="WHIT">    </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>461</span> 
<span class='line'>462</span> </span><span class="WHIT">    </span><span class="COMM">// If there are any aggregate records, we might need to propagate our new</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">    </span><span class="COMM">// status to them.</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">    </span><span class="NAME">this.propagateToAggregates</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>465</span> 
<span class='line'>466</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>468</span> 
<span class='line'>469</span> </span><span class="WHIT">  </span><span class="NAME">toJSON</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>470</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'attributes'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>471</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>472</span> 
<span class='line'>473</span> </span><span class="WHIT">  </span><span class="COMM">// ...............................</span><span class="WHIT">
<span class='line'>474</span> </span><span class="WHIT">  </span><span class="COMM">// ATTRIBUTES</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>476</span> 
<span class='line'>477</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>478</span>     Current edit level.  Used to defer editing changes.
<span class='line'>479</span>   */</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">  </span><span class="NAME">_editLevel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>481</span> 
<span class='line'>482</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>483</span>     Defers notification of record changes until you call a matching
<span class='line'>484</span>     `endEditing()` method.  This method is called automatically whenever you
<span class='line'>485</span>     set an attribute, but you can call it yourself to group multiple changes.
<span class='line'>486</span> 
<span class='line'>487</span>     Calls to `beginEditing()` and `endEditing()` can be nested.
<span class='line'>488</span> 
<span class='line'>489</span>     @returns {SC.Record} receiver
<span class='line'>490</span>   */</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">  </span><span class="NAME">beginEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">    </span><span class="NAME">this._editLevel</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>495</span> 
<span class='line'>496</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>497</span>     Notifies the store of record changes if this matches a top level call to
<span class='line'>498</span>     `beginEditing()`.  This method is called automatically whenever you set an
<span class='line'>499</span>     attribute, but you can call it yourself to group multiple changes.
<span class='line'>500</span> 
<span class='line'>501</span>     Calls to `beginEditing()` and `endEditing()` can be nested.
<span class='line'>502</span> 
<span class='line'>503</span>     @param {String} key key that changed (optional)
<span class='line'>504</span>     @returns {SC.Record} receiver
<span class='line'>505</span>   */</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">  </span><span class="NAME">endEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">this._editLevel</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">      </span><span class="NAME">this._editLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">      </span><span class="NAME">this.recordDidChange</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>513</span> 
<span class='line'>514</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>515</span>     Reads the raw attribute from the underlying data hash.  This method does
<span class='line'>516</span>     not transform the underlying attribute at all.
<span class='line'>517</span> 
<span class='line'>518</span>     @param {String} key the attribute you want to read
<span class='line'>519</span>     @returns {Object} the value of the key, or undefined if it doesn't exist
<span class='line'>520</span>   */</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">  </span><span class="NAME">readAttribute</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">storeKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.storeKey</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.readDataHash</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>526</span> 
<span class='line'>527</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>528</span>     Updates the passed attribute with the new value.  This method does not
<span class='line'>529</span>     transform the value at all.  If instead you want to modify an array or
<span class='line'>530</span>     hash already defined on the underlying json, you should instead get
<span class='line'>531</span>     an editable version of the attribute using `editableAttribute()`.
<span class='line'>532</span> 
<span class='line'>533</span>     @param {String} key the attribute you want to read
<span class='line'>534</span>     @param {Object} value the value you want to write
<span class='line'>535</span>     @param {Boolean} ignoreDidChange only set if you do NOT want to flag
<span class='line'>536</span>       record as dirty
<span class='line'>537</span>     @returns {SC.Record} receiver
<span class='line'>538</span>   */</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">  </span><span class="NAME">writeAttribute</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreDidChange</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">        </span><span class="NAME">storeKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.storeKey</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">        </span><span class="NAME">attrs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>543</span> 
<span class='line'>544</span> </span><span class="WHIT">    </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.readEditableDataHash</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">SC.Record.BAD_STATE_ERROR</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>546</span> 
<span class='line'>547</span> </span><span class="WHIT">    </span><span class="COMM">// if value is the same, do not flag record as dirty</span><span class="WHIT">
<span class='line'>548</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>549</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ignoreDidChange</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.beginEditing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">      </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>551</span> 
<span class='line'>552</span> </span><span class="WHIT">      </span><span class="COMM">// If the key is the primaryKey of the record, we need to tell the store</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">      </span><span class="COMM">// about the change.</span><span class="WHIT">
<span class='line'>554</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'primaryKey'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>555</span> </span><span class="WHIT">        </span><span class="NAME">SC.Store.replaceIdFor</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>556</span> </span><span class="WHIT">        </span><span class="NAME">this.propertyDidChange</span><span class="PUNC">(</span><span class="STRN">'id'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Reset computed value</span><span class="WHIT">
<span class='line'>557</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>558</span> 
<span class='line'>559</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ignoreDidChange</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this.endEditing</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>560</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">        </span><span class="COMM">// We must still inform the store of the change so that it can track the change across stores.</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">        </span><span class="NAME">store.dataHashDidChange</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>567</span> 
<span class='line'>568</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>569</span>     This will also ensure that any aggregate records are also marked dirty
<span class='line'>570</span>     if this record changes.
<span class='line'>571</span> 
<span class='line'>572</span>     Should not have to be called manually.
<span class='line'>573</span>   */</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">  </span><span class="NAME">propagateToAggregates</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>575</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">storeKey</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>576</span> </span><span class="WHIT">        </span><span class="NAME">recordType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Store.recordTypeFor</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>577</span> </span><span class="WHIT">        </span><span class="NAME">aggregates</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">recordType.__sc_aggregate_keys</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">        </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>579</span> 
<span class='line'>580</span> </span><span class="WHIT">    </span><span class="COMM">// if recordType aggregates are not set up yet, make sure to</span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">    </span><span class="COMM">// create the cache first</span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">aggregates</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">      </span><span class="NAME">aggregates</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">        </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prop</span><span class="WHIT">  </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">prop.isRecordAttribute</span><span class="WHIT">  </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">prop.aggregate</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">          </span><span class="NAME">aggregates.push</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">      </span><span class="NAME">recordType.__sc_aggregate_keys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aggregates</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>592</span> 
<span class='line'>593</span> </span><span class="WHIT">    </span><span class="COMM">// now loop through all aggregate properties and mark their related</span><span class="WHIT">
<span class='line'>594</span> </span><span class="WHIT">    </span><span class="COMM">// record objects as dirty</span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">K</span><span class="WHIT">          </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Record</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">        </span><span class="NAME">dirty</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">K.DIRTY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">        </span><span class="NAME">readyNew</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">K.READY_NEW</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">        </span><span class="NAME">destroyed</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">K.DESTROYED</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">        </span><span class="NAME">readyClean</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">K.READY_CLEAN</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">        </span><span class="NAME">iter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>601</span> 
<span class='line'>602</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>603</span>       @private
<span class='line'>604</span> 
<span class='line'>605</span>       If the child is dirty, then make sure the parent gets a dirty
<span class='line'>606</span>       status.  (If the child is created or destroyed, there's no need,
<span class='line'>607</span>       because the parent will dirty itself when it modifies that
<span class='line'>608</span>       relationship.)
<span class='line'>609</span> 
<span class='line'>610</span>       @param {SC.Record} record to propagate to
<span class='line'>611</span>     */</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">    </span><span class="NAME">iter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">childStatus</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentStore</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentStoreKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentStatus</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>614</span> 
<span class='line'>615</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">        </span><span class="NAME">childStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">childStatus</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">dirty</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">childStatus</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">readyNew</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT">  </span><span class="PUNC">(</span><span class="NAME">childStatus</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">destroyed</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>619</span> 
<span class='line'>620</span> </span><span class="WHIT">          </span><span class="COMM">// Since the parent can cache 'status', and we might be called before</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">          </span><span class="COMM">// it has been invalidated, we'll read the status directly rather than</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">          </span><span class="COMM">// trusting the cache.</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">          </span><span class="NAME">parentStore</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rec.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">          </span><span class="NAME">parentStoreKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rec.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">          </span><span class="NAME">parentStatus</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parentStore.peekStatus</span><span class="PUNC">(</span><span class="NAME">parentStoreKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parentStatus</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">readyClean</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">            </span><span class="COMM">// Note:  storeDidChangeProperties() won't put it in the</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">            </span><span class="COMM">//        changelog!</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">            </span><span class="NAME">rec.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">recordDidChange</span><span class="PUNC">(</span><span class="NAME">rec.constructor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rec.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>634</span> 
<span class='line'>635</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">aggregates.length</span><span class="PUNC">;</span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">      </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aggregates</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">      </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">      </span><span class="NAME">recs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.kindOf</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.ManyArray</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">val</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">      </span><span class="NAME">recs.forEach</span><span class="PUNC">(</span><span class="NAME">iter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>642</span> 
<span class='line'>643</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>644</span>     Called by the store whenever the underlying data hash has changed.  This
<span class='line'>645</span>     will notify any observers interested in data hash properties that they
<span class='line'>646</span>     have changed.
<span class='line'>647</span> 
<span class='line'>648</span>     @param {Boolean} statusOnly changed
<span class='line'>649</span>     @param {String} key that changed (optional)
<span class='line'>650</span>     @returns {SC.Record} receiver
<span class='line'>651</span>   */</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">  </span><span class="NAME">storeDidChangeProperties</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">statusOnly</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">    </span><span class="COMM">// TODO:  Should this function call propagateToAggregates() at the</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">    </span><span class="COMM">//        appropriate times?</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">statusOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keys</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">        </span><span class="NAME">this.beginPropertyChanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">        </span><span class="NAME">keys.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">        </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>661</span> </span><span class="WHIT">        </span><span class="NAME">this.endPropertyChanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>662</span> 
<span class='line'>663</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">        </span><span class="NAME">this.allPropertiesDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>666</span> 
<span class='line'>667</span> </span><span class="WHIT">      </span><span class="COMM">// also notify manyArrays</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">manyArrays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.relationships</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">          </span><span class="NAME">loc</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">manyArrays</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">manyArrays.length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">      </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">loc</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">manyArrays</span><span class="PUNC">[</span><span class="NAME">loc</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">recordPropertyDidChange</span><span class="PUNC">(</span><span class="NAME">keys</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>673</span> 
<span class='line'>674</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>675</span>     Normalizing a record will ensure that the underlying hash conforms
<span class='line'>676</span>     to the record attributes such as their types (transforms) and default
<span class='line'>677</span>     values.
<span class='line'>678</span> 
<span class='line'>679</span>     This method will write the conforming hash to the store and return
<span class='line'>680</span>     the materialized record.
<span class='line'>681</span> 
<span class='line'>682</span>     By normalizing the record, you can use `.attributes()` and be
<span class='line'>683</span>     assured that it will conform to the defined model. For example, this
<span class='line'>684</span>     can be useful in the case where you need to send a JSON representation
<span class='line'>685</span>     to some server after you have used `.createRecord()`, since this method
<span class='line'>686</span>     will enforce the 'rules' in the model such as their types and default
<span class='line'>687</span>     values. You can also include null values in the hash with the
<span class='line'>688</span>     includeNull argument.
<span class='line'>689</span> 
<span class='line'>690</span>     @param {Boolean} includeNull will write empty (null) attributes
<span class='line'>691</span>     @returns {SC.Record} the normalized record
<span class='line'>692</span>   */</span><span class="WHIT">
<span class='line'>693</span> 
<span class='line'>694</span> </span><span class="WHIT">  </span><span class="NAME">normalize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">includeNull</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">primaryKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.primaryKey</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">        </span><span class="NAME">store</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">        </span><span class="NAME">storeKey</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">        </span><span class="NAME">keysToKeep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">        </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">valueForKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">typeClass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recHash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isRecord</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">        </span><span class="NAME">isChild</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaultVal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">keyForDataHash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>701</span> 
<span class='line'>702</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataHash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.readEditableDataHash</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">    </span><span class="NAME">recHash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.readDataHash</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>704</span> 
<span class='line'>705</span> </span><span class="WHIT">    </span><span class="COMM">// For now we're going to be agnostic about whether ids should live in the</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">    </span><span class="COMM">// hash or not.</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">    </span><span class="NAME">keysToKeep</span><span class="PUNC">[</span><span class="NAME">primaryKey</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>708</span> 
<span class='line'>709</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">      </span><span class="COMM">// make sure property is a record attribute.</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">      </span><span class="NAME">valueForKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>712</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueForKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">        </span><span class="NAME">typeClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">valueForKey.typeClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>714</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">typeClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>715</span> </span><span class="WHIT">          </span><span class="NAME">keyForDataHash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">valueForKey.get</span><span class="PUNC">(</span><span class="STRN">'key'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// handle alt keys</span><span class="WHIT">
<span class='line'>716</span> 
<span class='line'>717</span> </span><span class="WHIT">          </span><span class="COMM">// As we go, we'll build up a key —> attribute mapping table that we</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">          </span><span class="COMM">// can use when purging keys from the data hash that are not defined</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">          </span><span class="COMM">// in the schema, below.</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">          </span><span class="NAME">keysToKeep</span><span class="PUNC">[</span><span class="NAME">keyForDataHash</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span> 
<span class='line'>722</span> </span><span class="WHIT">          </span><span class="NAME">isRecord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">typeClass.call</span><span class="PUNC">(</span><span class="NAME">valueForKey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NAME">SC.T_CLASS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">          </span><span class="NAME">isChild</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">valueForKey.isNestedRecordTransform</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>724</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isRecord</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isChild</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>725</span> </span><span class="WHIT">            </span><span class="NAME">attrValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>726</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">attrValue</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attrValue</span><span class="PUNC">!==</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">includeNull</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">              </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">              </span><span class="COMM">// if record attribute, make sure we transform with the fromType</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">SC.kindOf</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.RecordAttribute</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>730</span> </span><span class="WHIT">                </span><span class="NAME">attrValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attr.fromType</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">              </span><span class="NAME">dataHash</span><span class="PUNC">[</span><span class="NAME">keyForDataHash</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attrValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">includeNull</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">              </span><span class="NAME">keysToKeep</span><span class="PUNC">[</span><span class="NAME">keyForDataHash</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>737</span> 
<span class='line'>738</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isChild</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">            </span><span class="NAME">attrValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>740</span> 
<span class='line'>741</span> </span><span class="WHIT">            </span><span class="COMM">// Sometimes a child attribute property does not refer to a child record.</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">            </span><span class="COMM">// Catch this and don't try to normalize.</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attrValue</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">attrValue.normalize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">              </span><span class="NAME">attrValue.normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isRecord</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">            </span><span class="NAME">attrValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">recHash</span><span class="PUNC">[</span><span class="NAME">keyForDataHash</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attrValue</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">              </span><span class="COMM">// write value already there</span><span class="WHIT">
<span class='line'>750</span> </span><span class="WHIT">              </span><span class="NAME">dataHash</span><span class="PUNC">[</span><span class="NAME">keyForDataHash</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attrValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">              </span><span class="COMM">// or write default</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">              </span><span class="NAME">defaultVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">valueForKey.get</span><span class="PUNC">(</span><span class="STRN">'defaultValue'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>754</span> 
<span class='line'>755</span> </span><span class="WHIT">              </span><span class="COMM">// computed default value</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">defaultVal</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NAME">SC.T_FUNCTION</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">                </span><span class="NAME">dataHash</span><span class="PUNC">[</span><span class="NAME">keyForDataHash</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">defaultVal</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaultVal</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">                </span><span class="COMM">// plain value</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">                </span><span class="NAME">dataHash</span><span class="PUNC">[</span><span class="NAME">keyForDataHash</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">defaultVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>767</span> 
<span class='line'>768</span> </span><span class="WHIT">    </span><span class="COMM">// Finally, we'll go through the underlying data hash and remove anything</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">    </span><span class="COMM">// for which no appropriate attribute is defined.  We can do this using</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">    </span><span class="COMM">// the mapping table we prepared above.</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">dataHash</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">keysToKeep</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">        </span><span class="COMM">// Deleting a key doesn't seem too common unless it's a mistake, so</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">        </span><span class="COMM">// we'll log it in debug mode.</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">        </span><span class="NAME">SC.debug</span><span class="PUNC">(</span><span class="STRN">"%@:  Deleting key from underlying data hash due to normalization:  %@"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">        </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">dataHash</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>779</span> 
<span class='line'>780</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>782</span> 
<span class='line'>783</span> 
<span class='line'>784</span> 
<span class='line'>785</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>786</span>     If you try to get/set a property not defined by the record, then this
<span class='line'>787</span>     method will be called. It will try to get the value from the set of
<span class='line'>788</span>     attributes.
<span class='line'>789</span> 
<span class='line'>790</span>     This will also check is `ignoreUnknownProperties` is set on the recordType
<span class='line'>791</span>     so that they will not be written to `dataHash` unless explicitly defined
<span class='line'>792</span>     in the model schema.
<span class='line'>793</span> 
<span class='line'>794</span>     @param {String} key the attribute being get/set
<span class='line'>795</span>     @param {Object} value the value to set the key to, if present
<span class='line'>796</span>     @returns {Object} the value
<span class='line'>797</span>   */</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">  </span><span class="NAME">unknownProperty</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>799</span> 
<span class='line'>800</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>801</span> 
<span class='line'>802</span> </span><span class="WHIT">      </span><span class="COMM">// first check if we should ignore unknown properties for this</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">      </span><span class="COMM">// recordType</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">storeKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">        </span><span class="NAME">recordType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Store.recordTypeFor</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>806</span> 
<span class='line'>807</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">recordType.ignoreUnknownProperties</span><span class="PUNC">===</span><span class="NAME">YES</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">        </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>811</span> 
<span class='line'>812</span> </span><span class="WHIT">      </span><span class="COMM">// if we're modifying the PKEY, then `SC.Store` needs to relocate where</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">      </span><span class="COMM">// this record is cached. store the old key, update the value, then let</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">      </span><span class="COMM">// the store do the housekeeping...</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">primaryKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'primaryKey'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">      </span><span class="NAME">this.writeAttribute</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>817</span> 
<span class='line'>818</span> </span><span class="WHIT">      </span><span class="COMM">// update ID if needed</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">primaryKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">        </span><span class="NAME">SC.Store.replaceIdFor</span><span class="PUNC">(</span><span class="NAME">storeKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>822</span> 
<span class='line'>823</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.readAttribute</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>826</span> 
<span class='line'>827</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>828</span>     Lets you commit this specific record to the store which will trigger
<span class='line'>829</span>     the appropriate methods in the data source for you.
<span class='line'>830</span> 
<span class='line'>831</span>     @param {Hash} params optional additional params that will passed down
<span class='line'>832</span>       to the data source
<span class='line'>833</span>     @param {boolean} recordOnly optional param if you want to only commit a single
<span class='line'>834</span>       record if it has a parent.
<span class='line'>835</span>     @param {Function} callback optional callback that the store will fire once the
<span class='line'>836</span>     datasource finished committing
<span class='line'>837</span>     @returns {SC.Record} receiver
<span class='line'>838</span>   */</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">  </span><span class="NAME">commitRecord</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recordOnly</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ro</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">        </span><span class="NAME">prKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.parentStoreKeyExists</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>842</span> 
<span class='line'>843</span> </span><span class="WHIT">    </span><span class="COMM">// If we only want to commit this record or it doesn't have a parent record</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">    </span><span class="COMM">// we will commit this record</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">    </span><span class="NAME">ro</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">recordOnly</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">recordOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ro</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">      </span><span class="NAME">store.commitRecord</span><span class="PUNC">(</span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">      </span><span class="NAME">rec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.materializeRecord</span><span class="PUNC">(</span><span class="NAME">prKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">      </span><span class="NAME">rec.commitRecord</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recordOnly</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>852</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>854</span> 
<span class='line'>855</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">  </span><span class="COMM">// EMULATE SC.ERROR API</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>858</span> 
<span class='line'>859</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>860</span>     Returns `YES` whenever the status is SC.Record.ERROR.  This will allow you
<span class='line'>861</span>     to put the UI into an error state.
<span class='line'>862</span> 
<span class='line'>863</span>     @type Boolean
<span class='line'>864</span>     @property
<span class='line'>865</span>     @dependsOn status
<span class='line'>866</span>   */</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">  </span><span class="NAME">isError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">SC.Record.ERROR</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'status'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>870</span> 
<span class='line'>871</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>872</span>     Returns the receiver if the record is in an error state.  Returns null
<span class='line'>873</span>     otherwise.
<span class='line'>874</span> 
<span class='line'>875</span>     @type SC.Record
<span class='line'>876</span>     @property
<span class='line'>877</span>     @dependsOn isError
<span class='line'>878</span>   */</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">  </span><span class="NAME">errorValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isError'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.val</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'errorObject'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'isError'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>882</span> 
<span class='line'>883</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>884</span>     Returns the current error object only if the record is in an error state.
<span class='line'>885</span>     If no explicit error object has been set, returns SC.Record.GENERIC_ERROR.
<span class='line'>886</span> 
<span class='line'>887</span>     @type SC.Error
<span class='line'>888</span>     @property
<span class='line'>889</span>     @dependsOn isError
<span class='line'>890</span>   */</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">  </span><span class="NAME">errorObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isError'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">store.readError</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">SC.Record.GENERIC_ERROR</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'isError'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>897</span> 
<span class='line'>898</span> </span><span class="WHIT">  </span><span class="COMM">// ...............................</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">  </span><span class="COMM">// PRIVATE</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>901</span> 
<span class='line'>902</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>903</span>     Sets the key equal to value.
<span class='line'>904</span> 
<span class='line'>905</span>     This version will first check to see if the property is an
<span class='line'>906</span>     `SC.RecordAttribute`, and if so, will ensure that its isEditable property
<span class='line'>907</span>     is `YES` before attempting to change the value.
<span class='line'>908</span> 
<span class='line'>909</span>     @param key {String} the property to set
<span class='line'>910</span>     @param value {Object} the value to set or null.
<span class='line'>911</span>     @returns {SC.Record}
<span class='line'>912</span>   */</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">  </span><span class="NAME">set</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>915</span> 
<span class='line'>916</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">func.isProperty</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">func.get</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">func.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sc_super</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>921</span> 
<span class='line'>922</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>923</span>     Registers a child record with this parent record.
<span class='line'>924</span> 
<span class='line'>925</span>     If the parent already knows about the child record, return the cached
<span class='line'>926</span>     instance. If not, create the child record instance and add it to the child
<span class='line'>927</span>     record cache.
<span class='line'>928</span> 
<span class='line'>929</span>     @param {Hash} value The hash of attributes to apply to the child record.
<span class='line'>930</span>     @param {Integer} key The store key that we are asking for
<span class='line'>931</span>     @param {String} path The property path of the child record
<span class='line'>932</span>     @returns {SC.Record} the child record that was registered
<span class='line'>933</span>    */</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">  </span><span class="NAME">registerNestedRecord</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">psk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">csk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">childRecord</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recordType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>936</span> 
<span class='line'>937</span> </span><span class="WHIT">    </span><span class="COMM">// if no path is entered it must be the key</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">    </span><span class="COMM">// if a record instance is passed, simply use the storeKey.  This allows</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">    </span><span class="COMM">// you to pass a record from a chained store to get the same record in the</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">    </span><span class="COMM">// current store.</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">value.get</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">value.get</span><span class="PUNC">(</span><span class="STRN">'isRecord'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">      </span><span class="NAME">childRecord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">      </span><span class="NAME">recordType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._materializeNestedRecordType</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">      </span><span class="NAME">childRecord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createNestedRecord</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">psk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">childRecord</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">      </span><span class="NAME">this.isParentRecord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">      </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">      </span><span class="NAME">csk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">childRecord.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">      </span><span class="NAME">store.registerChildToParent</span><span class="PUNC">(</span><span class="NAME">psk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">csk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>955</span> 
<span class='line'>956</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">childRecord</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>958</span> 
<span class='line'>959</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>960</span>     Unregisters a child record from its parent record.
<span class='line'>961</span> 
<span class='line'>962</span>     Since accessing a child (nested) record creates a new data hash for the
<span class='line'>963</span>     child and caches the child record and its relationship to the parent record,
<span class='line'>964</span>     it's important to clear those caches when the child record is overwritten
<span class='line'>965</span>     or removed.  This function tells the store to remove the child record from
<span class='line'>966</span>     the store's various child record caches.
<span class='line'>967</span> 
<span class='line'>968</span>     You should not need to call this function directly.  Simply setting the
<span class='line'>969</span>     child record property on the parent to a different value will cause the
<span class='line'>970</span>     previous child record to be unregistered.
<span class='line'>971</span> 
<span class='line'>972</span>     @param {String} path The property path of the child record.
<span class='line'>973</span>   */</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">  </span><span class="NAME">unregisterNestedRecord</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">childRecord</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">csk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">store</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>976</span> 
<span class='line'>977</span> </span><span class="WHIT">    </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">    </span><span class="NAME">childRecord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getPath</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">    </span><span class="NAME">csk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">childRecord.get</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">    </span><span class="NAME">store.unregisterChildFromParent</span><span class="PUNC">(</span><span class="NAME">csk</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>982</span> 
<span class='line'>983</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>984</span>     @private
<span class='line'>985</span> 
<span class='line'>986</span>      private method that retrieves the `recordType` from the hash that is
<span class='line'>987</span>      provided.
<span class='line'>988</span> 
<span class='line'>989</span>      Important for use in polymorphism but you must have the following items
<span class='line'>990</span>      in the parent record:
<span class='line'>991</span> 
<span class='line'>992</span>      `nestedRecordNamespace` &lt;= this is the object that has the `SC.Records`
<span class='line'>993</span>      defined
<span class='line'>994</span> 
<span class='line'>995</span>      @param {Hash} value The hash of attributes to apply to the child record.
<span class='line'>996</span>      @param {String} key the name of the key on the attribute
<span class='line'>997</span>      @param {SC.Record} the record that was materialized
<span class='line'>998</span>     */</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">  </span><span class="NAME">_materializeNestedRecordType</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">childNS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recordType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1001</span> 
<span class='line'>1002</span> </span><span class="WHIT">    </span><span class="COMM">// Get the record type, first checking the "type" property on the hash.</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_HASH</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">      </span><span class="COMM">// Get the record type.</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">      </span><span class="NAME">childNS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nestedRecordNamespace'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value.type</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">childNS</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">        </span><span class="NAME">recordType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">childNS</span><span class="PUNC">[</span><span class="NAME">value.type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1010</span> 
<span class='line'>1011</span> </span><span class="WHIT">    </span><span class="COMM">// Maybe it's not a hash or there was no type property.</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">recordType</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">      </span><span class="NAME">recordType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">get</span><span class="PUNC">(</span><span class="STRN">'typeClass'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1015</span> 
<span class='line'>1016</span> </span><span class="WHIT">    </span><span class="COMM">// When all else fails throw and exception.</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">recordType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">SC.kindOf</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.Record</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'SC.Child: Error during transform: Invalid record type.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1020</span> 
<span class='line'>1021</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">recordType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1023</span> 
<span class='line'>1024</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1025</span>     Creates a new nested record instance.
<span class='line'>1026</span> 
<span class='line'>1027</span>     @param {SC.Record} recordType The type of the nested record to create.
<span class='line'>1028</span>     @param {Hash} hash The hash of attributes to apply to the child record.
<span class='line'>1029</span>     (may be null)
<span class='line'>1030</span>     @returns {SC.Record} the nested record created
<span class='line'>1031</span>    */</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">  </span><span class="NAME">createNestedRecord</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">psk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'store'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1034</span> 
<span class='line'>1035</span> </span><span class="WHIT">    </span><span class="NAME">hash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// init if needed</span><span class="WHIT">
<span class='line'>1036</span> 
<span class='line'>1037</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">store</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Error: during the creation of a child record: NO STORE ON PARENT!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1038</span> 
<span class='line'>1039</span> </span><span class="WHIT">    </span><span class="COMM">// Check for a primary key in the child record hash and if not found, then</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">    </span><span class="COMM">// check for a custom id generation function and if we still have no id,</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">    </span><span class="COMM">// generate a unique (and re-createable) id based on the parent's</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">    </span><span class="COMM">// storeKey.  Having the generated id be re-createable is important so</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">    </span><span class="COMM">// that we don't keep making new storeKeys for the same child record each</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">    </span><span class="COMM">// time that it is reloaded.</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">    </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">[</span><span class="NAME">recordType.prototype.primaryKey</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.generateIdForChild</span><span class="PUNC">(</span><span class="NAME">cr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">psk</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'.'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1048</span> 
<span class='line'>1049</span> </span><span class="WHIT">    </span><span class="COMM">// If there is an id, there may also be a storeKey.  If so, update the</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">    </span><span class="COMM">// hash for the child record in the store and materialize it.  If not,</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">    </span><span class="COMM">// then create the child record.</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">    </span><span class="NAME">sk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.storeKeyExists</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sk</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">      </span><span class="NAME">store.writeDataHash</span><span class="PUNC">(</span><span class="NAME">sk</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">      </span><span class="NAME">cr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.materializeRecord</span><span class="PUNC">(</span><span class="NAME">sk</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">      </span><span class="NAME">cr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">store.createRecord</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1059</span> 
<span class='line'>1060</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1062</span> 
<span class='line'>1063</span> </span><span class="WHIT">  </span><span class="NAME">_nestedRecordKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1064</span> 
<span class='line'>1065</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1066</span>     Override this function if you want to have a special way of creating
<span class='line'>1067</span>     ids for your child records
<span class='line'>1068</span> 
<span class='line'>1069</span>     @param {SC.Record} childRecord
<span class='line'>1070</span>     @returns {String} the id generated
<span class='line'>1071</span>    */</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">  </span><span class="NAME">generateIdForChild</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">childRecord</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1073</span> 
<span class='line'>1074</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1075</span> 
<span class='line'>1076</span> </span><span class="COMM">// Class Methods</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="NAME">SC.Record.mixin</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="COMM">/** @scope SC.Record */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1078</span> 
<span class='line'>1079</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1080</span>     Whether to ignore unknown properties when they are being set on the record
<span class='line'>1081</span>     object. This is useful if you want to strictly enforce the model schema
<span class='line'>1082</span>     and not allow dynamically expanding it by setting new unknown properties
<span class='line'>1083</span> 
<span class='line'>1084</span>     @static
<span class='line'>1085</span>     @type Boolean
<span class='line'>1086</span>     @default NO
<span class='line'>1087</span>   */</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">  </span><span class="NAME">ignoreUnknownProperties</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1089</span> 
<span class='line'>1090</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">  </span><span class="COMM">// CONSTANTS</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1093</span> 
<span class='line'>1094</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1095</span>     Generic state for records with no local changes.
<span class='line'>1096</span> 
<span class='line'>1097</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1098</span> 
<span class='line'>1099</span>     @static
<span class='line'>1100</span>     @constant
<span class='line'>1101</span>     @type Number
<span class='line'>1102</span>     @default 0x0001
<span class='line'>1103</span>   */</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">  </span><span class="NAME">CLEAN</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="NUMB">0x0001</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 1</span><span class="WHIT">
<span class='line'>1105</span> 
<span class='line'>1106</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1107</span>     Generic state for records with local changes.
<span class='line'>1108</span> 
<span class='line'>1109</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1110</span> 
<span class='line'>1111</span>     @static
<span class='line'>1112</span>     @constant
<span class='line'>1113</span>     @type Number
<span class='line'>1114</span>     @default 0x0002
<span class='line'>1115</span>   */</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">  </span><span class="NAME">DIRTY</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="NUMB">0x0002</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2</span><span class="WHIT">
<span class='line'>1117</span> 
<span class='line'>1118</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1119</span>     State for records that are still loaded.
<span class='line'>1120</span> 
<span class='line'>1121</span>     A record instance should never be in this state.  You will only run into
<span class='line'>1122</span>     it when working with the low-level data hash API on `SC.Store`. Use a
<span class='line'>1123</span>     logical AND (single `&`) to test record status
<span class='line'>1124</span> 
<span class='line'>1125</span>     @static
<span class='line'>1126</span>     @constant
<span class='line'>1127</span>     @type Number
<span class='line'>1128</span>     @default 0x0100
<span class='line'>1129</span>   */</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">  </span><span class="NAME">EMPTY</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="NUMB">0x0100</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 256</span><span class="WHIT">
<span class='line'>1131</span> 
<span class='line'>1132</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1133</span>     State for records in an error state.
<span class='line'>1134</span> 
<span class='line'>1135</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1136</span> 
<span class='line'>1137</span>     @static
<span class='line'>1138</span>     @constant
<span class='line'>1139</span>     @type Number
<span class='line'>1140</span>     @default 0x1000
<span class='line'>1141</span>   */</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">  </span><span class="NAME">ERROR</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="NUMB">0x1000</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 4096</span><span class="WHIT">
<span class='line'>1143</span> 
<span class='line'>1144</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1145</span>     Generic state for records that are loaded and ready for use
<span class='line'>1146</span> 
<span class='line'>1147</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1148</span> 
<span class='line'>1149</span>     @static
<span class='line'>1150</span>     @constant
<span class='line'>1151</span>     @type Number
<span class='line'>1152</span>     @default 0x0200
<span class='line'>1153</span>   */</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="WHIT">  </span><span class="NAME">READY</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="NUMB">0x0200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 512</span><span class="WHIT">
<span class='line'>1155</span> 
<span class='line'>1156</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1157</span>     State for records that are loaded and ready for use with no local changes
<span class='line'>1158</span> 
<span class='line'>1159</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1160</span> 
<span class='line'>1161</span>     @static
<span class='line'>1162</span>     @constant
<span class='line'>1163</span>     @type Number
<span class='line'>1164</span>     @default 0x0201
<span class='line'>1165</span>   */</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">  </span><span class="NAME">READY_CLEAN</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NUMB">0x0201</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 513</span><span class="WHIT">
<span class='line'>1167</span> 
<span class='line'>1168</span> 
<span class='line'>1169</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1170</span>     State for records that are loaded and ready for use with local changes
<span class='line'>1171</span> 
<span class='line'>1172</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1173</span> 
<span class='line'>1174</span>     @static
<span class='line'>1175</span>     @constant
<span class='line'>1176</span>     @type Number
<span class='line'>1177</span>     @default 0x0202
<span class='line'>1178</span>   */</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">  </span><span class="NAME">READY_DIRTY</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NUMB">0x0202</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 514</span><span class="WHIT">
<span class='line'>1180</span> 
<span class='line'>1181</span> 
<span class='line'>1182</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1183</span>     State for records that are new - not yet committed to server
<span class='line'>1184</span> 
<span class='line'>1185</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1186</span> 
<span class='line'>1187</span>     @static
<span class='line'>1188</span>     @constant
<span class='line'>1189</span>     @type Number
<span class='line'>1190</span>     @default 0x0203
<span class='line'>1191</span>   */</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">  </span><span class="NAME">READY_NEW</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NUMB">0x0203</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 515</span><span class="WHIT">
<span class='line'>1193</span> 
<span class='line'>1194</span> 
<span class='line'>1195</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1196</span>     Generic state for records that have been destroyed
<span class='line'>1197</span> 
<span class='line'>1198</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1199</span> 
<span class='line'>1200</span>     @static
<span class='line'>1201</span>     @constant
<span class='line'>1202</span>     @type Number
<span class='line'>1203</span>     @default 0x0400
<span class='line'>1204</span>   */</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">  </span><span class="NAME">DESTROYED</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NUMB">0x0400</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 1024</span><span class="WHIT">
<span class='line'>1206</span> 
<span class='line'>1207</span> 
<span class='line'>1208</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1209</span>     State for records that have been destroyed and committed to server
<span class='line'>1210</span> 
<span class='line'>1211</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1212</span> 
<span class='line'>1213</span>     @static
<span class='line'>1214</span>     @constant
<span class='line'>1215</span>     @type Number
<span class='line'>1216</span>     @default 0x0401
<span class='line'>1217</span>   */</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">  </span><span class="NAME">DESTROYED_CLEAN</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NUMB">0x0401</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 1025</span><span class="WHIT">
<span class='line'>1219</span> 
<span class='line'>1220</span> 
<span class='line'>1221</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1222</span>     State for records that have been destroyed but not yet committed to server
<span class='line'>1223</span> 
<span class='line'>1224</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1225</span> 
<span class='line'>1226</span>     @static
<span class='line'>1227</span>     @constant
<span class='line'>1228</span>     @type Number
<span class='line'>1229</span>     @default 0x0402
<span class='line'>1230</span>   */</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">  </span><span class="NAME">DESTROYED_DIRTY</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NUMB">0x0402</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 1026</span><span class="WHIT">
<span class='line'>1232</span> 
<span class='line'>1233</span> 
<span class='line'>1234</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1235</span>     Generic state for records that have been submitted to data source
<span class='line'>1236</span> 
<span class='line'>1237</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1238</span> 
<span class='line'>1239</span>     @static
<span class='line'>1240</span>     @constant
<span class='line'>1241</span>     @type Number
<span class='line'>1242</span>     @default 0x0800
<span class='line'>1243</span>   */</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">  </span><span class="NAME">BUSY</span><span class="PUNC">:</span><span class="WHIT">             </span><span class="NUMB">0x0800</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2048</span><span class="WHIT">
<span class='line'>1245</span> 
<span class='line'>1246</span> 
<span class='line'>1247</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1248</span>     State for records that are still loading data from the server
<span class='line'>1249</span> 
<span class='line'>1250</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1251</span> 
<span class='line'>1252</span>     @static
<span class='line'>1253</span>     @constant
<span class='line'>1254</span>     @type Number
<span class='line'>1255</span>     @default 0x0804
<span class='line'>1256</span>   */</span><span class="WHIT">
<span class='line'>1257</span> </span><span class="WHIT">  </span><span class="NAME">BUSY_LOADING</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="NUMB">0x0804</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2052</span><span class="WHIT">
<span class='line'>1258</span> 
<span class='line'>1259</span> 
<span class='line'>1260</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1261</span>     State for new records that were created and submitted to the server;
<span class='line'>1262</span>     waiting on response from server
<span class='line'>1263</span> 
<span class='line'>1264</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1265</span> 
<span class='line'>1266</span>     @static
<span class='line'>1267</span>     @constant
<span class='line'>1268</span>     @type Number
<span class='line'>1269</span>     @default 0x0808
<span class='line'>1270</span>   */</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">  </span><span class="NAME">BUSY_CREATING</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="NUMB">0x0808</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2056</span><span class="WHIT">
<span class='line'>1272</span> 
<span class='line'>1273</span> 
<span class='line'>1274</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1275</span>     State for records that have been modified and submitted to server
<span class='line'>1276</span> 
<span class='line'>1277</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1278</span> 
<span class='line'>1279</span>     @static
<span class='line'>1280</span>     @constant
<span class='line'>1281</span>     @type Number
<span class='line'>1282</span>     @default 0x0810
<span class='line'>1283</span>   */</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">  </span><span class="NAME">BUSY_COMMITTING</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NUMB">0x0810</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2064</span><span class="WHIT">
<span class='line'>1285</span> 
<span class='line'>1286</span> 
<span class='line'>1287</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1288</span>     State for records that have requested a refresh from the server.
<span class='line'>1289</span> 
<span class='line'>1290</span>     Use a logical AND (single `&`) to test record status.
<span class='line'>1291</span> 
<span class='line'>1292</span>     @static
<span class='line'>1293</span>     @constant
<span class='line'>1294</span>     @type Number
<span class='line'>1295</span>     @default 0x0820
<span class='line'>1296</span>   */</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">  </span><span class="NAME">BUSY_REFRESH</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="NUMB">0x0820</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2080</span><span class="WHIT">
<span class='line'>1298</span> 
<span class='line'>1299</span> 
<span class='line'>1300</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1301</span>     State for records that have requested a refresh from the server.
<span class='line'>1302</span> 
<span class='line'>1303</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1304</span> 
<span class='line'>1305</span>     @static
<span class='line'>1306</span>     @constant
<span class='line'>1307</span>     @type Number
<span class='line'>1308</span>     @default 0x0821
<span class='line'>1309</span>   */</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">  </span><span class="NAME">BUSY_REFRESH_CLEAN</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NUMB">0x0821</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2081</span><span class="WHIT">
<span class='line'>1311</span> 
<span class='line'>1312</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1313</span>     State for records that have requested a refresh from the server.
<span class='line'>1314</span> 
<span class='line'>1315</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1316</span> 
<span class='line'>1317</span>     @static
<span class='line'>1318</span>     @constant
<span class='line'>1319</span>     @type Number
<span class='line'>1320</span>     @default 0x0822
<span class='line'>1321</span>   */</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">  </span><span class="NAME">BUSY_REFRESH_DIRTY</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NUMB">0x0822</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2082</span><span class="WHIT">
<span class='line'>1323</span> 
<span class='line'>1324</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1325</span>     State for records that have been destroyed and submitted to server
<span class='line'>1326</span> 
<span class='line'>1327</span>     Use a logical AND (single `&`) to test record status
<span class='line'>1328</span> 
<span class='line'>1329</span>     @static
<span class='line'>1330</span>     @constant
<span class='line'>1331</span>     @type Number
<span class='line'>1332</span>     @default 0x0840
<span class='line'>1333</span>   */</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">  </span><span class="NAME">BUSY_DESTROYING</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NUMB">0x0840</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 2112</span><span class="WHIT">
<span class='line'>1335</span> 
<span class='line'>1336</span> 
<span class='line'>1337</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">  </span><span class="COMM">// ERRORS</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1340</span> 
<span class='line'>1341</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1342</span>     Error for when you try to modify a record while it is in a bad
<span class='line'>1343</span>     state.
<span class='line'>1344</span> 
<span class='line'>1345</span>     @static
<span class='line'>1346</span>     @constant
<span class='line'>1347</span>     @type SC.Error
<span class='line'>1348</span>   */</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">  </span><span class="NAME">BAD_STATE_ERROR</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="NAME">SC.$error</span><span class="PUNC">(</span><span class="STRN">"Internal Inconsistency"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1350</span> 
<span class='line'>1351</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1352</span>     Error for when you try to create a new record that already exists.
<span class='line'>1353</span> 
<span class='line'>1354</span>     @static
<span class='line'>1355</span>     @constant
<span class='line'>1356</span>     @type SC.Error
<span class='line'>1357</span>   */</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">  </span><span class="NAME">RECORD_EXISTS_ERROR</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.$error</span><span class="PUNC">(</span><span class="STRN">"Record Exists"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1359</span> 
<span class='line'>1360</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1361</span>     Error for when you attempt to locate a record that is not found
<span class='line'>1362</span> 
<span class='line'>1363</span>     @static
<span class='line'>1364</span>     @constant
<span class='line'>1365</span>     @type SC.Error
<span class='line'>1366</span>   */</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="WHIT">  </span><span class="NAME">NOT_FOUND_ERROR</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="NAME">SC.$error</span><span class="PUNC">(</span><span class="STRN">"Not found "</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1368</span> 
<span class='line'>1369</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1370</span>     Error for when you try to modify a record that is currently busy
<span class='line'>1371</span> 
<span class='line'>1372</span>     @static
<span class='line'>1373</span>     @constant
<span class='line'>1374</span>     @type SC.Error
<span class='line'>1375</span>   */</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">  </span><span class="NAME">BUSY_ERROR</span><span class="PUNC">:</span><span class="WHIT">          </span><span class="NAME">SC.$error</span><span class="PUNC">(</span><span class="STRN">"Busy"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1377</span> 
<span class='line'>1378</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1379</span>     Generic unknown record error
<span class='line'>1380</span> 
<span class='line'>1381</span>     @static
<span class='line'>1382</span>     @constant
<span class='line'>1383</span>     @type SC.Error
<span class='line'>1384</span>   */</span><span class="WHIT">
<span class='line'>1385</span> </span><span class="WHIT">  </span><span class="NAME">GENERIC_ERROR</span><span class="PUNC">:</span><span class="WHIT">       </span><span class="NAME">SC.$error</span><span class="PUNC">(</span><span class="STRN">"Generic Error"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1386</span> 
<span class='line'>1387</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1388</span>     If true, then searches for records of this type will return subclass instances. For example:
<span class='line'>1389</span> 
<span class='line'>1390</span>         Person = SC.Record.extend();
<span class='line'>1391</span>         Person.isPolymorphic = true;
<span class='line'>1392</span> 
<span class='line'>1393</span>         Male = Person.extend();
<span class='line'>1394</span>         Female = Person.extend();
<span class='line'>1395</span> 
<span class='line'>1396</span>     Using SC.Store#find, or a toOne or toMany relationship on Person will then return records of
<span class='line'>1397</span>     type Male and Female. Polymorphic record types must have unique GUIDs across all subclasses.
<span class='line'>1398</span> 
<span class='line'>1399</span>     @type Boolean
<span class='line'>1400</span>     @default NO
<span class='line'>1401</span>   */</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="WHIT">  </span><span class="NAME">isPolymorphic</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1403</span> 
<span class='line'>1404</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1405</span>     @private
<span class='line'>1406</span>     The next child key to allocate.  A nextChildKey must always be greater than 0.
<span class='line'>1407</span>   */</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">  </span><span class="NAME">_nextChildKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1409</span> 
<span class='line'>1410</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">  </span><span class="COMM">// CLASS METHODS</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1413</span> 
<span class='line'>1414</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1415</span>     Helper method returns a new `SC.RecordAttribute` instance to map a simple
<span class='line'>1416</span>     value or to-one relationship.  At the very least, you should pass the
<span class='line'>1417</span>     type class you expect the attribute to have.  You may pass any additional
<span class='line'>1418</span>     options as well.
<span class='line'>1419</span> 
<span class='line'>1420</span>     Use this helper when you define SC.Record subclasses.
<span class='line'>1421</span> 
<span class='line'>1422</span>         MyApp.Contact = SC.Record.extend({
<span class='line'>1423</span>           firstName: SC.Record.attr(String, { isRequired: YES })
<span class='line'>1424</span>         });
<span class='line'>1425</span> 
<span class='line'>1426</span>     @param {Class} type the attribute type
<span class='line'>1427</span>     @param {Hash} opts the options for the attribute
<span class='line'>1428</span>     @returns {SC.RecordAttribute} created instance
<span class='line'>1429</span>   */</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">  </span><span class="NAME">attr</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.RecordAttribute.attr</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1433</span> 
<span class='line'>1434</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1435</span>     Returns an `SC.RecordAttribute` that describes a fetched attribute.  When
<span class='line'>1436</span>     you reference this attribute, it will return an `SC.RecordArray` that uses
<span class='line'>1437</span>     the type as the fetch key and passes the attribute value as a param.
<span class='line'>1438</span> 
<span class='line'>1439</span>     Use this helper when you define SC.Record subclasses.
<span class='line'>1440</span> 
<span class='line'>1441</span>         MyApp.Group = SC.Record.extend({
<span class='line'>1442</span>           contacts: SC.Record.fetch('MyApp.Contact')
<span class='line'>1443</span>         });
<span class='line'>1444</span> 
<span class='line'>1445</span>     @param {SC.Record|String} recordType The type of records to load
<span class='line'>1446</span>     @param {Hash} opts the options for the attribute
<span class='line'>1447</span>     @returns {SC.RecordAttribute} created instance
<span class='line'>1448</span>   */</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">  </span><span class="NAME">fetch</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.FetchedAttribute.attr</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1452</span> 
<span class='line'>1453</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1454</span>     Will return one of the following:
<span class='line'>1455</span> 
<span class='line'>1456</span>      1. `SC.ManyAttribute` that describes a record array backed by an
<span class='line'>1457</span>         array of guids stored in the underlying JSON.
<span class='line'>1458</span>      2. `SC.ChildrenAttribute` that describes a record array backed by a
<span class='line'>1459</span>         array of hashes.
<span class='line'>1460</span> 
<span class='line'>1461</span>     You can edit the contents of this relationship.
<span class='line'>1462</span> 
<span class='line'>1463</span>     For `SC.ManyAttribute`, If you set the inverse and `isMaster: NO` key,
<span class='line'>1464</span>     then editing this array will modify the underlying data, but the
<span class='line'>1465</span>     inverse key on the matching record will also be edited and that
<span class='line'>1466</span>     record will be marked as needing a change.
<span class='line'>1467</span> 
<span class='line'>1468</span>     @param {SC.Record|String} recordType The type of record to create
<span class='line'>1469</span>     @param {Hash} opts the options for the attribute
<span class='line'>1470</span>     @returns {SC.ManyAttribute|SC.ChildrenAttribute} created instance
<span class='line'>1471</span>   */</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">  </span><span class="NAME">toMany</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">    </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isNested</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opts.nested</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">opts.isNested</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1476</span> 
<span class='line'>1477</span> </span><span class="WHIT">    </span><span class="NAME">this._throwUnlessRecordTypeDefined</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'toMany'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1478</span> 
<span class='line'>1479</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNested</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">      </span><span class="COMM">//@if(debug)</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">      </span><span class="COMM">// Let's provide a little developer help for a common misunderstanding.</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">opts.inverse</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">        </span><span class="NAME">SC.error</span><span class="PUNC">(</span><span class="STRN">"Developer Error: Nested attributes (toMany and toOne with isNested: YES) may not have an inverse property. Nested attributes shouldn't exist as separate records with IDs and relationships; if they do, it's likely that they should be separate records.\n\nNote that if your API nests separate records for convenient requesting and transport, you should separate them in your data source rather than improperly modeling them with nested attributes."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">      </span><span class="COMM">//@endif</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="WHIT">      </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.ChildrenAttribute.attr</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">      </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.ManyAttribute.attr</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1493</span> 
<span class='line'>1494</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1495</span>     Will return one of the following:
<span class='line'>1496</span> 
<span class='line'>1497</span>      1. `SC.SingleAttribute` that converts the underlying ID to a single
<span class='line'>1498</span>         record.  If you modify this property, it will rewrite the underlying
<span class='line'>1499</span>         ID. It will also modify the inverse of the relationship, if you set it.
<span class='line'>1500</span>      2. `SC.ChildAttribute` that you can edit the contents
<span class='line'>1501</span>         of this relationship.
<span class='line'>1502</span> 
<span class='line'>1503</span>     @param {SC.Record|String} recordType the type of the record to create
<span class='line'>1504</span>     @param {Hash} opts additional options
<span class='line'>1505</span>     @returns {SC.SingleAttribute|SC.ChildAttribute} created instance
<span class='line'>1506</span>   */</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">  </span><span class="NAME">toOne</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">    </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isNested</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opts.nested</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">opts.isNested</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1511</span> 
<span class='line'>1512</span> </span><span class="WHIT">    </span><span class="NAME">this._throwUnlessRecordTypeDefined</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'toOne'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1513</span> 
<span class='line'>1514</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNested</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">      </span><span class="COMM">//@if(debug)</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">      </span><span class="COMM">// Let's provide a little developer help for a common misunderstanding.</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">opts.inverse</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">        </span><span class="NAME">SC.error</span><span class="PUNC">(</span><span class="STRN">"Developer Error: Nested attributes (toMany and toOne with isNested: YES) may not have an inverse property. Nested attributes shouldn't exist as separate records with IDs and relationships; if they do, it's likely that they should be separate records.\n\nNote that if your API nests separate records for convenient requesting and transport, you should separate them in your data source rather than improperly modeling them with nested attributes."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">      </span><span class="COMM">//@endif</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">      </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.ChildAttribute.attr</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">      </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.SingleAttribute.attr</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1528</span> 
<span class='line'>1529</span> </span><span class="WHIT">  </span><span class="NAME">_throwUnlessRecordTypeDefined</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">recordType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">relationshipType</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">recordType</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Attempted to create "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">relationshipType</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" attribute with "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="WHIT">            </span><span class="STRN">"undefined recordType. Did you forget to sc_require a dependency?"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1533</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1535</span> 
<span class='line'>1536</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1537</span>     Returns all storeKeys mapped by Id for this record type.  This method is used mostly by the
<span class='line'>1538</span>     `SC.Store` and the Record to coordinate.  You will rarely need to call this method yourself.
<span class='line'>1539</span> 
<span class='line'>1540</span>     Note that for polymorpic record classes, all store keys are kept on the top-most polymorphic
<span class='line'>1541</span>     superclass. This ensures that store key by id requests at any level return only the one unique
<span class='line'>1542</span>     store key.
<span class='line'>1543</span> 
<span class='line'>1544</span>     @see SC.Record.storeKeysById
<span class='line'>1545</span>   */</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">  </span><span class="NAME">storeKeysById</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">superclass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.superclass</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">      </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.keyFor</span><span class="PUNC">(</span><span class="STRN">'storeKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.guidFor</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">      </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1550</span> 
<span class='line'>1551</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ret</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isPolymorphic</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">superclass.isPolymorphic</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">superclass</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">SC.Record</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">superclass.storeKeysById</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1558</span> 
<span class='line'>1559</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1561</span> 
<span class='line'>1562</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1563</span>     Given a primaryKey value for the record, returns the associated
<span class='line'>1564</span>     storeKey.  If the primaryKey has not been assigned a storeKey yet, it
<span class='line'>1565</span>     will be added.
<span class='line'>1566</span> 
<span class='line'>1567</span>     For the inverse of this method see `SC.Store.idFor()` and
<span class='line'>1568</span>     `SC.Store.recordTypeFor()`.
<span class='line'>1569</span> 
<span class='line'>1570</span>     @param {String} id a record id
<span class='line'>1571</span>     @returns {Number} a storeKey.
<span class='line'>1572</span>   */</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">  </span><span class="NAME">storeKeyFor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">storeKeys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.storeKeysById</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">storeKeys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1576</span> 
<span class='line'>1577</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ret</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">      </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Store.generateStoreKey</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">      </span><span class="NAME">SC.Store.idsByStoreKey</span><span class="PUNC">[</span><span class="NAME">ret</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">      </span><span class="NAME">SC.Store.recordTypesByStoreKey</span><span class="PUNC">[</span><span class="NAME">ret</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">      </span><span class="NAME">storeKeys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1583</span> 
<span class='line'>1584</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1585</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1586</span> 
<span class='line'>1587</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1588</span>     Given a primaryKey value for the record, returns the associated
<span class='line'>1589</span>     storeKey.  As opposed to `storeKeyFor()` however, this method
<span class='line'>1590</span>     will NOT generate a new storeKey but returned undefined.
<span class='line'>1591</span> 
<span class='line'>1592</span>     @param {String} id a record id
<span class='line'>1593</span>     @returns {Number} a storeKey.
<span class='line'>1594</span>   */</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">  </span><span class="NAME">storeKeyExists</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">storeKeys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.storeKeysById</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">storeKeys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1598</span> 
<span class='line'>1599</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1601</span> 
<span class='line'>1602</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1603</span>     Returns a record with the named ID in store.
<span class='line'>1604</span> 
<span class='line'>1605</span>     @param {SC.Store} store the store
<span class='line'>1606</span>     @param {String} id the record id or a query
<span class='line'>1607</span>     @returns {SC.Record} record instance
<span class='line'>1608</span>   */</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">  </span><span class="NAME">find</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">store</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">store.find</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1612</span> 
<span class='line'>1613</span> </span><span class="WHIT">  </span><span class="COMM">/** @private - enhance extend to notify SC.Query and ensure polymorphic subclasses are marked as polymorphic as well. */</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">  </span><span class="NAME">extend</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Object.extend.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1616</span> 
<span class='line'>1617</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.Query</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">SC.Query._scq_didDefineRecordType</span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1618</span> 
<span class='line'>1619</span> </span><span class="WHIT">    </span><span class="COMM">// All subclasses of a polymorphic class, must also be polymorphic.</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret.prototype.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'isPolymorphic'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">      </span><span class="NAME">ret.isPolymorphic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ret.prototype.isPolymorphic</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">      </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">ret.prototype.isPolymorphic</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1624</span> 
<span class='line'>1625</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1627</span> 
<span class='line'>1628</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1629</span> </span></pre></body></html>