<html><head><meta http-equiv="content-type" content="text/html; charset=utf8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Project:   SproutCore - JavaScript Application Framework</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Copyright: ©2006-2011 Strobe Inc. and contributors.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">//            Portions ©2008-2011 Apple Inc. All rights reserved.</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="COMM">// License:   Licensed under MIT license (see license.js)</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="NAME">sc_require</span><span class="PUNC">(</span><span class="STRN">'mixins/collection_view_delegate'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="NAME">sc_require</span><span class="PUNC">(</span><span class="STRN">'views/list_item'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 10</span> 
<span class='line'> 11</span> </span><span class="COMM">/**
<span class='line'> 12</span>   Special drag operation passed to delegate if the collection view proposes
<span class='line'> 13</span>   to perform a reorder event.
<span class='line'> 14</span> 
<span class='line'> 15</span>   @static
<span class='line'> 16</span>   @constant
<span class='line'> 17</span> */</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="NAME">SC.DRAG_REORDER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0x0010</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 19</span> 
<span class='line'> 20</span> </span><span class="COMM">/**
<span class='line'> 21</span>   @class
<span class='line'> 22</span> 
<span class='line'> 23</span>   This class renders a collection of views based on the items array set
<span class='line'> 24</span>   as its content.  You will not use this class directly as it does not
<span class='line'> 25</span>   order the views in any manner.  Instead you will want to subclass
<span class='line'> 26</span>   SC.CollectionView or use one of its existing subclasses in SproutCore
<span class='line'> 27</span>   such as SC.ListView, which renders items in a vertical list or SC.GridView,
<span class='line'> 28</span>   which renders items in a grid.
<span class='line'> 29</span> 
<span class='line'> 30</span>   To use a CollectionView subclass, just create the view and set the 'content'
<span class='line'> 31</span>   property to an array of objects.  The collection view will create instances of
<span class='line'> 32</span>   the given exampleView class for each item in the array.  You can also bind to
<span class='line'> 33</span>   the selection property if you want to monitor the current selection.
<span class='line'> 34</span> 
<span class='line'> 35</span>   # Extreme Performance
<span class='line'> 36</span> 
<span class='line'> 37</span>   SC.CollectionView does not just naively render one view per item and
<span class='line'> 38</span>   instead is aggressively optimized to allow for collections of
<span class='line'> 39</span>   hundreds of thousands of items to perform as fast as only a few items.  In
<span class='line'> 40</span>   order to achieve this, first it only creates views and elements for the items
<span class='line'> 41</span>   currently visible.  Therefore, when overriding SC.CollectionView, it is
<span class='line'> 42</span>   critically important to implement `contentIndexesInRect` which should return
<span class='line'> 43</span>   only the indexes of those items that should appear within the visible rect.
<span class='line'> 44</span>   By returning only the indexes that are visible, SC.CollectionView can represent
<span class='line'> 45</span>   enormous collections with only a few views and elements.
<span class='line'> 46</span> 
<span class='line'> 47</span>   The second optimization, is that SC.CollectionView will pool and reuse the
<span class='line'> 48</span>   few views and elements that it does need to create.  Creating and destroying
<span class='line'> 49</span>   views incrementally hurts performance, so by reusing the same views over and
<span class='line'> 50</span>   over, the view can much more quickly alter the set of visible views.  As well,
<span class='line'> 51</span>   inserting and removing elements from the DOM takes more time than simply
<span class='line'> 52</span>   modifying the contents of the same elements over and over, which allows us to
<span class='line'> 53</span>   leave the DOM tree untouched.
<span class='line'> 54</span> 
<span class='line'> 55</span>   @extends SC.View
<span class='line'> 56</span>   @extends SC.CollectionViewDelegate
<span class='line'> 57</span>   @extends SC.CollectionContent
<span class='line'> 58</span>   @since SproutCore 0.9
<span class='line'> 59</span> */</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="NAME">SC.CollectionView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.View.extend</span><span class="PUNC">(</span><span class="NAME">SC.CollectionViewDelegate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.CollectionContent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="COMM">/** @scope SC.CollectionView.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 62</span> 
<span class='line'> 63</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 64</span>     @type Array
<span class='line'> 65</span>     @default ['sc-collection-view']
<span class='line'> 66</span>     @see SC.View#classNames
<span class='line'> 67</span>   */</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">  </span><span class="NAME">classNames</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'sc-collection-view'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 69</span> 
<span class='line'> 70</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 71</span>     @type Array
<span class='line'> 72</span>     @default ['isActive']
<span class='line'> 73</span>   */</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">  </span><span class="NAME">displayProperties</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'isActive'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 75</span> 
<span class='line'> 76</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 77</span>     @type String
<span class='line'> 78</span>     @default 'collectionRenderDelegate'
<span class='line'> 79</span>   */</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">  </span><span class="NAME">renderDelegateName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'collectionRenderDelegate'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 81</span> 
<span class='line'> 82</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 83</span>     @type Number
<span class='line'> 84</span>     @default 200
<span class='line'> 85</span>   */</span><span class="WHIT">
<span class='line'> 86</span> </span><span class="WHIT">  </span><span class="NAME">ACTION_DELAY</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 87</span> 
<span class='line'> 88</span> </span><span class="WHIT">  </span><span class="COMM">// ......................................</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">  </span><span class="COMM">// PROPERTIES</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'> 91</span> 
<span class='line'> 92</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 93</span>     If `YES`, uses the experimental fast `CollectionView` path.
<span class='line'> 94</span> 
<span class='line'> 95</span>     *Note* The performance improvements in the experimental code have been
<span class='line'> 96</span>     integrated directly into SC.CollectionView.  If you have set this property
<span class='line'> 97</span>     to true, you should set it to false and refer to the class documentation
<span class='line'> 98</span>     explaining how to modify the performance boost behavior if necessary.
<span class='line'> 99</span> 
<span class='line'>100</span>     Generally, no modifications should be necessary and you should see an
<span class='line'>101</span>     immediate performance improvement in all collections, especially on
<span class='line'>102</span>     mobile devices.
<span class='line'>103</span> 
<span class='line'>104</span>     @type Boolean
<span class='line'>105</span>     @deprecated Version 1.10
<span class='line'>106</span>     @default NO
<span class='line'>107</span>   */</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">  </span><span class="NAME">useFastPath</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>109</span> 
<span class='line'>110</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>111</span>     An array of content objects
<span class='line'>112</span> 
<span class='line'>113</span>     This array should contain the content objects you want the collection view
<span class='line'>114</span>     to display.  An item view (based on the `exampleView` view class) will be
<span class='line'>115</span>     created for each content object, in the order the content objects appear
<span class='line'>116</span>     in this array.
<span class='line'>117</span> 
<span class='line'>118</span>     If you make the collection editable, the collection view will also modify
<span class='line'>119</span>     this array using the observable array methods of `SC.Array`.
<span class='line'>120</span> 
<span class='line'>121</span>     Usually you will want to bind this property to a controller property
<span class='line'>122</span>     that actually contains the array of objects you to display.
<span class='line'>123</span> 
<span class='line'>124</span>     @type SC.Array
<span class='line'>125</span>     @default null
<span class='line'>126</span>   */</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">  </span><span class="NAME">content</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>128</span> 
<span class='line'>129</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">  </span><span class="NAME">contentBindingDefault</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.Binding.multiple</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>131</span> 
<span class='line'>132</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>133</span>     The current length of the content.
<span class='line'>134</span> 
<span class='line'>135</span>     @readonly
<span class='line'>136</span>     @type Number
<span class='line'>137</span>     @default 0
<span class='line'>138</span>   */</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">  </span><span class="NAME">length</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>140</span> 
<span class='line'>141</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>142</span>     The set of indexes that are currently tracked by the collection view.
<span class='line'>143</span>     This property is used to determine the range of items the collection view
<span class='line'>144</span>     should monitor for changes.
<span class='line'>145</span> 
<span class='line'>146</span>     The default implementation of this property returns an index set covering
<span class='line'>147</span>     the entire range of the content.  It changes automatically whenever the
<span class='line'>148</span>     length changes.
<span class='line'>149</span> 
<span class='line'>150</span>     Note that the returned index set for this property will always be frozen.
<span class='line'>151</span>     To change the nowShowing index set, you must create a new index set and
<span class='line'>152</span>     apply it.
<span class='line'>153</span> 
<span class='line'>154</span>     @field
<span class='line'>155</span>     @type SC.IndexSet
<span class='line'>156</span>     @observes length
<span class='line'>157</span>     @observes clippingFrame
<span class='line'>158</span>   */</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">  </span><span class="NAME">nowShowing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">    </span><span class="COMM">// If there is an in-scroll clipping frame, use it.</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clippingFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._inScrollClippingFrame</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'clippingFrame'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>162</span> 
<span class='line'>163</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.computeNowShowing</span><span class="PUNC">(</span><span class="NAME">clippingFrame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'clippingFrame'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>165</span> 
<span class='line'>166</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>167</span>     Indexes of selected content objects.  This `SC.SelectionSet` is modified
<span class='line'>168</span>     automatically by the collection view when the user changes the selection
<span class='line'>169</span>     on the collection.
<span class='line'>170</span> 
<span class='line'>171</span>     Any item views representing content objects in this set will have their
<span class='line'>172</span>     isSelected property set to `YES` automatically.
<span class='line'>173</span> 
<span class='line'>174</span>     @type SC.SelectionSet
<span class='line'>175</span>     @default null
<span class='line'>176</span>   */</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">  </span><span class="NAME">selection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>178</span> 
<span class='line'>179</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>180</span>     Allow user to select content using the mouse and keyboard.
<span class='line'>181</span> 
<span class='line'>182</span>     Set this property to `NO` to disallow the user from selecting items. If you
<span class='line'>183</span>     have items in your `selectedIndexes` property, they will still be reflected
<span class='line'>184</span>     visually.
<span class='line'>185</span> 
<span class='line'>186</span>     @type Boolean
<span class='line'>187</span>     @default YES
<span class='line'>188</span>   */</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">  </span><span class="NAME">isSelectable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>190</span> 
<span class='line'>191</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">  </span><span class="NAME">isSelectableBindingDefault</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.Binding.bool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>193</span> 
<span class='line'>194</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>195</span>     Enable or disable the view.
<span class='line'>196</span> 
<span class='line'>197</span>     The collection view will set the `isEnabled` property of its item views to
<span class='line'>198</span>     reflect the same view of this property.  Whenever `isEnabled` is false,
<span class='line'>199</span>     the collection view will also be not selectable or editable, regardless of
<span class='line'>200</span>     the settings for `isEditable` & `isSelectable`.
<span class='line'>201</span> 
<span class='line'>202</span>     @type Boolean
<span class='line'>203</span>     @default YES
<span class='line'>204</span>   */</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">  </span><span class="NAME">isEnabled</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>206</span> 
<span class='line'>207</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">  </span><span class="NAME">isEnabledBindingDefault</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.Binding.bool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>209</span> 
<span class='line'>210</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>211</span>     Allow user to edit content views.
<span class='line'>212</span> 
<span class='line'>213</span>     Whenever `isEditable` is false, the user will not be able to reorder, add,
<span class='line'>214</span>     or delete items regardless of the `canReorderContent` and `canDeleteContent`
<span class='line'>215</span>     and `isDropTarget` properties.
<span class='line'>216</span> 
<span class='line'>217</span>     @type Boolean
<span class='line'>218</span>     @default YES
<span class='line'>219</span>   */</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">  </span><span class="NAME">isEditable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>221</span> 
<span class='line'>222</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">  </span><span class="NAME">isEditableBindingDefault</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.Binding.bool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>224</span> 
<span class='line'>225</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>226</span>     Allow user to reorder items using drag and drop.
<span class='line'>227</span> 
<span class='line'>228</span>     If true, the user can use drag and drop to reorder items in the list.
<span class='line'>229</span>     If you also accept drops, this will allow the user to drop items into
<span class='line'>230</span>     specific points in the list.  Otherwise items will be added to the end.
<span class='line'>231</span> 
<span class='line'>232</span>     When canReorderContent is true, item views will have the `isReorderable`
<span class='line'>233</span>     property set to true (if the `isEditable` is true on the collection).
<span class='line'>234</span> 
<span class='line'>235</span>     @type Boolean
<span class='line'>236</span>     @default NO
<span class='line'>237</span>   */</span><span class="WHIT">
<span class='line'>238</span> </span><span class="WHIT">  </span><span class="NAME">canReorderContent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>239</span> 
<span class='line'>240</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">  </span><span class="NAME">canReorderContentBindingDefault</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.Binding.bool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>242</span> 
<span class='line'>243</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>244</span>     Allow the user to delete items using the delete key
<span class='line'>245</span> 
<span class='line'>246</span>     If true the user will be allowed to delete selected items using the delete
<span class='line'>247</span>     key.  Otherwise deletes will not be permitted.
<span class='line'>248</span> 
<span class='line'>249</span>     When canDeleteContent is true, item views will have the `isDeletable`
<span class='line'>250</span>     property set to true (if the `isEditable` is true on the collection).
<span class='line'>251</span> 
<span class='line'>252</span>     @type Boolean
<span class='line'>253</span>     @default NO
<span class='line'>254</span>   */</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">  </span><span class="NAME">canDeleteContent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>256</span> 
<span class='line'>257</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">  </span><span class="NAME">canDeleteContentBindingDefault</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.Binding.bool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>259</span> 
<span class='line'>260</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>261</span>     Allow user to edit the content by double clicking on it or hitting return.
<span class='line'>262</span>     This will only work if isEditable is `YES` and the item view implements
<span class='line'>263</span>     the `beginEditing()` method.
<span class='line'>264</span> 
<span class='line'>265</span>     When canEditContent is true, item views will have the `isEditable`
<span class='line'>266</span>     property set to true (if the `isEditable` is true on the collection).
<span class='line'>267</span> 
<span class='line'>268</span>     @type Boolean
<span class='line'>269</span>   */</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">  </span><span class="NAME">canEditContent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>271</span> 
<span class='line'>272</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">  </span><span class="NAME">canEditContentBindingDefault</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.Binding.bool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>274</span> 
<span class='line'>275</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>276</span>     Accept drops for data other than reordering.
<span class='line'>277</span> 
<span class='line'>278</span>     Setting this property to return true when the view is instantiated will
<span class='line'>279</span>     cause it to be registered as a drop target, activating the other drop
<span class='line'>280</span>     machinery.
<span class='line'>281</span> 
<span class='line'>282</span>     @type Boolean
<span class='line'>283</span>     @default NO
<span class='line'>284</span>   */</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">  </span><span class="NAME">isDropTarget</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>286</span> 
<span class='line'>287</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>288</span>     Use toggle selection instead of normal click behavior.
<span class='line'>289</span> 
<span class='line'>290</span>     If set to true, then selection will use a toggle instead of the normal
<span class='line'>291</span>     click behavior.  Command modifiers will be ignored and instead clicking
<span class='line'>292</span>     once will select an item and clicking on it again will deselect it.
<span class='line'>293</span> 
<span class='line'>294</span>     @type Boolean
<span class='line'>295</span>     @default NO
<span class='line'>296</span>   */</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">  </span><span class="NAME">useToggleSelection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>298</span> 
<span class='line'>299</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>300</span>     Trigger the action method on a single click.
<span class='line'>301</span> 
<span class='line'>302</span>     Normally, clicking on an item view in a collection will select the content
<span class='line'>303</span>     object and double clicking will trigger the action method on the
<span class='line'>304</span>     collection view.
<span class='line'>305</span> 
<span class='line'>306</span>     If you set this property to `YES`, then clicking on a view will both select
<span class='line'>307</span>     it (if `isSelected` is true) and trigger the action method.
<span class='line'>308</span> 
<span class='line'>309</span>     Use this if you are using the collection view as a menu of items.
<span class='line'>310</span> 
<span class='line'>311</span>     @type Boolean
<span class='line'>312</span>     @default NO
<span class='line'>313</span>   */</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">  </span><span class="NAME">actOnSelect</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>315</span> 
<span class='line'>316</span> 
<span class='line'>317</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>318</span>     Select an item immediately on mouse down
<span class='line'>319</span> 
<span class='line'>320</span>     Normally as soon as you begin a click the item will be selected.
<span class='line'>321</span> 
<span class='line'>322</span>     In some UI scenarios, you might want to prevent selection until
<span class='line'>323</span>     the mouse is released, so you can perform, for instance, a drag operation
<span class='line'>324</span>     without actually selecting the target item.
<span class='line'>325</span> 
<span class='line'>326</span>     @type Boolean
<span class='line'>327</span>     @default YES
<span class='line'>328</span>   */</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">  </span><span class="NAME">selectOnMouseDown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>330</span> 
<span class='line'>331</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>332</span>     The view class to use when creating new item views.
<span class='line'>333</span> 
<span class='line'>334</span>     The collection view will automatically create an instance of the view
<span class='line'>335</span>     class you set here for each item in its content array.  You should provide
<span class='line'>336</span>     your own subclass for this property to display the type of content you
<span class='line'>337</span>     want.
<span class='line'>338</span> 
<span class='line'>339</span>     The view you set here should understand the following properties, which
<span class='line'>340</span>     it can use to alter its display:
<span class='line'>341</span> 
<span class='line'>342</span>     - `content` -- The content object from the content array your view should
<span class='line'>343</span>       display.
<span class='line'>344</span>     - `isEnabled` -- False if the view should appear disabled.
<span class='line'>345</span>     - `isSelected` -- True if the view should appear selected.
<span class='line'>346</span>     - `contentIndex` -- The current index of the view's content.
<span class='line'>347</span>     - `isEditable` -- True if the view should appear editable by clicking on it
<span class='line'>348</span>       or hitting the Return key.
<span class='line'>349</span>     - `isReorderable` -- True if the view should appear reorderable by dragging
<span class='line'>350</span>       it.
<span class='line'>351</span>     - `isDeletable` -- True if the view should appear deletable, by clicking on
<span class='line'>352</span>       a delete button within it or hitting the Delete key.
<span class='line'>353</span> 
<span class='line'>354</span>     # Working with View and Element Pooling
<span class='line'>355</span> 
<span class='line'>356</span>     As noted in the SC.CollectionView description above, by default the few
<span class='line'>357</span>     instances that are needed of the exampleView class will be created and then
<span class='line'>358</span>     reused.  Reusing an exampleView means that the content, isSelected, isEnabled,
<span class='line'>359</span>     isEditable, isReorderable, isDeletable and contentIndex properties will be
<span class='line'>360</span>     updated as an existing view is pulled from the pool to be displayed.
<span class='line'>361</span> 
<span class='line'>362</span>     If your custom exampleView class has trouble being reused, you may want to
<span class='line'>363</span>     implement the `sleepInPool` and `awakeFromPool` methods in your exampleView.
<span class='line'>364</span>     These two methods will be called on the view, one before it is pooled,
<span class='line'>365</span>     sleepInPool, and the other before it is unpooled, awakeFromPool.  For
<span class='line'>366</span>     example, if your item views have images and there is a delay for new
<span class='line'>367</span>     images to appear, you may want to use sleepInPool to ensure the previous
<span class='line'>368</span>     image is unloaded so it doesn't appear momentarily while the new image loads.
<span class='line'>369</span> 
<span class='line'>370</span>     Also, if the rendered output of your exampleView does not update properly you
<span class='line'>371</span>     can disable reuse of the layer by setting `isLayerReusable` to false.  This
<span class='line'>372</span>     will reduce the performance of your collection though and it is recommended
<span class='line'>373</span>     that you instead look at ways to properly update the existing layer as the
<span class='line'>374</span>     content changes.
<span class='line'>375</span> 
<span class='line'>376</span>     Finally, if you really don't want view or element reuse at all, you may
<span class='line'>377</span>     disable them both by setting `isReusable` to false in your exampleView class.
<span class='line'>378</span>     Your collection will still benefit greatly from incremental rendering, but
<span class='line'>379</span>     it will perform slightly less well than with optimal re-use.
<span class='line'>380</span> 
<span class='line'>381</span>     # Event handling
<span class='line'>382</span> 
<span class='line'>383</span>     In general you do not want your child views to actually respond to mouse
<span class='line'>384</span>     and keyboard events themselves.  It is better to let the collection view
<span class='line'>385</span>     do that.
<span class='line'>386</span> 
<span class='line'>387</span>     If you do implement your own event handlers such as mouseDown or mouseUp,
<span class='line'>388</span>     you should be sure to actually call the same method on the collection view
<span class='line'>389</span>     to give it the chance to perform its own selection housekeeping.
<span class='line'>390</span> 
<span class='line'>391</span>     @type SC.View
<span class='line'>392</span>     @default SC.View
<span class='line'>393</span>   */</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">  </span><span class="NAME">exampleView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.View</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>395</span> 
<span class='line'>396</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>397</span>     If set, this key will be used to get the example view for a given
<span class='line'>398</span>     content object.  The exampleView property will be ignored.
<span class='line'>399</span> 
<span class='line'>400</span>     @type String
<span class='line'>401</span>     @default null
<span class='line'>402</span>   */</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">  </span><span class="NAME">contentExampleViewKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>404</span> 
<span class='line'>405</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>406</span>     The view class to use when creating new group item views.
<span class='line'>407</span> 
<span class='line'>408</span>     The collection view will automatically create an instance of the view
<span class='line'>409</span>     class you set here for each item in its content array.  You should provide
<span class='line'>410</span>     your own subclass for this property to display the type of content you
<span class='line'>411</span>     want.
<span class='line'>412</span> 
<span class='line'>413</span>     If you leave this set to null then the regular example view will be used
<span class='line'>414</span>     with the isGroupView property set to YES on the item view.
<span class='line'>415</span> 
<span class='line'>416</span>     @type SC.View
<span class='line'>417</span>     @default null
<span class='line'>418</span>   */</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">  </span><span class="NAME">groupExampleView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>420</span> 
<span class='line'>421</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>422</span>     If set, this key will be used to get the example view for a given
<span class='line'>423</span>     content object.  The `groupExampleView` property will be ignored.
<span class='line'>424</span> 
<span class='line'>425</span>     @type String
<span class='line'>426</span>     @default null
<span class='line'>427</span>   */</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">  </span><span class="NAME">contentGroupExampleViewKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>429</span> 
<span class='line'>430</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>431</span>     Invoked when the user double clicks on an item (or single clicks of
<span class='line'>432</span>     actOnSelect is true)
<span class='line'>433</span> 
<span class='line'>434</span>     Set this to the name of the action you want to send down the
<span class='line'>435</span>     responder chain when the user double clicks on an item (or single clicks
<span class='line'>436</span>     if `actOnSelect` is true).  You can optionally specify a specific target as
<span class='line'>437</span>     well using the target property.
<span class='line'>438</span> 
<span class='line'>439</span>     If you do not specify an action, then the collection view will also try to
<span class='line'>440</span>     invoke the action named on the target item view.
<span class='line'>441</span> 
<span class='line'>442</span>     Older versions of SproutCore expected the action property to contain an
<span class='line'>443</span>     actual function that would be run.  This format is still supported but is
<span class='line'>444</span>     deprecated for future use.  You should generally use the responder chain
<span class='line'>445</span>     to handle your action for you.
<span class='line'>446</span> 
<span class='line'>447</span>     @type String
<span class='line'>448</span>     @default null
<span class='line'>449</span>   */</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">  </span><span class="NAME">action</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>451</span> 
<span class='line'>452</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>453</span>     Optional target to send the action to when the user double clicks.
<span class='line'>454</span> 
<span class='line'>455</span>     If you set the action property to the name of an action, you can
<span class='line'>456</span>     optionally specify the target object you want the action to be sent to.
<span class='line'>457</span>     This can be either an actual object or a property path that will resolve
<span class='line'>458</span>     to an object at the time that the action is invoked.
<span class='line'>459</span> 
<span class='line'>460</span>     This property is ignored if you use the deprecated approach of making the
<span class='line'>461</span>     action property a function.
<span class='line'>462</span> 
<span class='line'>463</span>     @type String|Object
<span class='line'>464</span>     @default null
<span class='line'>465</span>   */</span><span class="WHIT">
<span class='line'>466</span> </span><span class="WHIT">  </span><span class="NAME">target</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>467</span> 
<span class='line'>468</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>469</span>     Property on content items to use for display.
<span class='line'>470</span> 
<span class='line'>471</span>     Built-in item views such as the `LabelView`s and `ImageView`s will use the
<span class='line'>472</span>     value of this property as a key on the content object to determine the
<span class='line'>473</span>     value they should display.
<span class='line'>474</span> 
<span class='line'>475</span>     For example, if you set `contentValueKey` to 'name' and set the
<span class='line'>476</span>     exampleView to an `SC.LabelView`, then the label views created by the
<span class='line'>477</span>     collection view will display the value of the content.name.
<span class='line'>478</span> 
<span class='line'>479</span>     If you are writing your own custom item view for a collection, you can
<span class='line'>480</span>     get this behavior automatically by including the SC.Control mixin on your
<span class='line'>481</span>     view.  You can also ignore this property if you like.  The collection view
<span class='line'>482</span>     itself does not use this property to impact rendering.
<span class='line'>483</span> 
<span class='line'>484</span>     @type String
<span class='line'>485</span>     @default null
<span class='line'>486</span>   */</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">  </span><span class="NAME">contentValueKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>488</span> 
<span class='line'>489</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>490</span>     Enables keyboard-based navigate, deletion, etc. if set to true.
<span class='line'>491</span> 
<span class='line'>492</span>     @type Boolean
<span class='line'>493</span>     @default NO
<span class='line'>494</span>   */</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">  </span><span class="NAME">acceptsFirstResponder</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>496</span> 
<span class='line'>497</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>498</span>     Changing this property value by default will cause the `CollectionView` to
<span class='line'>499</span>     add/remove an 'active' class name to the root element.
<span class='line'>500</span> 
<span class='line'>501</span>     @type Boolean
<span class='line'>502</span>     @default NO
<span class='line'>503</span>   */</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">  </span><span class="NAME">isActive</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>505</span> 
<span class='line'>506</span> 
<span class='line'>507</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>508</span>     This property is used to store the calculated height to have
<span class='line'>509</span>     a consistent scrolling behavior due to the issues generated by using top
<span class='line'>510</span>     instead of `scrollTop`. We could look at the min-height set in the view, but
<span class='line'>511</span>     to avoid performance hits we simply store it and the scrollView will use it if
<span class='line'>512</span>     different than 0.
<span class='line'>513</span> 
<span class='line'>514</span>     @type Number
<span class='line'>515</span>     @default 0
<span class='line'>516</span>   */</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">  </span><span class="NAME">calculatedHeight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>518</span> 
<span class='line'>519</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>520</span>     This property is used to store the calculated width to have
<span class='line'>521</span>     a consistent scrolling behavior due to the issues generated by using left
<span class='line'>522</span>     instead of `scrollLeft`. We could look at the min-width set in the view, but
<span class='line'>523</span>     to avoid performance hits we simply store it and the scrollView will use it if
<span class='line'>524</span>     different than 0.
<span class='line'>525</span> 
<span class='line'>526</span>     @type Number
<span class='line'>527</span>     @default 0
<span class='line'>528</span>   */</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">  </span><span class="NAME">calculatedWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>530</span> 
<span class='line'>531</span> 
<span class='line'>532</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">  </span><span class="COMM">// SUBCLASS METHODS</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>535</span> 
<span class='line'>536</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>537</span>     Adjusts the layout of the view according to the computed layout.  Call
<span class='line'>538</span>     this method to apply the computed layout to the view.
<span class='line'>539</span>   */</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">  </span><span class="NAME">adjustLayout</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.computeLayout</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layout</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this.adjust</span><span class="PUNC">(</span><span class="NAME">layout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>544</span> 
<span class='line'>545</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>546</span>     Override to return the computed layout dimensions of the collection view.
<span class='line'>547</span>     You can omit any dimensions you don't care about setting in your
<span class='line'>548</span>     computed value.
<span class='line'>549</span> 
<span class='line'>550</span>     This layout is automatically applied whenever the content changes.
<span class='line'>551</span> 
<span class='line'>552</span>     If you don't care about computing the layout at all, you can return null.
<span class='line'>553</span> 
<span class='line'>554</span>     @returns {Hash} layout properties
<span class='line'>555</span>   */</span><span class="WHIT">
<span class='line'>556</span> </span><span class="WHIT">  </span><span class="NAME">computeLayout</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>557</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>558</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>559</span> 
<span class='line'>560</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>561</span>     Override to compute the layout of the itemView for the content at the
<span class='line'>562</span>     specified index.  This layout will be applied to the view just before it
<span class='line'>563</span>     is rendered.
<span class='line'>564</span> 
<span class='line'>565</span>     @param {Number} contentIndex the index of content being rendered by
<span class='line'>566</span>       itemView
<span class='line'>567</span>     @returns {Hash} a view layout
<span class='line'>568</span>   */</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">  </span><span class="NAME">layoutForContentIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>572</span> 
<span class='line'>573</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>574</span>     This computed property returns an index set selecting all content indexes.
<span class='line'>575</span>     It will recompute anytime the length of the collection view changes.
<span class='line'>576</span> 
<span class='line'>577</span>     This is used by the default `contentIndexesInRect()` implementation.
<span class='line'>578</span> 
<span class='line'>579</span>     @field
<span class='line'>580</span>     @type SC.IndexSet
<span class='line'>581</span>     @observes length
<span class='line'>582</span>   */</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">  </span><span class="NAME">allContentIndexes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">freeze</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>586</span> 
<span class='line'>587</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>588</span>     Override to return an IndexSet with the indexes that are at least
<span class='line'>589</span>     partially visible in the passed rectangle.  This method is used by the
<span class='line'>590</span>     default implementation of `computeNowShowing()` to determine the new
<span class='line'>591</span>     `nowShowing` range after a scroll.
<span class='line'>592</span> 
<span class='line'>593</span>     Override this method to implement incremental rendering.
<span class='line'>594</span> 
<span class='line'>595</span>     @param {Rect} rect the visible rect
<span class='line'>596</span>     @returns {SC.IndexSet} now showing indexes
<span class='line'>597</span>   */</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">  </span><span class="NAME">contentIndexesInRect</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rect</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// select all</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>601</span> 
<span class='line'>602</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>603</span>     Compute the nowShowing index set.  The default implementation simply
<span class='line'>604</span>     returns the full range.  Override to implement incremental rendering.
<span class='line'>605</span> 
<span class='line'>606</span>     You should not normally call this method yourself.  Instead get the
<span class='line'>607</span>     nowShowing property.
<span class='line'>608</span> 
<span class='line'>609</span>     @returns {SC.IndexSet} new now showing range
<span class='line'>610</span>   */</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">  </span><span class="NAME">computeNowShowing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">clippingFrame</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentIndexesInRect</span><span class="PUNC">(</span><span class="NAME">clippingFrame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">r</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'allContentIndexes'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// default show all</span><span class="WHIT">
<span class='line'>614</span> 
<span class='line'>615</span> </span><span class="WHIT">    </span><span class="COMM">// make sure the index set doesn't contain any indexes greater than the</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">    </span><span class="COMM">// actual content.</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">          </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.get</span><span class="PUNC">(</span><span class="STRN">'max'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.copy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">freeze</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>622</span> 
<span class='line'>623</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>625</span> 
<span class='line'>626</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>627</span>     Override to show the insertion point during a drag.
<span class='line'>628</span> 
<span class='line'>629</span>     Called during a drag to show the insertion point.  Passed value is the
<span class='line'>630</span>     item view that you should display the insertion point before.  If the
<span class='line'>631</span>     passed value is `null`, then you should show the insertion point *AFTER* that
<span class='line'>632</span>     last item view returned by the itemViews property.
<span class='line'>633</span> 
<span class='line'>634</span>     Once this method is called, you are guaranteed to also receive a call to
<span class='line'>635</span>     `hideInsertionPoint()` at some point in the future.
<span class='line'>636</span> 
<span class='line'>637</span>     The default implementation of this method does nothing.
<span class='line'>638</span> 
<span class='line'>639</span>     @param itemView {SC.ClassicView} view the insertion point should appear directly before. If null, show insertion point at end.
<span class='line'>640</span>     @param dropOperation {Number} the drop operation.  will be SC.DROP_BEFORE, SC.DROP_AFTER, or SC.DROP_ON
<span class='line'>641</span> 
<span class='line'>642</span>     @returns {void}
<span class='line'>643</span>   */</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">  </span><span class="NAME">showInsertionPoint</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOperation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>645</span> 
<span class='line'>646</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>647</span>     Override to hide the insertion point when a drag ends.
<span class='line'>648</span> 
<span class='line'>649</span>     Called during a drag to hide the insertion point.  This will be called
<span class='line'>650</span>     when the user exits the view, cancels the drag or completes the drag.  It
<span class='line'>651</span>     will not be called when the insertion point changes during a drag.
<span class='line'>652</span> 
<span class='line'>653</span>     You should expect to receive one or more calls to
<span class='line'>654</span>     `showInsertionPointBefore()` during a drag followed by at least one call to
<span class='line'>655</span>     this method at the end.  Your method should not raise an error if it is
<span class='line'>656</span>     called more than once.
<span class='line'>657</span> 
<span class='line'>658</span>     @returns {void}
<span class='line'>659</span>   */</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">  </span><span class="NAME">hideInsertionPoint</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>661</span> 
<span class='line'>662</span> 
<span class='line'>663</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">  </span><span class="COMM">// DELEGATE SUPPORT</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>666</span> 
<span class='line'>667</span> 
<span class='line'>668</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>669</span>     Delegate used to implement fine-grained control over collection view
<span class='line'>670</span>     behaviors.
<span class='line'>671</span> 
<span class='line'>672</span>     You can assign a delegate object to this property that will be consulted
<span class='line'>673</span>     for various decisions regarding drag and drop, selection behavior, and
<span class='line'>674</span>     even rendering.  The object you place here must implement some or all of
<span class='line'>675</span>     the `SC.CollectionViewDelegate` mixin.
<span class='line'>676</span> 
<span class='line'>677</span>     If you do not supply a delegate but the content object you set implements
<span class='line'>678</span>     the `SC.CollectionViewDelegate` mixin, then the content will be
<span class='line'>679</span>     automatically set as the delegate.  Usually you will work with a
<span class='line'>680</span>     `CollectionView` in this way rather than setting a delegate explicitly.
<span class='line'>681</span> 
<span class='line'>682</span>     @type SC.CollectionViewDelegate
<span class='line'>683</span>     @default null
<span class='line'>684</span>   */</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">  </span><span class="NAME">delegate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>686</span> 
<span class='line'>687</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>688</span>     The delegate responsible for handling selection changes.  This property
<span class='line'>689</span>     will be either the delegate, content, or the collection view itself,
<span class='line'>690</span>     whichever implements the `SC.CollectionViewDelegate` mixin.
<span class='line'>691</span> 
<span class='line'>692</span>     @field
<span class='line'>693</span>     @type Object
<span class='line'>694</span>   */</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">  </span><span class="NAME">selectionDelegate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'delegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.delegateFor</span><span class="PUNC">(</span><span class="STRN">'isCollectionViewDelegate'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'delegate'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>699</span> 
<span class='line'>700</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>701</span>     The delegate responsible for providing additional display information
<span class='line'>702</span>     about the content.  If you bind a collection view to a controller, this
<span class='line'>703</span>     the content will usually also be the content delegate, though you
<span class='line'>704</span>     could implement your own delegate if you prefer.
<span class='line'>705</span> 
<span class='line'>706</span>     @field
<span class='line'>707</span>     @type Object
<span class='line'>708</span>   */</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">  </span><span class="NAME">contentDelegate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'delegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.delegateFor</span><span class="PUNC">(</span><span class="STRN">'isCollectionContent'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>712</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'delegate'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>713</span> 
<span class='line'>714</span> 
<span class='line'>715</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>716</span> </span><span class="WHIT">  </span><span class="COMM">// CONTENT CHANGES</span><span class="WHIT">
<span class='line'>717</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>718</span> 
<span class='line'>719</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>720</span>     Called whenever the content array or an item in the content array or a
<span class='line'>721</span>     property on an item in the content array changes.  Reloads the appropriate
<span class='line'>722</span>     item view when the content array itself changes or calls
<span class='line'>723</span>     `contentPropertyDidChange()` if a property changes.
<span class='line'>724</span> 
<span class='line'>725</span>     Normally you will not call this method directly though you may override
<span class='line'>726</span>     it if you need to change the way changes to observed ranges are handled.
<span class='line'>727</span> 
<span class='line'>728</span>     @param {SC.Array} content the content array generating the change
<span class='line'>729</span>     @param {Object} object the changed object
<span class='line'>730</span>     @param {String} key the changed property or '[]' or an array change
<span class='line'>731</span>     @param {SC.IndexSet} indexes affected indexes or null for all items
<span class='line'>732</span>     @returns {void}
<span class='line'>733</span>   */</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">  </span><span class="NAME">contentRangeDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">object</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">object</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'[]'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">      </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="STRN">'_contentGroupIndexes'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">      </span><span class="NAME">this.reload</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// note: if indexes == null, reloads all</span><span class="WHIT">
<span class='line'>738</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">      </span><span class="NAME">this.contentPropertyDidChange</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>742</span> 
<span class='line'>743</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>744</span>     Called whenever a property on an item in the content array changes.  This
<span class='line'>745</span>     is only called if you have set `observesContentProperties` to `YES`.
<span class='line'>746</span> 
<span class='line'>747</span>     Override this property if you want to do some custom work whenever a
<span class='line'>748</span>     property on a content object changes.
<span class='line'>749</span> 
<span class='line'>750</span>     The default implementation does nothing.
<span class='line'>751</span> 
<span class='line'>752</span>     @param {Object} target the object that changed
<span class='line'>753</span>     @param {String} key the property that changed value
<span class='line'>754</span>     @param {SC.IndexSet} indexes the indexes in the content array affected
<span class='line'>755</span>     @returns {void}
<span class='line'>756</span>   */</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">  </span><span class="NAME">contentPropertyDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>758</span> 
<span class='line'>759</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>760</span>     Called whenever the view needs to updates its `contentRangeObserver` to
<span class='line'>761</span>     reflect the current nowShowing index set.  You will not usually call this
<span class='line'>762</span>     method yourself but you may override it if you need to provide some
<span class='line'>763</span>     custom range observer behavior.
<span class='line'>764</span> 
<span class='line'>765</span>     Note that if you do implement this method, you are expected to maintain
<span class='line'>766</span>     the range observer object yourself.  If a range observer has not been
<span class='line'>767</span>     created yet, this method should create it.  If an observer already exists
<span class='line'>768</span>     this method should update it.
<span class='line'>769</span> 
<span class='line'>770</span>     When you create a new range observer, the observer must eventually call
<span class='line'>771</span>     `contentRangeDidChange()` for the collection view to function properly.
<span class='line'>772</span> 
<span class='line'>773</span>     If you override this method you probably also need to override
<span class='line'>774</span>     `destroyRangeObserver()` to cleanup any existing range observer.
<span class='line'>775</span> 
<span class='line'>776</span>     @returns {void}
<span class='line'>777</span>   */</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">  </span><span class="NAME">updateContentRangeObserver</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">        </span><span class="NAME">observer</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._cv_contentRangeObserver</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>782</span> 
<span class='line'>783</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>784</span> 
<span class='line'>785</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">      </span><span class="NAME">content.updateRangeObserver</span><span class="PUNC">(</span><span class="NAME">observer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentRangeDidChange</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">      </span><span class="NAME">observer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.addRangeObserver</span><span class="PUNC">(</span><span class="NAME">nowShowing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>790</span> 
<span class='line'>791</span> </span><span class="WHIT">      </span><span class="COMM">// Cache the range observer so we can clean it up later.</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">      </span><span class="NAME">this._cv_contentRangeObserver</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">observer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>794</span> 
<span class='line'>795</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>796</span> 
<span class='line'>797</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>798</span>     Called whever the view needs to invalidate the current content range
<span class='line'>799</span>     observer.  This is called whenever the content array changes.  You will
<span class='line'>800</span>     not usually call this method yourself but you may override it if you
<span class='line'>801</span>     provide your own range observer behavior.
<span class='line'>802</span> 
<span class='line'>803</span>     Note that if you override this method you should probably also override
<span class='line'>804</span>     `updateRangeObserver()` to create or update a range observer as needed.
<span class='line'>805</span> 
<span class='line'>806</span>     @returns {void}
<span class='line'>807</span>   */</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">  </span><span class="NAME">removeContentRangeObserver</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">        </span><span class="NAME">observer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._cv_contentRangeObserver</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>811</span> 
<span class='line'>812</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">content.removeRangeObserver</span><span class="PUNC">(</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">      </span><span class="NAME">this._cv_contentRangeObserver</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>817</span> 
<span class='line'>818</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>819</span>     Called whenever the content length changes.  This will invalidate the
<span class='line'>820</span>     length property of the view itself causing the `nowShowing` to recompute
<span class='line'>821</span>     which will in turn update the UI accordingly.
<span class='line'>822</span> 
<span class='line'>823</span>     @returns {void}
<span class='line'>824</span>   */</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">  </span><span class="NAME">contentLengthDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">    </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">    </span><span class="NAME">this.invokeOnce</span><span class="PUNC">(</span><span class="NAME">this.adjustLayout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>830</span> 
<span class='line'>831</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>832</span>     Whenever content property changes to a new value:
<span class='line'>833</span> 
<span class='line'>834</span>       - remove any old observers
<span class='line'>835</span>       - setup new observers (maybe wait until end of runloop to do this?)
<span class='line'>836</span>       - recalc height/reload content
<span class='line'>837</span>       - set content as delegate if delegate was old content
<span class='line'>838</span>       - reset selection
<span class='line'>839</span> 
<span class='line'>840</span>     Whenever content array mutates:
<span class='line'>841</span> 
<span class='line'>842</span>       - possibly stop observing property changes on objects, observe new objs
<span class='line'>843</span>       - reload effected item views
<span class='line'>844</span>       - update layout for receiver
<span class='line'>845</span>   */</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">  </span><span class="NAME">_cv_contentDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">        </span><span class="NAME">lfunc</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentLengthDidChange</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>849</span> 
<span class='line'>850</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">this._content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>851</span> 
<span class='line'>852</span> </span><span class="WHIT">    </span><span class="COMM">// cleanup old content</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">    </span><span class="NAME">this.removeContentRangeObserver</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">      </span><span class="NAME">this._content.removeObserver</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lfunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>857</span> 
<span class='line'>858</span> </span><span class="WHIT">    </span><span class="COMM">// Destroy all pooled views.</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._pools</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._pools</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">        </span><span class="NAME">this._pools</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">invoke</span><span class="PUNC">(</span><span class="STRN">'destroy'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">      </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._pools</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>865</span> 
<span class='line'>866</span> </span><span class="WHIT">    </span><span class="COMM">// cache</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">    </span><span class="NAME">this._content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>868</span> 
<span class='line'>869</span> </span><span class="WHIT">    </span><span class="COMM">// add new observers - range observer will be added lazily</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">      </span><span class="NAME">content.addObserver</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lfunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>873</span> 
<span class='line'>874</span> </span><span class="WHIT">    </span><span class="COMM">// notify all items changed</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">    </span><span class="NAME">this.contentLengthDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">    </span><span class="NAME">this.contentRangeDidChange</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'[]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>878</span> 
<span class='line'>879</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">  </span><span class="COMM">// ITEM VIEWS</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>882</span> 
<span class='line'>883</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>884</span>     The indexes that need to be reloaded.  Must be one of YES, NO, or an
<span class='line'>885</span>     SC.IndexSet.
<span class='line'>886</span>   */</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">  </span><span class="NAME">_invalidIndexes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>888</span> 
<span class='line'>889</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>890</span>     We need to reload if isEnabled, isEditable, canEditContent, canReorderContent or
<span class='line'>891</span>     canDeleteContent change.
<span class='line'>892</span>   */</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">  </span><span class="NAME">_isEnabledDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">    </span><span class="COMM">// Reload the nowShowing indexes.</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">    </span><span class="NAME">this.reload</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">'isEnabled'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'isEditable'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'canEditContent'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'canReorderContent'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'canDeleteContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>897</span> 
<span class='line'>898</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>899</span>     Regenerates the item views for the content items at the specified indexes.
<span class='line'>900</span>     If you pass null instead of an index set, regenerates all item views.
<span class='line'>901</span> 
<span class='line'>902</span>     This method is called automatically whenever the content array changes in
<span class='line'>903</span>     an observable way, but you can call its yourself also if you need to
<span class='line'>904</span>     refresh the collection view for some reason.
<span class='line'>905</span> 
<span class='line'>906</span>     Note that if the length of the content is shorter than the child views
<span class='line'>907</span>     and you call this method, then the child views will be removed no matter
<span class='line'>908</span>     what the index.
<span class='line'>909</span> 
<span class='line'>910</span>     @param {SC.IndexSet} indexes
<span class='line'>911</span>     @returns {SC.CollectionView} receiver
<span class='line'>912</span>   */</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">  </span><span class="NAME">reload</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._invalidIndexes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">invalid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">invalid.add</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._invalidIndexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indexes.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>918</span> 
<span class='line'>919</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">      </span><span class="NAME">this._invalidIndexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// force a total reload</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>923</span> 
<span class='line'>924</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isVisibleInWindow'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.invokeOnce</span><span class="PUNC">(</span><span class="NAME">this.reloadIfNeeded</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>925</span> 
<span class='line'>926</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>928</span> 
<span class='line'>929</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>930</span>     Invoked once per runloop to actually reload any needed item views.
<span class='line'>931</span>     You can call this method at any time to actually force the reload to
<span class='line'>932</span>     happen immediately if any item views need to be reloaded.
<span class='line'>933</span> 
<span class='line'>934</span>     @returns {SC.CollectionView} receiver
<span class='line'>935</span>   */</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">  </span><span class="NAME">reloadIfNeeded</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._invalidIndexes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isVisibleInWindow'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// delay</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">    </span><span class="NAME">this._invalidIndexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>940</span> 
<span class='line'>941</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">      </span><span class="NAME">nowShowing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">      </span><span class="NAME">itemViews</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._sc_itemViews</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">      </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>945</span> 
<span class='line'>946</span> </span><span class="WHIT">    </span><span class="COMM">// if the set is defined but it contains the entire nowShowing range, just</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">    </span><span class="COMM">// replace</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">invalid.isIndexSet</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">invalid.contains</span><span class="PUNC">(</span><span class="NAME">nowShowing</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>949</span> 
<span class='line'>950</span> </span><span class="WHIT">    </span><span class="COMM">// if an index set, just update indexes</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">invalid.isIndexSet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>952</span> 
<span class='line'>953</span> </span><span class="WHIT">      </span><span class="COMM">// Go through the invalid indexes and determine if the matching views</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">      </span><span class="COMM">// should be redrawn (exists and still showing), should be created (</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">      </span><span class="COMM">// doesn't exist and now showing) or should be destroyed (exists and no</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">      </span><span class="COMM">// longer showing).</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">      </span><span class="NAME">invalid.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">        </span><span class="COMM">// Get the existing item view, if there is one.</span><span class="WHIT">
<span class='line'>959</span> </span><span class="WHIT">        </span><span class="NAME">existing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemViews</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>960</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">          </span><span class="COMM">// Exists so remove it (may send to pool).</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">          </span><span class="NAME">this._removeItemView</span><span class="PUNC">(</span><span class="NAME">existing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>964</span> 
<span class='line'>965</span> </span><span class="WHIT">        </span><span class="COMM">// Create it (may fetch from pool).</span><span class="WHIT">
<span class='line'>966</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nowShowing.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>967</span> </span><span class="WHIT">          </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>968</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>970</span> 
<span class='line'>971</span> </span><span class="WHIT">    </span><span class="COMM">// if set is NOT defined, replace entire content with nowShowing</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>973</span> 
<span class='line'>974</span> </span><span class="WHIT">      </span><span class="COMM">// Process the removals.</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemViews.length</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">        </span><span class="COMM">// Get the existing item view, if there is one.</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">        </span><span class="NAME">existing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemViews</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">itemViews</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">          </span><span class="NAME">this._removeItemView</span><span class="PUNC">(</span><span class="NAME">existing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>982</span> 
<span class='line'>983</span> </span><span class="WHIT">      </span><span class="COMM">// Only after the children are removed should we create the new views.</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">      </span><span class="COMM">// We do this in order to maximize the chance of re-use should the view</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">      </span><span class="COMM">// be marked as such.</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">      </span><span class="NAME">nowShowing.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">        </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>990</span> 
<span class='line'>991</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>993</span> 
<span class='line'>994</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">  </span><span class="NAME">_TMP_ATTRS</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>996</span> 
<span class='line'>997</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">  </span><span class="NAME">_COLLECTION_CLASS_NAMES</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'sc-collection-item'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'sc-item'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>999</span> 
<span class='line'>1000</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">  </span><span class="NAME">_GROUP_COLLECTION_CLASS_NAMES</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'sc-collection-item'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'sc-group-item'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1002</span> 
<span class='line'>1003</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1004</span>     Returns the item view for the content object at the specified index. Call
<span class='line'>1005</span>     this method instead of accessing child views directly whenever you need
<span class='line'>1006</span>     to get the view associated with a content index.
<span class='line'>1007</span> 
<span class='line'>1008</span>     Although this method take two parameters, you should almost always call
<span class='line'>1009</span>     it with just the content index.  The other two parameters are used
<span class='line'>1010</span>     internally by the CollectionView.
<span class='line'>1011</span> 
<span class='line'>1012</span>     If you need to change the way the collection view manages item views
<span class='line'>1013</span>     you can override this method as well.  If you just want to change the
<span class='line'>1014</span>     default options used when creating item views, override createItemView()
<span class='line'>1015</span>     instead.
<span class='line'>1016</span> 
<span class='line'>1017</span>     Note that if you override this method, then be sure to implement this
<span class='line'>1018</span>     method so that it uses a cache to return the same item view for a given
<span class='line'>1019</span>     index unless "force" is YES.  In that case, generate a new item view and
<span class='line'>1020</span>     replace the old item view in your cache with the new item view.
<span class='line'>1021</span> 
<span class='line'>1022</span>     @param {Number} idx the content index
<span class='line'>1023</span>     @param {Boolean} rebuild internal use only
<span class='line'>1024</span>     @returns {SC.View} instantiated view
<span class='line'>1025</span>   */</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">  </span><span class="NAME">itemViewForContentIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rebuild</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">      </span><span class="NAME">views</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1029</span> 
<span class='line'>1030</span> </span><span class="WHIT">    </span><span class="COMM">// Initialize internal views cache.</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">    </span><span class="NAME">views</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._sc_itemViews</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">views</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">views</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._sc_itemViews</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1033</span> 
<span class='line'>1034</span> </span><span class="WHIT">    </span><span class="COMM">// Use an existing view for this index if we have it and aren't rebuilding all.</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">    </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">views</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rebuild</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">        </span><span class="NAME">ret.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1044</span> 
<span class='line'>1045</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">      </span><span class="NAME">containerView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'containerView'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">      </span><span class="NAME">exampleView</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">      </span><span class="NAME">pool</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">      </span><span class="NAME">prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1050</span> 
<span class='line'>1051</span> </span><span class="WHIT">    </span><span class="COMM">// Set up the attributes for the view.</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">    </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._attrsForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1053</span> 
<span class='line'>1054</span> </span><span class="WHIT">    </span><span class="COMM">// If the view is reusable and there is an appropriate view inside the</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">    </span><span class="COMM">// pool, simply reuse it to avoid having to create a new view.</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">    </span><span class="NAME">exampleView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._exampleViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">    </span><span class="NAME">prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">exampleView.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">prototype.isReusable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">prototype.isReusable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">      </span><span class="NAME">pool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._poolForExampleView</span><span class="PUNC">(</span><span class="NAME">exampleView</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1060</span> 
<span class='line'>1061</span> </span><span class="WHIT">      </span><span class="COMM">// Is there a view we can re-use?</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pool.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1063</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pool.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1064</span> 
<span class='line'>1065</span> </span><span class="WHIT">        </span><span class="COMM">// Reconfigure the view.</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">        </span><span class="NAME">this._reconfigureItemView</span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1067</span> 
<span class='line'>1068</span> </span><span class="WHIT">        </span><span class="COMM">// Awake the view.</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret.awakeFromPool</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">ret.awakeFromPool</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1070</span> 
<span class='line'>1071</span> </span><span class="WHIT">        </span><span class="COMM">// Recreate the layer if it was destroyed.</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ret.get</span><span class="PUNC">(</span><span class="STRN">'_isRendered'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">          </span><span class="NAME">ret.invokeOnce</span><span class="PUNC">(</span><span class="NAME">ret._doRender</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1077</span> 
<span class='line'>1078</span> </span><span class="WHIT">    </span><span class="COMM">// If we weren't able to re-use a view, then create a new one.</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ret</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">      </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createItemView</span><span class="PUNC">(</span><span class="NAME">exampleView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">      </span><span class="NAME">containerView.insertBefore</span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">   </span><span class="COMM">// Equivalent to 'append()', but avoids one more function call</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1083</span> 
<span class='line'>1084</span> </span><span class="WHIT">    </span><span class="NAME">views</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1087</span> 
<span class='line'>1088</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1089</span>     Helper method for getting the item view of a specific content object
<span class='line'>1090</span> 
<span class='line'>1091</span>     @param {Object} object
<span class='line'>1092</span>   */</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">  </span><span class="NAME">itemViewForContentObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1096</span> 
<span class='line'>1097</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">  </span><span class="NAME">_TMP_LAYERID</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1099</span> 
<span class='line'>1100</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1101</span>     Primitive to instantiate an item view.  You will be passed the class
<span class='line'>1102</span>     and a content index.  You can override this method to perform any other
<span class='line'>1103</span>     one time setup.
<span class='line'>1104</span> 
<span class='line'>1105</span>     Note that item views may be created somewhat frequently so keep this fast.
<span class='line'>1106</span> 
<span class='line'>1107</span>     *IMPORTANT:* The attrs hash passed is reused each time this method is
<span class='line'>1108</span>     called.   If you add properties to this hash be sure to delete them before
<span class='line'>1109</span>     returning from this method.
<span class='line'>1110</span> 
<span class='line'>1111</span>     @param {Class} exampleClass example view class
<span class='line'>1112</span>     @param {Number} idx the content index
<span class='line'>1113</span>     @param {Hash} attrs expected attributes
<span class='line'>1114</span>     @returns {SC.View} item view instance
<span class='line'>1115</span>   */</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">  </span><span class="NAME">createItemView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exampleClass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exampleClass.create</span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1119</span> 
<span class='line'>1120</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1121</span>     Generates a layerId for the passed index and item.  Usually the default
<span class='line'>1122</span>     implementation is suitable.
<span class='line'>1123</span> 
<span class='line'>1124</span>     @param {Number} idx the content index
<span class='line'>1125</span>     @returns {String} layer id, must be suitable for use in HTML id attribute
<span class='line'>1126</span>   */</span><span class="WHIT">
<span class='line'>1127</span> </span><span class="WHIT">  </span><span class="NAME">layerIdFor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._TMP_LAYERID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">    </span><span class="NAME">ret</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.guidFor</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">    </span><span class="NAME">ret</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret.join</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1133</span> 
<span class='line'>1134</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1135</span>     Extracts the content index from the passed layerId.  If the layer id does
<span class='line'>1136</span>     not belong to the receiver or if no value could be extracted, returns NO.
<span class='line'>1137</span> 
<span class='line'>1138</span>     @param {String} id the layer id
<span class='line'>1139</span>   */</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">  </span><span class="NAME">contentIndexForLayerId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>1142</span> 
<span class='line'>1143</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">base</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._baseLayerId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">base</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">base</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._baseLayerId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.guidFor</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1145</span> 
<span class='line'>1146</span> </span><span class="WHIT">    </span><span class="COMM">// no match</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">id.length</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">base.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id.indexOf</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">id.slice</span><span class="PUNC">(</span><span class="NAME">id.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1151</span> 
<span class='line'>1152</span> 
<span class='line'>1153</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1154</span>     Find the first content item view for the passed event.
<span class='line'>1155</span> 
<span class='line'>1156</span>     This method will go up the view chain, starting with the view that was the
<span class='line'>1157</span>     target of the passed event, looking for a child item.  This will become
<span class='line'>1158</span>     the view that is selected by the mouse event.
<span class='line'>1159</span> 
<span class='line'>1160</span>     This method only works for mouseDown & mouseUp events.  mouseMoved events
<span class='line'>1161</span>     do not have a target.
<span class='line'>1162</span> 
<span class='line'>1163</span>     @param {SC.Event} evt An event
<span class='line'>1164</span>     @returns {SC.View} the item view or null
<span class='line'>1165</span>   */</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">  </span><span class="NAME">itemViewForEvent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">responder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getPath</span><span class="PUNC">(</span><span class="STRN">'pane.rootResponder'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">responder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// fast path</span><span class="WHIT">
<span class='line'>1169</span> 
<span class='line'>1170</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.target</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">        </span><span class="NAME">layer</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'layer'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">        </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">        </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1174</span> 
<span class='line'>1175</span> </span><span class="WHIT">    </span><span class="COMM">// walk up the element hierarchy until we find this or an element with an</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">    </span><span class="COMM">// id matching the base guid (i.e. a collection item)</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">    </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">document</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">      </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.$</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'id'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentIndexForLayerId</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="WHIT">        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">      </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.parentNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1184</span> 
<span class='line'>1185</span> </span><span class="WHIT">    </span><span class="COMM">// no matching element found?</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">      </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// avoid memory leaks</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1190</span> 
<span class='line'>1191</span> </span><span class="WHIT">    </span><span class="COMM">// okay, found the DOM node for the view, go ahead and create it</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">    </span><span class="COMM">// first, find the contentIndex</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"layout for item view %@ was found when item view does not exist (%@)"</span><span class="PUNC">.</span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1196</span> 
<span class='line'>1197</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1198</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1199</span> 
<span class='line'>1200</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>1201</span> </span><span class="WHIT">  </span><span class="COMM">// DISCLOSURE SUPPORT</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1203</span> 
<span class='line'>1204</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1205</span>     Expands any items in the passed selection array that have a disclosure
<span class='line'>1206</span>     state.
<span class='line'>1207</span> 
<span class='line'>1208</span>     @param {SC.IndexSet} indexes the indexes to expand
<span class='line'>1209</span>     @returns {SC.CollectionView} receiver
<span class='line'>1210</span>   */</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">  </span><span class="NAME">expand</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1215</span> 
<span class='line'>1216</span> </span><span class="WHIT">    </span><span class="NAME">indexes.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexDisclosureState</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.BRANCH_CLOSED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">del.contentIndexExpand</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1222</span> 
<span class='line'>1223</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1224</span>     Collapses any items in the passed selection array that have a disclosure
<span class='line'>1225</span>     state.
<span class='line'>1226</span> 
<span class='line'>1227</span>     @param {SC.IndexSet} indexes the indexes to expand
<span class='line'>1228</span>     @returns {SC.CollectionView} receiver
<span class='line'>1229</span>   */</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">  </span><span class="NAME">collapse</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1234</span> 
<span class='line'>1235</span> </span><span class="WHIT">    </span><span class="NAME">indexes.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexDisclosureState</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.BRANCH_OPEN</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">del.contentIndexCollapse</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1241</span> 
<span class='line'>1242</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">  </span><span class="COMM">// SELECTION SUPPORT</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1245</span> 
<span class='line'>1246</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1247</span>     Called whenever the selection object is changed to a new value.  Begins
<span class='line'>1248</span>     observing the selection for changes.
<span class='line'>1249</span>   */</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">  </span><span class="NAME">_cv_selectionDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="WHIT">        </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._cv_selection</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1253</span> </span><span class="WHIT">        </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._cv_selectionContentDidChange</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1254</span> 
<span class='line'>1255</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">last</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>1256</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">last.removeObserver</span><span class="PUNC">(</span><span class="STRN">'[]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1257</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sel.addObserver</span><span class="PUNC">(</span><span class="STRN">'[]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1258</span> 
<span class='line'>1259</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_selection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_selectionContentDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1262</span> 
<span class='line'>1263</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1264</span>     Called whenever the selection object or its content changes.  This will
<span class='line'>1265</span>     repaint any items that changed their selection state.
<span class='line'>1266</span>   */</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">  </span><span class="NAME">_cv_selectionContentDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">        </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._cv_selindexes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// clone of last known indexes</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">        </span><span class="NAME">diff</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1272</span> 
<span class='line'>1273</span> </span><span class="WHIT">    </span><span class="COMM">// save new last</span><span class="WHIT">
<span class='line'>1274</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_selindexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.frozenCopy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1275</span> 
<span class='line'>1276</span> </span><span class="WHIT">    </span><span class="COMM">// determine which indexes are now invalid</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">last.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> 
<span class='line'>1280</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">last</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.without</span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">last.without</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">last</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1282</span> 
<span class='line'>1283</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">diff.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.reloadSelectionIndexes</span><span class="PUNC">(</span><span class="NAME">diff</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1285</span> 
<span class='line'>1286</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1287</span>     Contains the current item views that need their selection to be repainted.
<span class='line'>1288</span>     This may be either NO, YES, or an IndexSet.
<span class='line'>1289</span>   */</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">  </span><span class="NAME">_invalidSelection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1291</span> 
<span class='line'>1292</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1293</span>     Called whenever the selection changes.  The passed index set will contain
<span class='line'>1294</span>     any affected indexes including those indexes that were previously
<span class='line'>1295</span>     selected and now should be deselected.
<span class='line'>1296</span> 
<span class='line'>1297</span>     Pass null to reload the selection state for all items.
<span class='line'>1298</span> 
<span class='line'>1299</span>     @param {SC.IndexSet} indexes affected indexes
<span class='line'>1300</span>     @returns {SC.CollectionView} receiver
<span class='line'>1301</span>   */</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">  </span><span class="NAME">reloadSelectionIndexes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._invalidSelection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">invalid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">invalid.add</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._invalidSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indexes.copy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1307</span> 
<span class='line'>1308</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this._invalidSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// force a total reload</span><span class="WHIT">
<span class='line'>1309</span> 
<span class='line'>1310</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isVisibleInWindow'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">      </span><span class="NAME">this.invokeOnce</span><span class="PUNC">(</span><span class="NAME">this.reloadSelectionIndexesIfNeeded</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1313</span> 
<span class='line'>1314</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1316</span> 
<span class='line'>1317</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1318</span>     Reloads the selection state if needed on any dirty indexes.  Normally this
<span class='line'>1319</span>     will run once at the end of the runloop, but you can force the item views
<span class='line'>1320</span>     to reload their selection immediately by calling this method.
<span class='line'>1321</span> 
<span class='line'>1322</span>     You can also override this method if needed to change the way the
<span class='line'>1323</span>     selection is reloaded on item views.  The default behavior will simply
<span class='line'>1324</span>     find any item views in the nowShowing range that are affected and
<span class='line'>1325</span>     modify them.
<span class='line'>1326</span> 
<span class='line'>1327</span>     @returns {SC.CollectionView} receiver
<span class='line'>1328</span>   */</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">  </span><span class="NAME">reloadSelectionIndexesIfNeeded</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._invalidSelection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isVisibleInWindow'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1332</span> 
<span class='line'>1333</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">        </span><span class="NAME">reload</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._invalidIndexes</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1337</span> 
<span class='line'>1338</span> </span><span class="WHIT">    </span><span class="NAME">this._invalidSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// reset invalid</span><span class="WHIT">
<span class='line'>1339</span> 
<span class='line'>1340</span> </span><span class="WHIT">    </span><span class="COMM">// fast path.  if we are going to reload everything anyway, just forget</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">    </span><span class="COMM">// about it.  Also if we don't have a nowShowing, nothing to do.</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reload</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nowShowing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1343</span> 
<span class='line'>1344</span> </span><span class="WHIT">    </span><span class="COMM">// if invalid is YES instead of index set, just reload everything</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1346</span> 
<span class='line'>1347</span> </span><span class="WHIT">    </span><span class="COMM">// if we will reload some items anyway, don't bother</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reload</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">reload.isIndexSet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">invalid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">invalid.without</span><span class="PUNC">(</span><span class="NAME">reload</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1349</span> 
<span class='line'>1350</span> </span><span class="WHIT">    </span><span class="COMM">// iterate through each item and set the isSelected state.</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">    </span><span class="NAME">invalid.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nowShowing.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// not showing</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">view.set</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.contains</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1356</span> 
<span class='line'>1357</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1359</span> 
<span class='line'>1360</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1361</span>     Selection primitive.  Selects the passed IndexSet of items, optionally
<span class='line'>1362</span>     extending the current selection.  If extend is NO or not passed then this
<span class='line'>1363</span>     will replace the selection with the passed value.  Otherwise the indexes
<span class='line'>1364</span>     will be added to the current selection.
<span class='line'>1365</span> 
<span class='line'>1366</span>     @param {Number|SC.IndexSet} indexes index or indexes to select
<span class='line'>1367</span>     @param extend {Boolean} optionally extend the selection
<span class='line'>1368</span>     @returns {SC.CollectionView} receiver
<span class='line'>1369</span>   */</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">  </span><span class="NAME">select</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">extend</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">        </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">        </span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'_contentGroupIndexes'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1375</span> 
<span class='line'>1376</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isSelectable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabledInPane'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1377</span> 
<span class='line'>1378</span> </span><span class="WHIT">    </span><span class="COMM">// normalize</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_NUMBER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">      </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1382</span> 
<span class='line'>1383</span> </span><span class="WHIT">    </span><span class="COMM">// if we are passed an empty index set or null, clear the selection.</span><span class="WHIT">
<span class='line'>1384</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1385</span> 
<span class='line'>1386</span> </span><span class="WHIT">      </span><span class="COMM">// first remove any group indexes - these can never be selected</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">groupIndexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">        </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indexes.copy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="NAME">groupIndexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1390</span> 
<span class='line'>1391</span> </span><span class="WHIT">      </span><span class="COMM">// give the delegate a chance to alter the items</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">      </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewShouldSelectIndexes</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">extend</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>1394</span> 
<span class='line'>1395</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1396</span> 
<span class='line'>1397</span> </span><span class="WHIT">    </span><span class="COMM">// build the selection object, merging if needed</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">extend</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.copy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.SelectionSet.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1400</span> 
<span class='line'>1401</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1402</span> 
<span class='line'>1403</span> </span><span class="WHIT">      </span><span class="COMM">// when selecting only one item, always select by content</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">        </span><span class="NAME">sel.addObject</span><span class="PUNC">(</span><span class="NAME">content.objectAt</span><span class="PUNC">(</span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'firstObject'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> 
<span class='line'>1407</span> </span><span class="WHIT">      </span><span class="COMM">// otherwise select an index range</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">sel.add</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1409</span> 
<span class='line'>1410</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1411</span> 
<span class='line'>1412</span> </span><span class="WHIT">    </span><span class="COMM">// give delegate one last chance</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">    </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewSelectionForProposedSelection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.SelectionSet.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// empty</span><span class="WHIT">
<span class='line'>1415</span> 
<span class='line'>1416</span> </span><span class="WHIT">    </span><span class="COMM">// if we're not extending the selection, clear the selection anchor</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">    </span><span class="NAME">this._selectionAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">    </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel.freeze</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1421</span> 
<span class='line'>1422</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1423</span>     Primitive to remove the indexes from the selection.
<span class='line'>1424</span> 
<span class='line'>1425</span>     @param {Number|SC.IndexSet} indexes index or indexes to deselect
<span class='line'>1426</span>     @returns {SC.CollectionView} receiver
<span class='line'>1427</span>   */</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">  </span><span class="NAME">deselect</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">        </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1432</span> 
<span class='line'>1433</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isSelectable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabledInPane'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>1435</span> 
<span class='line'>1436</span> </span><span class="WHIT">    </span><span class="COMM">// normalize</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_NUMBER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">      </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1440</span> 
<span class='line'>1441</span> </span><span class="WHIT">    </span><span class="COMM">// give the delegate a chance to alter the items</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="WHIT">    </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewShouldDeselectIndexes</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>1444</span> 
<span class='line'>1445</span> </span><span class="WHIT">    </span><span class="COMM">// now merge change - note we expect sel && indexes to not be null</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">    </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.copy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">    </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewSelectionForProposedSelection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.SelectionSet.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// empty</span><span class="WHIT">
<span class='line'>1449</span> 
<span class='line'>1450</span> </span><span class="WHIT">    </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel.freeze</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1453</span> 
<span class='line'>1454</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1455</span>    Finds the next selectable item, up to content length, by asking the
<span class='line'>1456</span>    delegate. If a non-selectable item is found, the index is skipped. If
<span class='line'>1457</span>    no item is found, selection index is returned unmodified.
<span class='line'>1458</span> 
<span class='line'>1459</span>    Return value will always be in the range of the bottom of the current
<span class='line'>1460</span>    selection index and the proposed index.
<span class='line'>1461</span> 
<span class='line'>1462</span>    @param {Number} proposedIndex the desired index to select
<span class='line'>1463</span>    @param {Number} bottom optional bottom of selection use as fallback
<span class='line'>1464</span>    @returns {Number} next selectable index.
<span class='line'>1465</span>   */</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">  </span><span class="NAME">_findNextSelectableItemFromIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lim</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">        </span><span class="NAME">range</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">        </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">        </span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'_contentGroupIndexes'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1472</span> 
<span class='line'>1473</span> </span><span class="WHIT">    </span><span class="COMM">// fast path</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">del.collectionViewShouldSelectIndexes</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">this.collectionViewShouldSelectIndexes</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">proposedIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1477</span> 
<span class='line'>1478</span> </span><span class="WHIT">    </span><span class="COMM">// loop forwards looking for an index that is allowed by delegate</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">    </span><span class="COMM">// we could alternatively just pass the whole range but this might be</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">    </span><span class="COMM">// slow for the delegate</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">    </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lim</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">groupIndexes.contains</span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">        </span><span class="NAME">range.add</span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewShouldSelectIndexes</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">range</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ret.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">proposedIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="WHIT">        </span><span class="NAME">range.remove</span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">      </span><span class="NAME">proposedIndex</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1490</span> 
<span class='line'>1491</span> </span><span class="WHIT">    </span><span class="COMM">// if nothing was found, return top of selection</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bottom</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">      </span><span class="NAME">bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'max'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1498</span> 
<span class='line'>1499</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1500</span>    Finds the previous selectable item, up to the first item, by asking the
<span class='line'>1501</span>    delegate. If a non-selectable item is found, the index is skipped. If
<span class='line'>1502</span>    no item is found, selection index is returned unmodified.
<span class='line'>1503</span> 
<span class='line'>1504</span>    @param {Integer} proposedIndex the desired index to select
<span class='line'>1505</span>    @returns {Integer} the previous selectable index. This will always be in the range of the top of the current selection index and the proposed index.
<span class='line'>1506</span>   */</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">  </span><span class="NAME">_findPreviousSelectableItemFromIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">range</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">        </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">        </span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'_contentGroupIndexes'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1512</span> 
<span class='line'>1513</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">proposedIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1514</span> 
<span class='line'>1515</span> </span><span class="WHIT">    </span><span class="COMM">// fast path</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">del.collectionViewShouldSelectIndexes</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">this.collectionViewShouldSelectIndexes</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">proposedIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1519</span> 
<span class='line'>1520</span> </span><span class="WHIT">    </span><span class="COMM">// loop backwards looking for an index that is allowed by delegate</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">    </span><span class="COMM">// we could alternatively just pass the whole range but this might be</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">    </span><span class="COMM">// slow for the delegate</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">    </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">groupIndexes.contains</span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">        </span><span class="NAME">range.add</span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewShouldSelectIndexes</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">range</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ret.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">proposedIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">        </span><span class="NAME">range.remove</span><span class="PUNC">(</span><span class="NAME">proposedIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">      </span><span class="NAME">proposedIndex</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1532</span> 
<span class='line'>1533</span> </span><span class="WHIT">    </span><span class="COMM">// if nothing was found, return top of selection</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">      </span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'min'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1541</span> 
<span class='line'>1542</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1543</span>     Select one or more items before the current selection, optionally
<span class='line'>1544</span>     extending the current selection.  Also scrolls the selected item into
<span class='line'>1545</span>     view.
<span class='line'>1546</span> 
<span class='line'>1547</span>     Selection does not wrap around.
<span class='line'>1548</span> 
<span class='line'>1549</span>     @param {Boolean} [extend] If true, the selection will be extended
<span class='line'>1550</span>       instead of replaced. Defaults to false.
<span class='line'>1551</span>     @param {Integer} [numberOfItems] The number of previous to be
<span class='line'>1552</span>       selected.  Defaults to 1
<span class='line'>1553</span>     @returns {SC.CollectionView} receiver
<span class='line'>1554</span>   */</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">  </span><span class="NAME">selectPreviousItem</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">extend</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">numberOfItems</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">extend</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">extend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1558</span> 
<span class='line'>1559</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1562</span> 
<span class='line'>1563</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'min'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">        </span><span class="NAME">selBottom</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'max'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">        </span><span class="NAME">anchor</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._selectionAnchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1566</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1567</span> 
<span class='line'>1568</span> </span><span class="WHIT">    </span><span class="COMM">// if extending, then we need to do some fun stuff to build the array</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">extend</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1570</span> 
<span class='line'>1571</span> </span><span class="WHIT">      </span><span class="COMM">// If the selBottom is after the anchor, then reduce the selection</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">        </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1574</span> 
<span class='line'>1575</span> </span><span class="WHIT">      </span><span class="COMM">// otherwise, select the previous item from the top</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">        </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._findPreviousSelectableItemFromIndex</span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1579</span> 
<span class='line'>1580</span> </span><span class="WHIT">      </span><span class="COMM">// Ensure we are not out of bounds</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content.objectAt</span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'min'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1583</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1584</span> 
<span class='line'>1585</span> </span><span class="WHIT">    </span><span class="COMM">// if not extending, just select the item previous to the selTop</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">      </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._findPreviousSelectableItemFromIndex</span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content.objectAt</span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'min'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">      </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">      </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1593</span> 
<span class='line'>1594</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollToIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1595</span> 
<span class='line'>1596</span> </span><span class="WHIT">    </span><span class="COMM">// now build new selection</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">    </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1598</span> 
<span class='line'>1599</span> </span><span class="WHIT">    </span><span class="COMM">// ensure that the item is visible and set the selection</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">    </span><span class="NAME">this.scrollToContentIndex</span><span class="PUNC">(</span><span class="NAME">scrollToIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1601</span> </span><span class="WHIT">    </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1602</span> </span><span class="WHIT">    </span><span class="NAME">this._selectionAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1605</span> 
<span class='line'>1606</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1607</span>     Select one or more items following the current selection, optionally
<span class='line'>1608</span>     extending the current selection.  Also scrolls to selected item.
<span class='line'>1609</span> 
<span class='line'>1610</span>     Selection does not wrap around.
<span class='line'>1611</span> 
<span class='line'>1612</span>     @param {Boolean} [extend] If true, the selection will be extended
<span class='line'>1613</span>       instead of replaced. Defaults to false.
<span class='line'>1614</span>     @param {Integer} [numberOfItems] The number of items to be
<span class='line'>1615</span>       selected. Defaults to 1.
<span class='line'>1616</span>     @returns {SC.CollectionView} receiver
<span class='line'>1617</span>   */</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">  </span><span class="NAME">selectNextItem</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">extend</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">numberOfItems</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">extend</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">extend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1621</span> 
<span class='line'>1622</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1625</span> 
<span class='line'>1626</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'min'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">        </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'max'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">        </span><span class="NAME">anchor</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._selectionAnchor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">        </span><span class="NAME">lim</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1630</span> 
<span class='line'>1631</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1632</span> 
<span class='line'>1633</span> </span><span class="WHIT">    </span><span class="COMM">// if extending, then we need to do some fun stuff to build the array</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">extend</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1635</span> 
<span class='line'>1636</span> </span><span class="WHIT">      </span><span class="COMM">// If the selTop is before the anchor, then reduce the selection</span><span class="WHIT">
<span class='line'>1637</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1638</span> </span><span class="WHIT">        </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1639</span> 
<span class='line'>1640</span> </span><span class="WHIT">      </span><span class="COMM">// otherwise, select the next item after the bottom</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">        </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._findNextSelectableItemFromIndex</span><span class="PUNC">(</span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1644</span> 
<span class='line'>1645</span> </span><span class="WHIT">      </span><span class="COMM">// Ensure we are not out of bounds</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">lim</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lim</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1647</span> 
<span class='line'>1648</span> </span><span class="WHIT">      </span><span class="COMM">// we also need to check that the item exists</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content.objectAt</span><span class="PUNC">(</span><span class="NAME">selBottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'max'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1650</span> 
<span class='line'>1651</span> </span><span class="WHIT">      </span><span class="COMM">// and if top has eclipsed bottom, handle that too.</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1653</span> 
<span class='line'>1654</span> </span><span class="WHIT">    </span><span class="COMM">// if not extending, just select the item next to the selBottom</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">      </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._findNextSelectableItemFromIndex</span><span class="PUNC">(</span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">numberOfItems</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1657</span> 
<span class='line'>1658</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">lim</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lim</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content.objectAt</span><span class="PUNC">(</span><span class="NAME">selBottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'max'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">      </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">      </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1663</span> 
<span class='line'>1664</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollToIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1665</span> 
<span class='line'>1666</span> </span><span class="WHIT">    </span><span class="COMM">// now build new selection</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">    </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">selTop</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selBottom</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">selTop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1668</span> 
<span class='line'>1669</span> </span><span class="WHIT">    </span><span class="COMM">// ensure that the item is visible and set the selection</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">    </span><span class="NAME">this.scrollToContentIndex</span><span class="PUNC">(</span><span class="NAME">scrollToIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">    </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">    </span><span class="NAME">this._selectionAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1675</span> 
<span class='line'>1676</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1677</span>     Deletes the selected content if canDeleteContent is YES.  This will invoke
<span class='line'>1678</span>     delegate methods to provide fine-grained control.  Returns YES if the
<span class='line'>1679</span>     deletion was possible, even if none actually occurred.
<span class='line'>1680</span> 
<span class='line'>1681</span>     @returns {Boolean} YES if deletion is possible.
<span class='line'>1682</span>   */</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">  </span><span class="NAME">deleteSelection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">    </span><span class="COMM">// perform some basic checks...</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canDeleteContent'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1686</span> 
<span class='line'>1687</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">        </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">        </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1691</span> 
<span class='line'>1692</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1693</span> 
<span class='line'>1694</span> </span><span class="WHIT">    </span><span class="COMM">// let the delegate decide what to actually delete.  If this returns an</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">    </span><span class="COMM">// empty index set or null, just do nothing.</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">    </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewShouldDeleteIndexes</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1698</span> 
<span class='line'>1699</span> </span><span class="WHIT">    </span><span class="COMM">// now have the delegate (or us) perform the deletion. The default</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">    </span><span class="COMM">// delegate implementation just uses standard SC.Array methods to do the</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">    </span><span class="COMM">// right thing.</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">    </span><span class="NAME">del.collectionViewDeleteContent</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1703</span> 
<span class='line'>1704</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1705</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1706</span> 
<span class='line'>1707</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">  </span><span class="COMM">// SCROLLING</span><span class="WHIT">
<span class='line'>1709</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1710</span> 
<span class='line'>1711</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1712</span>     Scroll the rootElement (if needed) to ensure that the item is visible.
<span class='line'>1713</span> 
<span class='line'>1714</span>     @param {Number} contentIndex The index of the item to scroll to
<span class='line'>1715</span>     @returns {SC.CollectionView} receiver
<span class='line'>1716</span>   */</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">  </span><span class="NAME">scrollToContentIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1719</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scrollToItemView</span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1720</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1722</span> 
<span class='line'>1723</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1724</span>     Scroll to the passed item view.  If the item view is not visible on screen
<span class='line'>1725</span>     this method will not work.
<span class='line'>1726</span> 
<span class='line'>1727</span>     @param {SC.View} view The item view to scroll to
<span class='line'>1728</span>     @returns {SC.CollectionView} receiver
<span class='line'>1729</span>   */</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">  </span><span class="NAME">scrollToItemView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">view.scrollToVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1734</span> 
<span class='line'>1735</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">  </span><span class="COMM">// KEYBOARD EVENTS</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1738</span> 
<span class='line'>1739</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">  </span><span class="NAME">keyDown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.interpretKeyEvents</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1744</span> 
<span class='line'>1745</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">  </span><span class="NAME">keyUp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1747</span> 
<span class='line'>1748</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1749</span>     Handle space key event.  Do action
<span class='line'>1750</span>   */</span><span class="WHIT">
<span class='line'>1751</span> </span><span class="WHIT">  </span><span class="NAME">insertText</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">chr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">chr</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">' '</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">        </span><span class="NAME">this.invokeLater</span><span class="PUNC">(</span><span class="NAME">this._cv_action</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1760</span> 
<span class='line'>1761</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1762</span>     Handle select all keyboard event.
<span class='line'>1763</span>   */</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">  </span><span class="NAME">selectAll</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="WHIT">    </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1770</span> 
<span class='line'>1771</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1772</span>     Remove selection of any selected items.
<span class='line'>1773</span>   */</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">  </span><span class="NAME">deselectAll</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1777</span> </span><span class="WHIT">    </span><span class="NAME">this.deselect</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1778</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1779</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1780</span> 
<span class='line'>1781</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1782</span>     Handle delete keyboard event.
<span class='line'>1783</span>   */</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">  </span><span class="NAME">deleteBackward</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.deleteSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1787</span> 
<span class='line'>1788</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1789</span>     Handle delete keyboard event.
<span class='line'>1790</span>   */</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">  </span><span class="NAME">deleteForward</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.deleteSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1794</span> 
<span class='line'>1795</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1796</span>     Selects the same item on the next row or moves down one if itemsPerRow = 1
<span class='line'>1797</span>   */</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">  </span><span class="NAME">moveDown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sender</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">    </span><span class="NAME">this.selectNextItem</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'itemsPerRow'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ACTION_DELAY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1803</span> 
<span class='line'>1804</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1805</span>     Selects the same item on the next row or moves up one if itemsPerRow = 1
<span class='line'>1806</span>   */</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">  </span><span class="NAME">moveUp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sender</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">    </span><span class="NAME">this.selectPreviousItem</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'itemsPerRow'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ACTION_DELAY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1812</span> 
<span class='line'>1813</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1814</span>     Selects the previous item if itemsPerRow > 1.  Otherwise does nothing.
<span class='line'>1815</span>     If item is expandable, will collapse.
<span class='line'>1816</span>   */</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">  </span><span class="NAME">moveLeft</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1818</span> </span><span class="WHIT">    </span><span class="COMM">// If the control key is down, this may be a browser shortcut and</span><span class="WHIT">
<span class='line'>1819</span> </span><span class="WHIT">    </span><span class="COMM">// we should not handle the arrow key.</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.ctrlKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">evt.metaKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1821</span> 
<span class='line'>1822</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'itemsPerRow'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1823</span> </span><span class="WHIT">      </span><span class="NAME">this.selectPreviousItem</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">      </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ACTION_DELAY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1825</span> 
<span class='line'>1826</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">          </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">          </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1830</span> 
<span class='line'>1831</span> </span><span class="WHIT">      </span><span class="COMM">// Collapse the element if it is expanded.  However, if there is exactly</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">      </span><span class="COMM">// one item selected and the item is already collapsed or is a leaf</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="WHIT">      </span><span class="COMM">// node, then select the (expanded) parent element instead as a</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">      </span><span class="COMM">// convenience to the user.</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT">     </span><span class="COMM">// We'll load it lazily</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">            </span><span class="NAME">selectParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">            </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1839</span> 
<span class='line'>1840</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">          </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'firstObject'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">          </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentDelegate'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexDisclosureState</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">SC.BRANCH_OPEN</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">selectParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1846</span> 
<span class='line'>1847</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selectParent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">          </span><span class="COMM">// TODO:  PERFORMANCE:  It would be great to have a function like</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">          </span><span class="COMM">//        SC.CollectionView.selectParentItem() or something similar</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">          </span><span class="COMM">//        for performance reasons.  But since we don't currently</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">          </span><span class="COMM">//        have such a function, let's just iterate through the</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">          </span><span class="COMM">//        previous items until we find the first one with a outline</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">          </span><span class="COMM">//        level of one less than the selected item.</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">desiredOutlineLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexOutlineLevel</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1855</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">desiredOutlineLevel</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1856</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1857</span> </span><span class="WHIT">            </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parentIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1858</span> </span><span class="WHIT">              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">previousItemIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._findPreviousSelectableItemFromIndex</span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousItemIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="COMM">// Sanity-check.</span><span class="WHIT">
<span class='line'>1860</span> </span><span class="WHIT">              </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previousItemIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1861</span> </span><span class="WHIT">              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outlineLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexOutlineLevel</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1862</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">outlineLevel</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">desiredOutlineLevel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">                </span><span class="NAME">parentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previousItemIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1866</span> 
<span class='line'>1867</span> </span><span class="WHIT">            </span><span class="COMM">// If we found the parent, select it now.</span><span class="WHIT">
<span class='line'>1868</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parentIndex</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1869</span> </span><span class="WHIT">              </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">          </span><span class="NAME">this.collapse</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1878</span> 
<span class='line'>1879</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1881</span> 
<span class='line'>1882</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1883</span>     Selects the next item if itemsPerRow > 1.  Otherwise does nothing.
<span class='line'>1884</span>   */</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">  </span><span class="NAME">moveRight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">    </span><span class="COMM">// If the control key is down, this may be a browser shortcut and</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">    </span><span class="COMM">// we should not handle the arrow key.</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.ctrlKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">evt.metaKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1889</span> 
<span class='line'>1890</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'itemsPerRow'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">      </span><span class="NAME">this.selectNextItem</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">      </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ACTION_DELAY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1893</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1894</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">          </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">          </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.expand</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1899</span> 
<span class='line'>1900</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1901</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1902</span> 
<span class='line'>1903</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="WHIT">  </span><span class="NAME">moveDownAndModifySelection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sender</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1905</span> </span><span class="WHIT">    </span><span class="NAME">this.selectNextItem</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'itemsPerRow'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ACTION_DELAY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1909</span> 
<span class='line'>1910</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">  </span><span class="NAME">moveUpAndModifySelection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sender</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1912</span> </span><span class="WHIT">    </span><span class="NAME">this.selectPreviousItem</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'itemsPerRow'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ACTION_DELAY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1916</span> 
<span class='line'>1917</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1918</span>     Selects the previous item if itemsPerRow > 1.  Otherwise does nothing.
<span class='line'>1919</span>   */</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">  </span><span class="NAME">moveLeftAndModifySelection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sender</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'itemsPerRow'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="WHIT">      </span><span class="NAME">this.selectPreviousItem</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="WHIT">      </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ACTION_DELAY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1927</span> 
<span class='line'>1928</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1929</span>     Selects the next item if itemsPerRow > 1.  Otherwise does nothing.
<span class='line'>1930</span>   */</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">  </span><span class="NAME">moveRightAndModifySelection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sender</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'itemsPerRow'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">      </span><span class="NAME">this.selectNextItem</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1934</span> </span><span class="WHIT">      </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ACTION_DELAY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1936</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1938</span> 
<span class='line'>1939</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1940</span>     if content value is editable and we have one item selected, then edit.
<span class='line'>1941</span>     otherwise, invoke action.
<span class='line'>1942</span>   */</span><span class="WHIT">
<span class='line'>1943</span> </span><span class="WHIT">  </span><span class="NAME">insertNewline</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sender</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1944</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canEditContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">set</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1946</span> 
<span class='line'>1947</span> </span><span class="WHIT">    </span><span class="COMM">// first make sure we have a single item selected; get idx</span><span class="WHIT">
<span class='line'>1948</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canEdit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1950</span> </span><span class="WHIT">      </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1951</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1952</span> </span><span class="WHIT">        </span><span class="NAME">set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1953</span> </span><span class="WHIT">        </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">set</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">set.get</span><span class="PUNC">(</span><span class="STRN">'min'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1954</span> </span><span class="WHIT">        </span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1955</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1956</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1957</span> 
<span class='line'>1958</span> </span><span class="WHIT">    </span><span class="COMM">// next find itemView and ensure it supports editing</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canEdit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">      </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">      </span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">itemView.beginEditing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_FUNCTION</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1962</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1963</span> 
<span class='line'>1964</span> </span><span class="WHIT">    </span><span class="COMM">// ok, we can edit..</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canEdit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">      </span><span class="NAME">this.scrollToContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">      </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// just in case</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">      </span><span class="NAME">itemView.beginEditing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1969</span> 
<span class='line'>1970</span> </span><span class="WHIT">    </span><span class="COMM">// invoke action</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">      </span><span class="NAME">this.invokeLater</span><span class="PUNC">(</span><span class="NAME">this._cv_action</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1974</span> 
<span class='line'>1975</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// always handle</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1977</span> 
<span class='line'>1978</span> </span><span class="WHIT">  </span><span class="NAME">insertTab</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1979</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nextValidKeyView'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1980</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">view.becomeFirstResponder</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1981</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">evt.allowDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1982</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// handled</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1984</span> 
<span class='line'>1985</span> </span><span class="WHIT">  </span><span class="NAME">insertBacktab</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1986</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'previousValidKeyView'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1987</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">view.becomeFirstResponder</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">evt.allowDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// handled</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1991</span> 
<span class='line'>1992</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="WHIT">  </span><span class="COMM">// MOUSE EVENTS</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1995</span> 
<span class='line'>1996</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>1997</span>     Handles mouse down events on the collection view or on any of its
<span class='line'>1998</span>     children.
<span class='line'>1999</span> 
<span class='line'>2000</span>     The default implementation of this method can handle a wide variety
<span class='line'>2001</span>     of user behaviors depending on how you have configured the various
<span class='line'>2002</span>     options for the collection view.
<span class='line'>2003</span> 
<span class='line'>2004</span>     @param ev {Event} the mouse down event
<span class='line'>2005</span>     @returns {Boolean} Usually YES.
<span class='line'>2006</span>   */</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">  </span><span class="NAME">mouseDown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2009</span> 
<span class='line'>2010</span> </span><span class="WHIT">    </span><span class="COMM">// Fast path!</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isSelectable'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2012</span> 
<span class='line'>2013</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForEvent</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">        </span><span class="NAME">contentIndex</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">        </span><span class="NAME">info</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isSelected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">modifierKeyPressed</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">didSelect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2016</span> </span><span class="WHIT">        </span><span class="NAME">allowsMultipleSel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="STRN">'allowsMultipleSelection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2017</span> 
<span class='line'>2018</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabledInPane'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2019</span> 
<span class='line'>2020</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isSelectable'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> 
<span class='line'>2022</span> </span><span class="WHIT">    </span><span class="COMM">// become first responder if possible.</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">    </span><span class="NAME">this.becomeFirstResponder</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2024</span> 
<span class='line'>2025</span> </span><span class="WHIT">    </span><span class="COMM">// Toggle the selection if selectOnMouseDown is true</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'useToggleSelection'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectOnMouseDown'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">itemView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// do nothing when clicked outside of elements</span><span class="WHIT">
<span class='line'>2029</span> 
<span class='line'>2030</span> </span><span class="WHIT">        </span><span class="COMM">// determine if item is selected. If so, then go on.</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">        </span><span class="NAME">isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sel.containsObject</span><span class="PUNC">(</span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2033</span> 
<span class='line'>2034</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isSelected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">          </span><span class="NAME">this.deselect</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">allowsMultipleSel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">          </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">          </span><span class="NAME">didSelect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">          </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">          </span><span class="NAME">didSelect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2043</span> 
<span class='line'>2044</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">didSelect</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'actOnSelect'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">          </span><span class="COMM">// handle actions on editing</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">          </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2049</span> 
<span class='line'>2050</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2052</span> 
<span class='line'>2053</span> </span><span class="WHIT">    </span><span class="COMM">// received a mouseDown on the collection element, but not on one of the</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">    </span><span class="COMM">// childItems... unless we do not allow empty selections, set it to empty.</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">itemView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'allowDeselectAll'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2059</span> 
<span class='line'>2060</span> </span><span class="WHIT">    </span><span class="COMM">// collection some basic setup info</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">    </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2063</span> 
<span class='line'>2064</span> </span><span class="WHIT">    </span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseDownInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">      </span><span class="NAME">event</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">      </span><span class="NAME">itemView</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="WHIT">      </span><span class="NAME">contentIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">      </span><span class="NAME">at</span><span class="PUNC">:</span><span class="WHIT">           </span><span class="NAME">Date.now</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2070</span> 
<span class='line'>2071</span> </span><span class="WHIT">    </span><span class="NAME">isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.contains</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">    </span><span class="NAME">info.modifierKeyPressed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">modifierKeyPressed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.ctrlKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ev.metaKey</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2073</span> 
<span class='line'>2074</span> 
<span class='line'>2075</span> </span><span class="WHIT">    </span><span class="COMM">// holding down a modifier key while clicking a selected item should</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">    </span><span class="COMM">// deselect that item...deselect and bail.</span><span class="WHIT">
<span class='line'>2077</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">modifierKeyPressed</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isSelected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">      </span><span class="NAME">info.shouldDeselect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2079</span> 
<span class='line'>2080</span> </span><span class="WHIT">    </span><span class="COMM">// if the shiftKey was pressed, then we want to extend the selection</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">    </span><span class="COMM">// from the last selected item</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.shiftKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">allowsMultipleSel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._findSelectionExtendedByShift</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">      </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._selectionAnchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2085</span> </span><span class="WHIT">      </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2086</span> </span><span class="WHIT">      </span><span class="NAME">this._selectionAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//save the anchor</span><span class="WHIT">
<span class='line'>2087</span> 
<span class='line'>2088</span> </span><span class="WHIT">    </span><span class="COMM">// If no modifier key was pressed, then clicking on the selected item</span><span class="WHIT">
<span class='line'>2089</span> </span><span class="WHIT">    </span><span class="COMM">// should clear the selection and reselect only the clicked on item.</span><span class="WHIT">
<span class='line'>2090</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">modifierKeyPressed</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isSelected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2091</span> </span><span class="WHIT">      </span><span class="NAME">info.shouldReselect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2092</span> 
<span class='line'>2093</span> </span><span class="WHIT">    </span><span class="COMM">// Otherwise, if selecting on mouse down,  simply select the clicked on</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="WHIT">    </span><span class="COMM">// item, adding it to the current selection if a modifier key was pressed.</span><span class="WHIT">
<span class='line'>2095</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2096</span> 
<span class='line'>2097</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ev.shiftKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">modifierKeyPressed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">allowsMultipleSel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2098</span> </span><span class="WHIT">        </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2099</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2100</span> 
<span class='line'>2101</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">"selectOnMouseDown"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="WHIT">        </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">modifierKeyPressed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2103</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2104</span> </span><span class="WHIT">        </span><span class="NAME">info.shouldSelect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2105</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2106</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2107</span> 
<span class='line'>2108</span> </span><span class="WHIT">    </span><span class="COMM">// saved for extend by shift ops.</span><span class="WHIT">
<span class='line'>2109</span> </span><span class="WHIT">    </span><span class="NAME">info.previousContentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2110</span> 
<span class='line'>2111</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2113</span> 
<span class='line'>2114</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2115</span> </span><span class="WHIT">  </span><span class="NAME">mouseUp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2116</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForEvent</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2117</span> </span><span class="WHIT">        </span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseDownInfo</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2119</span> 
<span class='line'>2120</span> </span><span class="WHIT">    </span><span class="COMM">// Fast path!</span><span class="WHIT">
<span class='line'>2121</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2122</span> </span><span class="WHIT">      </span><span class="NAME">this._cleanupMouseDown</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2123</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2124</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2125</span> 
<span class='line'>2126</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">view.get</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2127</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isSelected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">canEdit</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2128</span> </span><span class="WHIT">      </span><span class="NAME">allowsMultipleSel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="STRN">'allowsMultipleSelection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2129</span> 
<span class='line'>2130</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabledInPane'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2131</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isSelectable'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2132</span> 
<span class='line'>2133</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'useToggleSelection'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">      </span><span class="COMM">// Return if clicked outside of elements or if toggle was handled by mouseDown</span><span class="WHIT">
<span class='line'>2135</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectOnMouseDown'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2136</span> 
<span class='line'>2137</span> </span><span class="WHIT">      </span><span class="COMM">// determine if item is selected. If so, then go on.</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2139</span> </span><span class="WHIT">      </span><span class="NAME">isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sel.containsObject</span><span class="PUNC">(</span><span class="NAME">view.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2140</span> 
<span class='line'>2141</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isSelected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2142</span> </span><span class="WHIT">        </span><span class="NAME">this.deselect</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2143</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">allowsMultipleSel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2144</span> </span><span class="WHIT">        </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2145</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="WHIT">        </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2147</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2148</span> 
<span class='line'>2149</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">info</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2150</span> </span><span class="WHIT">      </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">info.contentIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2151</span> </span><span class="WHIT">      </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">view.get</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2152</span> 
<span class='line'>2153</span> </span><span class="WHIT">      </span><span class="COMM">// this will be set if the user simply clicked on an unselected item and</span><span class="WHIT">
<span class='line'>2154</span> </span><span class="WHIT">      </span><span class="COMM">// selectOnMouseDown was NO.</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">info.shouldSelect</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">info.modifierKeyPressed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2156</span> 
<span class='line'>2157</span> </span><span class="WHIT">      </span><span class="COMM">// This is true if the user clicked on a selected item with a modifier</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="WHIT">      </span><span class="COMM">// key pressed.</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">info.shouldDeselect</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.deselect</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2160</span> 
<span class='line'>2161</span> </span><span class="WHIT">      </span><span class="COMM">// This is true if the user clicked on a selected item without a</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">      </span><span class="COMM">// modifier-key pressed.  When this happens we try to begin editing</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">      </span><span class="COMM">// on the content.  If that is not allowed, then simply clear the</span><span class="WHIT">
<span class='line'>2164</span> </span><span class="WHIT">      </span><span class="COMM">// selection and reselect the clicked on item.</span><span class="WHIT">
<span class='line'>2165</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">info.shouldReselect</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2166</span> 
<span class='line'>2167</span> </span><span class="WHIT">        </span><span class="COMM">// - contentValueIsEditable is true</span><span class="WHIT">
<span class='line'>2168</span> </span><span class="WHIT">        </span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canEditContent'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2169</span> 
<span class='line'>2170</span> </span><span class="WHIT">        </span><span class="COMM">// - the user clicked on an item that was already selected</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">        </span><span class="COMM">//   ^ this is the only way shouldReset is set to YES</span><span class="WHIT">
<span class='line'>2172</span> 
<span class='line'>2173</span> </span><span class="WHIT">        </span><span class="COMM">// - is the only item selected</span><span class="WHIT">
<span class='line'>2174</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canEdit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2175</span> </span><span class="WHIT">          </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2176</span> </span><span class="WHIT">          </span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2178</span> 
<span class='line'>2179</span> </span><span class="WHIT">        </span><span class="COMM">// - the item view responds to contentHitTest() and returns YES.</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">        </span><span class="COMM">// - the item view responds to beginEditing and returns YES.</span><span class="WHIT">
<span class='line'>2181</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canEdit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="WHIT">          </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2183</span> </span><span class="WHIT">          </span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">itemView.contentHitTest</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">itemView.contentHitTest</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2184</span> </span><span class="WHIT">          </span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">itemView.beginEditing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">itemView.beginEditing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2185</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2186</span> 
<span class='line'>2187</span> </span><span class="WHIT">        </span><span class="COMM">// if cannot edit, schedule a reselect (but give doubleClick a chance)</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">canEdit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._cv_reselectTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._cv_reselectTimer.invalidate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2190</span> </span><span class="WHIT">          </span><span class="NAME">this._cv_reselectTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.invokeLater</span><span class="PUNC">(</span><span class="NAME">this.select</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">300</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2191</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2192</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2193</span> 
<span class='line'>2194</span> </span><span class="WHIT">      </span><span class="NAME">this._cleanupMouseDown</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2196</span> 
<span class='line'>2197</span> </span><span class="WHIT">    </span><span class="COMM">// handle actions on editing</span><span class="WHIT">
<span class='line'>2198</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev.clickCount</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2199</span> 
<span class='line'>2200</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// bubble event to allow didDoubleClick to be called...</span><span class="WHIT">
<span class='line'>2201</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2202</span> 
<span class='line'>2203</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2204</span> </span><span class="WHIT">  </span><span class="NAME">_cleanupMouseDown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2205</span> 
<span class='line'>2206</span> </span><span class="WHIT">    </span><span class="COMM">// delete items explicitly to avoid leaks on IE</span><span class="WHIT">
<span class='line'>2207</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseDownInfo</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2208</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">info</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2209</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">info</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">info.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">        </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">info</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2212</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2214</span> </span><span class="WHIT">    </span><span class="NAME">this.mouseDownInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2215</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2216</span> 
<span class='line'>2217</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2218</span> </span><span class="WHIT">  </span><span class="NAME">mouseMoved</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2219</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForEvent</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2220</span> </span><span class="WHIT">        </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._lastHoveredItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2221</span> 
<span class='line'>2222</span> </span><span class="WHIT">    </span><span class="COMM">// handle hover events.</span><span class="WHIT">
<span class='line'>2223</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">last</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">last.mouseExited</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">last.mouseExited</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2225</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">view.mouseEntered</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">view.mouseEntered</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2226</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2227</span> </span><span class="WHIT">    </span><span class="NAME">this._lastHoveredItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">view</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2228</span> 
<span class='line'>2229</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">view.mouseMoved</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">view.mouseMoved</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2230</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2231</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2232</span> 
<span class='line'>2233</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">  </span><span class="NAME">mouseExited</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._lastHoveredItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">    </span><span class="NAME">this._lastHoveredItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">view.mouseExited</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">view.mouseExited</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2240</span> 
<span class='line'>2241</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="WHIT">  </span><span class="COMM">// TOUCH EVENTS</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2244</span> 
<span class='line'>2245</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2246</span> </span><span class="WHIT">  </span><span class="NAME">touchStart</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">touch</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForEvent</span><span class="PUNC">(</span><span class="NAME">touch</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2248</span> </span><span class="WHIT">        </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2249</span> 
<span class='line'>2250</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabledInPane'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2251</span> 
<span class='line'>2252</span> </span><span class="WHIT">    </span><span class="COMM">// become first responder if possible.</span><span class="WHIT">
<span class='line'>2253</span> </span><span class="WHIT">    </span><span class="NAME">this.becomeFirstResponder</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2254</span> 
<span class='line'>2255</span> </span><span class="WHIT">    </span><span class="NAME">this._touchSelectedView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2256</span> 
<span class='line'>2257</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'useToggleSelection'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2258</span> </span><span class="WHIT">      </span><span class="COMM">// We're faking the selection visually here</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="WHIT">      </span><span class="COMM">// Only track this if we added a selection so we can remove it later</span><span class="WHIT">
<span class='line'>2260</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2261</span> </span><span class="WHIT">        </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2264</span> 
<span class='line'>2265</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2267</span> 
<span class='line'>2268</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">  </span><span class="NAME">touchesDragged</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">touches</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="WHIT">    </span><span class="NAME">touches.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">touch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2272</span> </span><span class="WHIT">        </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">touch.pageX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">touch.startX</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">5</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2273</span> </span><span class="WHIT">        </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">touch.pageY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">touch.startY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">5</span><span class="WHIT">
<span class='line'>2274</span> </span><span class="WHIT">      </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">        </span><span class="COMM">// This calls touchCancelled</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="WHIT">        </span><span class="NAME">touch.makeTouchResponder</span><span class="PUNC">(</span><span class="NAME">touch.nextTouchResponder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2277</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2278</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2279</span> 
<span class='line'>2280</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2281</span> 
<span class='line'>2282</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">  </span><span class="NAME">touchEnd</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">touch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>2285</span>       TODO [CC] We should be using itemViewForEvent here, but because
<span class='line'>2286</span>             ListItemView re-renders itself once isSelected is called
<span class='line'>2287</span>             in touchStart, the elements attached to this event are
<span class='line'>2288</span>             getting orphaned and this event is basically a complete
<span class='line'>2289</span>             fail when using touch events.
<span class='line'>2290</span>     */</span><span class="WHIT">
<span class='line'>2291</span> </span><span class="WHIT">    </span><span class="COMM">// var itemView = this.itemViewForEvent(touch),</span><span class="WHIT">
<span class='line'>2292</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._touchSelectedView</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="WHIT">        </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">        </span><span class="NAME">isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2295</span> 
<span class='line'>2296</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabledInPane'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2297</span> 
<span class='line'>2298</span> </span><span class="WHIT">    </span><span class="COMM">// Remove fake selection in case our contentIndex is -1, a select event will add it back</span><span class="WHIT">
<span class='line'>2299</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2300</span> 
<span class='line'>2301</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2302</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'useToggleSelection'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">        </span><span class="NAME">isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sel.containsObject</span><span class="PUNC">(</span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2306</span> 
<span class='line'>2307</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isSelected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">        </span><span class="NAME">this.deselect</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">        </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2311</span> 
<span class='line'>2312</span> </span><span class="WHIT">        </span><span class="COMM">// If actOnSelect is implemented, the action will be fired.</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">        </span><span class="NAME">this._cv_performSelectAction</span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">touch</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2316</span> 
<span class='line'>2317</span> </span><span class="WHIT">    </span><span class="NAME">this._touchSelectedView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2319</span> 
<span class='line'>2320</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2321</span> </span><span class="WHIT">  </span><span class="NAME">touchCancelled</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">    </span><span class="COMM">// Remove fake selection</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._touchSelectedView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">      </span><span class="NAME">this._touchSelectedView.set</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2325</span> </span><span class="WHIT">      </span><span class="NAME">this._touchSelectedView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2328</span> 
<span class='line'>2329</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">  </span><span class="NAME">_findSelectionExtendedByShift</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2331</span> 
<span class='line'>2332</span> </span><span class="WHIT">    </span><span class="COMM">// fast path.  if we don't have a selection, just select index</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2334</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2335</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2336</span> 
<span class='line'>2337</span> </span><span class="WHIT">    </span><span class="COMM">// if we do have a selection, then figure out how to extend it.</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'min'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">        </span><span class="NAME">max</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.get</span><span class="PUNC">(</span><span class="STRN">'max'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">        </span><span class="NAME">anchor</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._selectionAnchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2341</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2342</span> 
<span class='line'>2343</span> </span><span class="WHIT">    </span><span class="COMM">// clicked before the current selection set... extend it's beginning...</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">      </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._selectionAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//anchor at end</span><span class="WHIT">
<span class='line'>2347</span> 
<span class='line'>2348</span> </span><span class="WHIT">    </span><span class="COMM">// clicked after the current selection set... extend it's ending...</span><span class="WHIT">
<span class='line'>2349</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2350</span> </span><span class="WHIT">      </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2351</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._selectionAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// anchor at start</span><span class="WHIT">
<span class='line'>2352</span> 
<span class='line'>2353</span> </span><span class="WHIT">    </span><span class="COMM">// clicked inside the selection set... need to determine where the last</span><span class="WHIT">
<span class='line'>2354</span> </span><span class="WHIT">    </span><span class="COMM">// selection was and use that as an anchor.</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._selectionAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//anchor at start</span><span class="WHIT">
<span class='line'>2357</span> 
<span class='line'>2358</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">        </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">        </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2363</span> </span><span class="WHIT">        </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contentIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2364</span> </span><span class="WHIT">        </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2367</span> 
<span class='line'>2368</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2370</span> 
<span class='line'>2371</span> </span><span class="WHIT">  </span><span class="COMM">// ......................................</span><span class="WHIT">
<span class='line'>2372</span> </span><span class="WHIT">  </span><span class="COMM">// DRAG AND DROP SUPPORT</span><span class="WHIT">
<span class='line'>2373</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2374</span> 
<span class='line'>2375</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2376</span>     When reordering its content, the collection view will store its reorder
<span class='line'>2377</span>     data using this special data type.  The data type is unique to each
<span class='line'>2378</span>     collection view instance.  You can use this data type to detect reorders
<span class='line'>2379</span>     if necessary.
<span class='line'>2380</span> 
<span class='line'>2381</span>     @field
<span class='line'>2382</span>     @type String
<span class='line'>2383</span>   */</span><span class="WHIT">
<span class='line'>2384</span> </span><span class="WHIT">  </span><span class="NAME">reorderDataType</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2385</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'SC.CollectionView.Reorder.'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">SC.guidFor</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2386</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2387</span> 
<span class='line'>2388</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2389</span>     This property is set to the IndexSet of content objects that are the
<span class='line'>2390</span>     subject of a drag whenever a drag is initiated on the collection view.
<span class='line'>2391</span>     You can consult this property when implementing your collection view
<span class='line'>2392</span>     delegate  methods, but otherwise you should not use this property in your
<span class='line'>2393</span>     code.
<span class='line'>2394</span> 
<span class='line'>2395</span>     @type SC.IndexSet
<span class='line'>2396</span>     @default null
<span class='line'>2397</span>   */</span><span class="WHIT">
<span class='line'>2398</span> </span><span class="WHIT">  </span><span class="NAME">dragContent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2399</span> 
<span class='line'>2400</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2401</span>     This property is set to the proposed insertion index during a call to
<span class='line'>2402</span>     collectionViewValidateDragOperation().  Your delegate implementations can
<span class='line'>2403</span>     change the value of this property to enforce a drop some in some other
<span class='line'>2404</span>     location.
<span class='line'>2405</span> 
<span class='line'>2406</span>     @type Number
<span class='line'>2407</span>     @default null
<span class='line'>2408</span>   */</span><span class="WHIT">
<span class='line'>2409</span> </span><span class="WHIT">  </span><span class="NAME">proposedInsertionIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2410</span> 
<span class='line'>2411</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2412</span>     This property is set to the proposed drop operation during a call to
<span class='line'>2413</span>     collectionViewValidateDragOperation().  Your delegate implementations can
<span class='line'>2414</span>     change the value of this property to enforce a different type of drop
<span class='line'>2415</span>     operation.
<span class='line'>2416</span> 
<span class='line'>2417</span>     @type Number
<span class='line'>2418</span>     @default null
<span class='line'>2419</span>   */</span><span class="WHIT">
<span class='line'>2420</span> </span><span class="WHIT">  </span><span class="NAME">proposedDropOperation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2421</span> 
<span class='line'>2422</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>2423</span>     mouseDragged event handler.  Initiates a drag if the following conditions
<span class='line'>2424</span>     are met:
<span class='line'>2425</span> 
<span class='line'>2426</span>     - collectionViewShouldBeginDrag() returns YES *OR*
<span class='line'>2427</span>     - the above method is not implemented and canReorderContent is true.
<span class='line'>2428</span>     - the dragDataTypes property returns a non-empty array
<span class='line'>2429</span>     - a mouse down event was saved by the mouseDown method.
<span class='line'>2430</span>   */</span><span class="WHIT">
<span class='line'>2431</span> </span><span class="WHIT">  </span><span class="NAME">mouseDragged</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2432</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2433</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2434</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2435</span> </span><span class="WHIT">        </span><span class="NAME">info</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseDownInfo</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2436</span> </span><span class="WHIT">        </span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'_contentGroupIndexes'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2437</span> </span><span class="WHIT">        </span><span class="NAME">dragContent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragDataTypes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragView</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2438</span> 
<span class='line'>2439</span> </span><span class="WHIT">    </span><span class="COMM">// if the mouse down event was cleared, there is nothing to do; return.</span><span class="WHIT">
<span class='line'>2440</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">info.contentIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2441</span> 
<span class='line'>2442</span> </span><span class="WHIT">    </span><span class="COMM">// Don't do anything unless the user has been dragging for 123msec</span><span class="WHIT">
<span class='line'>2443</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Date.now</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">info.at</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">123</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2444</span> 
<span class='line'>2445</span> </span><span class="WHIT">    </span><span class="COMM">// OK, they must be serious, decide if a drag will be allowed.</span><span class="WHIT">
<span class='line'>2446</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">del.collectionViewShouldBeginDrag</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2447</span> 
<span class='line'>2448</span> </span><span class="WHIT">      </span><span class="COMM">// First, get the selection to drag.  Drag an array of selected</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">      </span><span class="COMM">// items appearing in this collection, in the order of the</span><span class="WHIT">
<span class='line'>2450</span> </span><span class="WHIT">      </span><span class="COMM">// collection.</span><span class="WHIT">
<span class='line'>2451</span> </span><span class="WHIT">      </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">      </span><span class="COMM">// Compute the dragContent - the indexes we will be dragging.</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">      </span><span class="COMM">// if we don't select on mouse down, then the selection has not been</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">      </span><span class="COMM">// updated to whatever the user clicked.  Instead use</span><span class="WHIT">
<span class='line'>2455</span> </span><span class="WHIT">      </span><span class="COMM">// mouse down content.</span><span class="WHIT">
<span class='line'>2456</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">"selectOnMouseDown"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="WHIT">        </span><span class="NAME">dragContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">info.contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2458</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">dragContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.indexSetForSource</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2459</span> 
<span class='line'>2460</span> </span><span class="WHIT">      </span><span class="COMM">// remove any group indexes.  groups cannot be dragged.</span><span class="WHIT">
<span class='line'>2461</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragContent</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">groupIndexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2462</span> </span><span class="WHIT">        </span><span class="NAME">dragContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragContent.copy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="NAME">groupIndexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2463</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragContent.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dragContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2464</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">dragContent.freeze</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2465</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2466</span> 
<span class='line'>2467</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dragContent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to drag</span><span class="WHIT">
<span class='line'>2468</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">dragContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragContent.frozenCopy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// so it doesn't change</span><span class="WHIT">
<span class='line'>2469</span> 
<span class='line'>2470</span> </span><span class="WHIT">      </span><span class="NAME">dragContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dragContent</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2471</span> </span><span class="WHIT">      </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'dragContent'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2472</span> 
<span class='line'>2473</span> </span><span class="WHIT">      </span><span class="COMM">// Get the set of data types supported by the delegate.  If this returns</span><span class="WHIT">
<span class='line'>2474</span> </span><span class="WHIT">      </span><span class="COMM">// a null or empty array and reordering content is not also supported</span><span class="WHIT">
<span class='line'>2475</span> </span><span class="WHIT">      </span><span class="COMM">// then do not start the drag.</span><span class="WHIT">
<span class='line'>2476</span> </span><span class="WHIT">      </span><span class="NAME">dragDataTypes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'dragDataTypes'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragDataTypes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">dragDataTypes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2478</span> 
<span class='line'>2479</span> </span><span class="WHIT">        </span><span class="COMM">// Build the drag view to use for the ghost drag.  This</span><span class="WHIT">
<span class='line'>2480</span> </span><span class="WHIT">        </span><span class="COMM">// should essentially contain any visible drag items.</span><span class="WHIT">
<span class='line'>2481</span> </span><span class="WHIT">        </span><span class="NAME">dragView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewDragViewFor</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragContent.indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2482</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dragView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dragView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._cv_dragViewFor</span><span class="PUNC">(</span><span class="NAME">dragContent.indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2483</span> 
<span class='line'>2484</span> </span><span class="WHIT">        </span><span class="COMM">// Initiate the drag</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="WHIT">        </span><span class="NAME">SC.Drag.start</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2486</span> </span><span class="WHIT">          </span><span class="NAME">event</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">info.event</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">          </span><span class="NAME">source</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="WHIT">          </span><span class="NAME">dragView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dragView</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2489</span> </span><span class="WHIT">          </span><span class="NAME">ghost</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2490</span> </span><span class="WHIT">          </span><span class="NAME">ghostActsLikeCursor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">del.ghostActsLikeCursor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2491</span> </span><span class="WHIT">          </span><span class="NAME">slideBack</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2492</span> </span><span class="WHIT">          </span><span class="NAME">dataSource</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2494</span> 
<span class='line'>2495</span> </span><span class="WHIT">        </span><span class="COMM">// Also use this opportunity to clean up since mouseUp won't</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="WHIT">        </span><span class="COMM">// get called.</span><span class="WHIT">
<span class='line'>2497</span> </span><span class="WHIT">        </span><span class="NAME">this._cleanupMouseDown</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2498</span> </span><span class="WHIT">        </span><span class="NAME">this._lastInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2499</span> 
<span class='line'>2500</span> </span><span class="WHIT">      </span><span class="COMM">// Drag was not allowed by the delegate, so bail.</span><span class="WHIT">
<span class='line'>2501</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'dragContent'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2502</span> 
<span class='line'>2503</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2504</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2505</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2506</span> 
<span class='line'>2507</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>2508</span>     Compute a default drag view by grabbing the raw layers and inserting them
<span class='line'>2509</span>     into a drag view.
<span class='line'>2510</span>   */</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">  </span><span class="NAME">_cv_dragViewFor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragContent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">    </span><span class="COMM">// find only the indexes that are in both dragContent and nowShowing.</span><span class="WHIT">
<span class='line'>2513</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">without</span><span class="PUNC">(</span><span class="NAME">dragContent</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="WHIT">        </span><span class="NAME">dragLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'layer'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cloneNode</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2515</span> </span><span class="WHIT">        </span><span class="NAME">view</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.View.create</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dragLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2516</span> </span><span class="WHIT">        </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">layout</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2517</span> 
<span class='line'>2518</span> </span><span class="WHIT">    </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">without</span><span class="PUNC">(</span><span class="NAME">indexes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2519</span> 
<span class='line'>2520</span> </span><span class="WHIT">    </span><span class="COMM">// cleanup weird stuff that might make the drag look out of place</span><span class="WHIT">
<span class='line'>2521</span> </span><span class="WHIT">    </span><span class="NAME">SC.$</span><span class="PUNC">(</span><span class="NAME">dragLayer</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="STRN">'backgroundColor'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'transparent'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2522</span> </span><span class="WHIT">      </span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="STRN">'border'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'none'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2523</span> </span><span class="WHIT">      </span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="STRN">'top'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="STRN">'left'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2524</span> 
<span class='line'>2525</span> </span><span class="WHIT">    </span><span class="NAME">indexes.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2526</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">          </span><span class="NAME">isSelected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2528</span> 
<span class='line'>2529</span> </span><span class="WHIT">      </span><span class="COMM">// render item view without isSelected state.</span><span class="WHIT">
<span class='line'>2530</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2531</span> </span><span class="WHIT">        </span><span class="NAME">isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="WHIT">        </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2533</span> 
<span class='line'>2534</span> </span><span class="WHIT">        </span><span class="NAME">itemView.updateLayerIfNeeded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2535</span> </span><span class="WHIT">        </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'layer'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2536</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">layer.cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2537</span> 
<span class='line'>2538</span> </span><span class="WHIT">        </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isSelected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2539</span> </span><span class="WHIT">        </span><span class="NAME">itemView.updateLayerIfNeeded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2540</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2541</span> 
<span class='line'>2542</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2543</span> </span><span class="WHIT">        </span><span class="NAME">dragLayer.appendChild</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2544</span> </span><span class="WHIT">        </span><span class="NAME">layout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'layout'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2545</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layout.height</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">layout.top</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2546</span> </span><span class="WHIT">          </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">layout.height</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">layout.top</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2547</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2548</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="WHIT">      </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2550</span> 
<span class='line'>2551</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2552</span> </span><span class="WHIT">    </span><span class="COMM">// we don't want to show the scrollbars, resize the dragview'</span><span class="WHIT">
<span class='line'>2553</span> </span><span class="WHIT">    </span><span class="NAME">view.set</span><span class="PUNC">(</span><span class="STRN">'layout'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2554</span> 
<span class='line'>2555</span> </span><span class="WHIT">    </span><span class="NAME">dragLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2556</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">view</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2557</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2558</span> 
<span class='line'>2559</span> 
<span class='line'>2560</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2561</span>     Implements the drag data source protocol for the collection view.  This
<span class='line'>2562</span>     property will consult the collection view delegate if one is provided. It
<span class='line'>2563</span>     will also do the right thing if you have set canReorderContent to YES.
<span class='line'>2564</span> 
<span class='line'>2565</span>     @field
<span class='line'>2566</span>     @type Array
<span class='line'>2567</span>   */</span><span class="WHIT">
<span class='line'>2568</span> </span><span class="WHIT">  </span><span class="NAME">dragDataTypes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2569</span> </span><span class="WHIT">    </span><span class="COMM">// consult delegate.</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewDragDataTypes</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2572</span> </span><span class="WHIT">        </span><span class="NAME">key</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2573</span> 
<span class='line'>2574</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2575</span> </span><span class="WHIT">      </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ret.copy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2576</span> </span><span class="WHIT">      </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'reorderDataType'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2577</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret.indexOf</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ret.push</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2578</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2579</span> 
<span class='line'>2580</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2581</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2582</span> 
<span class='line'>2583</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2584</span>     Implements the drag data source protocol method. The implementation of
<span class='line'>2585</span>     this method will consult the collection view delegate if one has been
<span class='line'>2586</span>     provided.  It also respects the canReorderContent method.
<span class='line'>2587</span>   */</span><span class="WHIT">
<span class='line'>2588</span> </span><span class="WHIT">  </span><span class="NAME">dragDataForType</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2589</span> 
<span class='line'>2590</span> </span><span class="WHIT">    </span><span class="COMM">// if this is a reorder, then return drag content.</span><span class="WHIT">
<span class='line'>2591</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2592</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'reorderDataType'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2593</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'dragContent'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2594</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2595</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2596</span> 
<span class='line'>2597</span> </span><span class="WHIT">    </span><span class="COMM">// otherwise, just pass along to the delegate</span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2599</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">del.collectionViewDragDataForType</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2600</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2601</span> 
<span class='line'>2602</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2603</span>     Implements the SC.DropTarget interface.  The default implementation will
<span class='line'>2604</span>     consult the collection view delegate, if you implement those methods.
<span class='line'>2605</span> 
<span class='line'>2606</span>     This method is called once when the drag enters the view area.  It's
<span class='line'>2607</span>     return value will be stored on the drag object as allowedDragOperations,
<span class='line'>2608</span>     possibly further constrained by the drag source.
<span class='line'>2609</span> 
<span class='line'>2610</span>     @param {SC.Drag} drag the drag object
<span class='line'>2611</span>     @param {SC.Event} evt the event triggering this change, if available
<span class='line'>2612</span>     @returns {Number} logical OR'd mask of allowed drag operations.
<span class='line'>2613</span>   */</span><span class="WHIT">
<span class='line'>2614</span> </span><span class="WHIT">  </span><span class="NAME">computeDragOperations</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2615</span> </span><span class="WHIT">    </span><span class="COMM">// the proposed drag operation is DRAG_REORDER only if we can reorder</span><span class="WHIT">
<span class='line'>2616</span> </span><span class="WHIT">    </span><span class="COMM">// content and the drag contains reorder content.</span><span class="WHIT">
<span class='line'>2617</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">op</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_NONE</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2618</span> </span><span class="WHIT">        </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2619</span> 
<span class='line'>2620</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2621</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drag.get</span><span class="PUNC">(</span><span class="STRN">'dataTypes'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'reorderDataType'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2622</span> </span><span class="WHIT">        </span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_REORDER</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2623</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2624</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2625</span> 
<span class='line'>2626</span> </span><span class="WHIT">    </span><span class="COMM">// Now pass this onto the delegate.</span><span class="WHIT">
<span class='line'>2627</span> </span><span class="WHIT">    </span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewComputeDragOperations</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2628</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_REORDER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_MOVE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2629</span> 
<span class='line'>2630</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2631</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2632</span> 
<span class='line'>2633</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>2634</span>     Determines the allowed drop operation insertion point, operation type,
<span class='line'>2635</span>     and the drag operation to be performed.  Used by dragUpdated() and
<span class='line'>2636</span>     performDragOperation().
<span class='line'>2637</span> 
<span class='line'>2638</span>     @param {SC.Drag} drag the drag object
<span class='line'>2639</span>     @param {SC.Event} evt source of this request, if available
<span class='line'>2640</span>     @param {Number} dragOp allowed drag operation mask
<span class='line'>2641</span>     Returns three params: [drop index, drop operation, allowed drag ops]
<span class='line'>2642</span>   */</span><span class="WHIT">
<span class='line'>2643</span> </span><span class="WHIT">  </span><span class="NAME">_computeDropOperationState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2644</span> </span><span class="WHIT">    </span><span class="COMM">// get the insertion index for this location.  This can be computed</span><span class="WHIT">
<span class='line'>2645</span> </span><span class="WHIT">    </span><span class="COMM">// by a subclass using whatever method.  This method is not expected to</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="WHIT">    </span><span class="COMM">// do any data validation, just to map the location to an insertion</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="WHIT">    </span><span class="COMM">// index.</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.convertFrameFromView</span><span class="PUNC">(</span><span class="NAME">drag.get</span><span class="PUNC">(</span><span class="STRN">'location'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2649</span> </span><span class="WHIT">        </span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.DROP_BEFORE</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2650</span> </span><span class="WHIT">        </span><span class="NAME">del</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2651</span> </span><span class="WHIT">        </span><span class="NAME">canReorder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2652</span> </span><span class="WHIT">        </span><span class="NAME">objects</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isPreviousInDrag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isNextInDrag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2653</span> 
<span class='line'>2654</span> </span><span class="WHIT">    </span><span class="COMM">// STEP 1: Try with a DROP_ON option -- send straight to delegate if</span><span class="WHIT">
<span class='line'>2655</span> </span><span class="WHIT">    </span><span class="COMM">// supported by view.</span><span class="WHIT">
<span class='line'>2656</span> 
<span class='line'>2657</span> </span><span class="WHIT">    </span><span class="COMM">// get the computed insertion index and possibly drop operation.</span><span class="WHIT">
<span class='line'>2658</span> </span><span class="WHIT">    </span><span class="COMM">// prefer to drop ON.</span><span class="WHIT">
<span class='line'>2659</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.insertionIndexForLocation</span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.DROP_ON</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2660</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_ARRAY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2661</span> </span><span class="WHIT">      </span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// order matters here</span><span class="WHIT">
<span class='line'>2662</span> </span><span class="WHIT">      </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2663</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2664</span> 
<span class='line'>2665</span> </span><span class="WHIT">    </span><span class="COMM">// if the return drop operation is DROP_ON, then just check it with the</span><span class="WHIT">
<span class='line'>2666</span> </span><span class="WHIT">    </span><span class="COMM">// delegate method.  If the delegate method does not support dropping on,</span><span class="WHIT">
<span class='line'>2667</span> </span><span class="WHIT">    </span><span class="COMM">// then it will return DRAG_NONE, in which case we will try again with</span><span class="WHIT">
<span class='line'>2668</span> </span><span class="WHIT">    </span><span class="COMM">// drop before.</span><span class="WHIT">
<span class='line'>2669</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.DROP_ON</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2670</span> 
<span class='line'>2671</span> </span><span class="WHIT">      </span><span class="COMM">// Now save the insertion index and the dropOp.  This may be changed by</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="WHIT">      </span><span class="COMM">// the collection delegate.</span><span class="WHIT">
<span class='line'>2673</span> </span><span class="WHIT">      </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'proposedInsertionIndex'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2674</span> </span><span class="WHIT">      </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'proposedDropOperation'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2675</span> </span><span class="WHIT">      </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewValidateDragOperation</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2676</span> </span><span class="WHIT">      </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'proposedInsertionIndex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2677</span> </span><span class="WHIT">      </span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'proposedDropOperation'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2678</span> </span><span class="WHIT">      </span><span class="NAME">this._dropInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._dropOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2679</span> 
<span class='line'>2680</span> </span><span class="WHIT">      </span><span class="COMM">// The delegate is OK with a drop on also, so just return.</span><span class="WHIT">
<span class='line'>2681</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_NONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2682</span> 
<span class='line'>2683</span> </span><span class="WHIT">      </span><span class="COMM">// The delegate is NOT OK with a drop on, try to get the insertion</span><span class="WHIT">
<span class='line'>2684</span> </span><span class="WHIT">      </span><span class="COMM">// index again, but this time prefer SC.DROP_BEFORE, then let the</span><span class="WHIT">
<span class='line'>2685</span> </span><span class="WHIT">      </span><span class="COMM">// rest of the method run...</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2687</span> </span><span class="WHIT">        </span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.DROP_BEFORE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2688</span> </span><span class="WHIT">        </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.insertionIndexForLocation</span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.DROP_BEFORE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2689</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_ARRAY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2690</span> </span><span class="WHIT">          </span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// order matters here</span><span class="WHIT">
<span class='line'>2691</span> </span><span class="WHIT">          </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2692</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2693</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2694</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2695</span> 
<span class='line'>2696</span> </span><span class="WHIT">    </span><span class="COMM">// if this is a reorder drag, set the proposed op to SC.DRAG_REORDER and</span><span class="WHIT">
<span class='line'>2697</span> </span><span class="WHIT">    </span><span class="COMM">// validate the insertion point.  This only works if the insertion point</span><span class="WHIT">
<span class='line'>2698</span> </span><span class="WHIT">    </span><span class="COMM">// is DROP_BEFORE or DROP_AFTER.  DROP_ON is not handled by reordering</span><span class="WHIT">
<span class='line'>2699</span> </span><span class="WHIT">    </span><span class="COMM">// content.</span><span class="WHIT">
<span class='line'>2700</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">canReorder</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">SC.DROP_ON</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2701</span> 
<span class='line'>2702</span> </span><span class="WHIT">      </span><span class="NAME">objects</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drag.dataForType</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'reorderDataType'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2703</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">objects</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2704</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2705</span> 
<span class='line'>2706</span> </span><span class="WHIT">        </span><span class="COMM">// if the insertion index is in between two items in the drag itself,</span><span class="WHIT">
<span class='line'>2707</span> </span><span class="WHIT">        </span><span class="COMM">// then this is not allowed.  Either use the last insertion index or</span><span class="WHIT">
<span class='line'>2708</span> </span><span class="WHIT">        </span><span class="COMM">// find the first index that is not in between selections.  Stop when</span><span class="WHIT">
<span class='line'>2709</span> </span><span class="WHIT">        </span><span class="COMM">// we get to the beginning.</span><span class="WHIT">
<span class='line'>2710</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.DROP_BEFORE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2711</span> </span><span class="WHIT">          </span><span class="NAME">isPreviousInDrag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objects.indexes.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2712</span> </span><span class="WHIT">          </span><span class="NAME">isNextInDrag</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objects.indexes.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2713</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2714</span> </span><span class="WHIT">          </span><span class="NAME">isPreviousInDrag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objects.indexes.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2715</span> </span><span class="WHIT">          </span><span class="NAME">isNextInDrag</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objects.indexes.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2716</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2717</span> 
<span class='line'>2718</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isPreviousInDrag</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isNextInDrag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2719</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">this._lastInsertionIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2720</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.DROP_BEFORE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2721</span> </span><span class="WHIT">              </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">objects.indexes.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2722</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2723</span> </span><span class="WHIT">              </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2724</span> </span><span class="WHIT">              </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">objects.indexes.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2725</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2726</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._lastInsertionIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2727</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2728</span> 
<span class='line'>2729</span> </span><span class="WHIT">        </span><span class="COMM">// If we found a valid insertion point to reorder at, then set the op</span><span class="WHIT">
<span class='line'>2730</span> </span><span class="WHIT">        </span><span class="COMM">// to custom DRAG_REORDER.</span><span class="WHIT">
<span class='line'>2731</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_REORDER</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2732</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2733</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2734</span> 
<span class='line'>2735</span> </span><span class="WHIT">    </span><span class="COMM">// Now save the insertion index and the dropOp.  This may be changed by</span><span class="WHIT">
<span class='line'>2736</span> </span><span class="WHIT">    </span><span class="COMM">// the collection delegate.</span><span class="WHIT">
<span class='line'>2737</span> </span><span class="WHIT">    </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'proposedInsertionIndex'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2738</span> </span><span class="WHIT">    </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'proposedDropOperation'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2739</span> </span><span class="WHIT">    </span><span class="NAME">dragOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewValidateDragOperation</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">    </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'proposedInsertionIndex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">    </span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'proposedDropOperation'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2742</span> </span><span class="WHIT">    </span><span class="NAME">this._dropInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._dropOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2743</span> 
<span class='line'>2744</span> </span><span class="WHIT">    </span><span class="COMM">// return generated state</span><span class="WHIT">
<span class='line'>2745</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2746</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2747</span> 
<span class='line'>2748</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2749</span>     Implements the SC.DropTarget interface.  The default implementation will
<span class='line'>2750</span>     determine the drop location and then consult the collection view delegate
<span class='line'>2751</span>     if you implement those methods.  Otherwise it will handle reordering
<span class='line'>2752</span>     content on its own.
<span class='line'>2753</span> 
<span class='line'>2754</span>     @param {SC.Drag} drag The drag that was updated
<span class='line'>2755</span>     @param {SC.Event} evt The event for the drag
<span class='line'>2756</span>   */</span><span class="WHIT">
<span class='line'>2757</span> </span><span class="WHIT">  </span><span class="NAME">dragUpdated</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2758</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">op</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drag.get</span><span class="PUNC">(</span><span class="STRN">'allowedDragOperations'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2759</span> </span><span class="WHIT">        </span><span class="NAME">state</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._computeDropOperationState</span><span class="PUNC">(</span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2760</span> </span><span class="WHIT">        </span><span class="NAME">idx</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2761</span> 
<span class='line'>2762</span> </span><span class="WHIT">    </span><span class="COMM">// if the insertion index or dropOp have changed, update the insertion</span><span class="WHIT">
<span class='line'>2763</span> </span><span class="WHIT">    </span><span class="COMM">// point</span><span class="WHIT">
<span class='line'>2764</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragOp</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_NONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2765</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this._lastInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._lastDropOperation</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2766</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2767</span> </span><span class="WHIT">        </span><span class="NAME">this.showInsertionPoint</span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2768</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2769</span> 
<span class='line'>2770</span> </span><span class="WHIT">      </span><span class="NAME">this._lastInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2771</span> </span><span class="WHIT">      </span><span class="NAME">this._lastDropOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2772</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2773</span> </span><span class="WHIT">      </span><span class="NAME">this.hideInsertionPoint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2774</span> </span><span class="WHIT">      </span><span class="NAME">this._lastInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._lastDropOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2775</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2776</span> 
<span class='line'>2777</span> </span><span class="WHIT">    </span><span class="COMM">// Normalize drag operation to the standard kinds accepted by the drag</span><span class="WHIT">
<span class='line'>2778</span> </span><span class="WHIT">    </span><span class="COMM">// system.</span><span class="WHIT">
<span class='line'>2779</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragOp</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_REORDER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_MOVE</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2780</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2781</span> 
<span class='line'>2782</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2783</span>     Implements the SC.DropTarget protocol.  Hides any visible insertion
<span class='line'>2784</span>     point and clears some cached values. 
<span class='line'>2785</span>   */</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="WHIT">  </span><span class="NAME">dragExited</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">    </span><span class="NAME">this.hideInsertionPoint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">    </span><span class="NAME">this._lastInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._lastDropOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2789</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2790</span> 
<span class='line'>2791</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2792</span>     Implements the SC.DropTarget protocol.  Hides any visible insertion
<span class='line'>2793</span>     point and clears some cached values.
<span class='line'>2794</span>   */</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">  </span><span class="NAME">dragEnded</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="WHIT">    </span><span class="NAME">this.hideInsertionPoint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="WHIT">    </span><span class="NAME">this._lastInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._lastDropOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2798</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2799</span> 
<span class='line'>2800</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2801</span>     Implements the SC.DropTarget protocol.
<span class='line'>2802</span> 
<span class='line'>2803</span>     @returns {Boolean} YES
<span class='line'>2804</span>   */</span><span class="WHIT">
<span class='line'>2805</span> </span><span class="WHIT">  </span><span class="NAME">acceptDragOperation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2806</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2807</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2808</span> 
<span class='line'>2809</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2810</span>     Implements the SC.DropTarget protocol. Consults the collection view
<span class='line'>2811</span>     delegate to actually perform the operation unless the operation is
<span class='line'>2812</span>     reordering content.
<span class='line'>2813</span> 
<span class='line'>2814</span>     @param {SC.Drag} drag The drag to perform the operation on
<span class='line'>2815</span>     @param {Number} op The drag operation to perform
<span class='line'>2816</span>     @return {Number} The operation performed
<span class='line'>2817</span>   */</span><span class="WHIT">
<span class='line'>2818</span> </span><span class="WHIT">  </span><span class="NAME">performDragOperation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2819</span> </span><span class="WHIT">    </span><span class="COMM">// Get the correct insertion point, drop operation, etc.</span><span class="WHIT">
<span class='line'>2820</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._computeDropOperationState</span><span class="PUNC">(</span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2821</span> </span><span class="WHIT">        </span><span class="NAME">idx</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2822</span> </span><span class="WHIT">        </span><span class="NAME">del</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selectionDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2823</span> </span><span class="WHIT">        </span><span class="NAME">performed</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">objects</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">shift</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2824</span> 
<span class='line'>2825</span> </span><span class="WHIT">    </span><span class="COMM">// The dragOp is the kinds of ops allowed.  The drag operation must</span><span class="WHIT">
<span class='line'>2826</span> </span><span class="WHIT">    </span><span class="COMM">// be included in that set.</span><span class="WHIT">
<span class='line'>2827</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragOp</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_REORDER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2828</span> </span><span class="WHIT">      </span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_MOVE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_REORDER</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2829</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">dragOp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2830</span> 
<span class='line'>2831</span> </span><span class="WHIT">    </span><span class="COMM">// If no allowed drag operation could be found, just return.</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_NONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2833</span> 
<span class='line'>2834</span> </span><span class="WHIT">    </span><span class="COMM">// Some operation is allowed through, give the delegate a chance to</span><span class="WHIT">
<span class='line'>2835</span> </span><span class="WHIT">    </span><span class="COMM">// handle it.</span><span class="WHIT">
<span class='line'>2836</span> </span><span class="WHIT">    </span><span class="NAME">performed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.collectionViewPerformDragOperation</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2837</span> 
<span class='line'>2838</span> </span><span class="WHIT">    </span><span class="COMM">// If the delegate did not handle the drag (i.e. returned SC.DRAG_NONE),</span><span class="WHIT">
<span class='line'>2839</span> </span><span class="WHIT">    </span><span class="COMM">// and the op type is REORDER, then do the reorder here.</span><span class="WHIT">
<span class='line'>2840</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">performed</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_NONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_REORDER</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2841</span> 
<span class='line'>2842</span> </span><span class="WHIT">      </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drag.dataForType</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'reorderDataType'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2843</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2844</span> 
<span class='line'>2845</span> </span><span class="WHIT">      </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2846</span> 
<span class='line'>2847</span> </span><span class="WHIT">      </span><span class="COMM">// check for special case - inserting BEFORE ourself...</span><span class="WHIT">
<span class='line'>2848</span> </span><span class="WHIT">      </span><span class="COMM">// in this case just pretend the move happened since it's a no-op</span><span class="WHIT">
<span class='line'>2849</span> </span><span class="WHIT">      </span><span class="COMM">// anyway</span><span class="WHIT">
<span class='line'>2850</span> </span><span class="WHIT">      </span><span class="NAME">indexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.indexes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2851</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2852</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.DROP_BEFORE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.DROP_AFTER</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>2853</span> </span><span class="WHIT">            </span><span class="PUNC">(</span><span class="NAME">indexes.get</span><span class="PUNC">(</span><span class="STRN">'min'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_MOVE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2854</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2855</span> 
<span class='line'>2856</span> </span><span class="WHIT">      </span><span class="NAME">content.beginPropertyChanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// suspend notifications</span><span class="WHIT">
<span class='line'>2857</span> 
<span class='line'>2858</span> </span><span class="WHIT">      </span><span class="COMM">// get each object, then remove it from the content. they will be</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">      </span><span class="COMM">// added again later.</span><span class="WHIT">
<span class='line'>2860</span> </span><span class="WHIT">      </span><span class="NAME">objects</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2861</span> </span><span class="WHIT">      </span><span class="NAME">shift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2862</span> </span><span class="WHIT">      </span><span class="NAME">data.indexes.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2863</span> </span><span class="WHIT">        </span><span class="NAME">objects.push</span><span class="PUNC">(</span><span class="NAME">content.objectAt</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">shift</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2864</span> </span><span class="WHIT">        </span><span class="NAME">content.removeAt</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">shift</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2865</span> </span><span class="WHIT">        </span><span class="NAME">shift</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2866</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2867</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2868</span> 
<span class='line'>2869</span> </span><span class="WHIT">      </span><span class="COMM">// now insert objects into new insertion location</span><span class="WHIT">
<span class='line'>2870</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dropOp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.DROP_AFTER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2871</span> </span><span class="WHIT">      </span><span class="NAME">content.replace</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">objects</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2872</span> </span><span class="WHIT">      </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">objects.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2873</span> </span><span class="WHIT">      </span><span class="NAME">content.endPropertyChanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// restart notifications</span><span class="WHIT">
<span class='line'>2874</span> 
<span class='line'>2875</span> </span><span class="WHIT">      </span><span class="COMM">// make the op into its actual value</span><span class="WHIT">
<span class='line'>2876</span> </span><span class="WHIT">      </span><span class="NAME">op</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.DRAG_MOVE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2877</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2878</span> 
<span class='line'>2879</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">op</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2880</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2881</span> 
<span class='line'>2882</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2883</span>     Default delegate method implementation, returns YES if canReorderContent
<span class='line'>2884</span>     is also true.
<span class='line'>2885</span> 
<span class='line'>2886</span>     @param {SC.View} view
<span class='line'>2887</span>   */</span><span class="WHIT">
<span class='line'>2888</span> </span><span class="WHIT">  </span><span class="NAME">collectionViewShouldBeginDrag</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2889</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2890</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2891</span> 
<span class='line'>2892</span> 
<span class='line'>2893</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>2894</span> </span><span class="WHIT">  </span><span class="COMM">// INSERTION POINT</span><span class="WHIT">
<span class='line'>2895</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2896</span> 
<span class='line'>2897</span> 
<span class='line'>2898</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2899</span>     Get the preferred insertion point for the given location, including
<span class='line'>2900</span>     an insertion preference of before, after or on the named index.
<span class='line'>2901</span> 
<span class='line'>2902</span>     You can implement this method in a subclass if you like to perform a
<span class='line'>2903</span>     more efficient check.  The default implementation will loop through the
<span class='line'>2904</span>     item views looking for the first view to "switch sides" in the orientation
<span class='line'>2905</span>     you specify.
<span class='line'>2906</span> 
<span class='line'>2907</span>     This method should return an array with two values.  The first value is
<span class='line'>2908</span>     the insertion point index and the second value is the drop operation,
<span class='line'>2909</span>     which should be one of SC.DROP_BEFORE, SC.DROP_AFTER, or SC.DROP_ON.
<span class='line'>2910</span> 
<span class='line'>2911</span>     The preferred drop operation passed in should be used as a hint as to
<span class='line'>2912</span>     the type of operation the view would prefer to receive. If the
<span class='line'>2913</span>     dropOperation is SC.DROP_ON, then you should return a DROP_ON mode if
<span class='line'>2914</span>     possible.  Otherwise, you should never return DROP_ON.
<span class='line'>2915</span> 
<span class='line'>2916</span>     For compatibility, you can also return just the insertion index.  If you
<span class='line'>2917</span>     do this, then the collection view will assume the drop operation is
<span class='line'>2918</span>     SC.DROP_BEFORE.
<span class='line'>2919</span> 
<span class='line'>2920</span>     If an insertion is NOT allowed, you should return -1 as the insertion
<span class='line'>2921</span>     point.  In this case, the drop operation will be ignored.
<span class='line'>2922</span> 
<span class='line'>2923</span>     @param {Point} loc the mouse location.
<span class='line'>2924</span>     @param {DropOp} dropOperation the preferred drop operation.
<span class='line'>2925</span>     @returns {Array} format: [index, op]
<span class='line'>2926</span>   */</span><span class="WHIT">
<span class='line'>2927</span> </span><span class="WHIT">  </span><span class="NAME">insertionIndexForLocation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOperation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2928</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2929</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2930</span> 
<span class='line'>2931</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>2932</span> </span><span class="WHIT">  </span><span class="COMM">// SCROLLING</span><span class="WHIT">
<span class='line'>2933</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2934</span> 
<span class='line'>2935</span> </span><span class="WHIT">  </span><span class="COMM">/** @private SC.ScrollView */</span><span class="WHIT">
<span class='line'>2936</span> </span><span class="WHIT">  </span><span class="NAME">touchScrollDidStart</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2937</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clippingFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'clippingFrame'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2938</span> 
<span class='line'>2939</span> </span><span class="WHIT">    </span><span class="COMM">// Create the in-scroll clipping frame that will be used while touch scrolling.</span><span class="WHIT">
<span class='line'>2940</span> </span><span class="WHIT">    </span><span class="NAME">this._inScrollClippingFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2941</span> </span><span class="WHIT">      </span><span class="NAME">x</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clippingFrame.x</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">      </span><span class="NAME">y</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clippingFrame.y</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2943</span> </span><span class="WHIT">      </span><span class="NAME">width</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clippingFrame.width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2944</span> </span><span class="WHIT">      </span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clippingFrame.height</span><span class="WHIT">
<span class='line'>2945</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2946</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2947</span> 
<span class='line'>2948</span> </span><span class="WHIT">  </span><span class="COMM">/** @private SC.ScrollView */</span><span class="WHIT">
<span class='line'>2949</span> </span><span class="WHIT">  </span><span class="NAME">touchScrollDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2950</span> </span><span class="WHIT">    </span><span class="COMM">// Fast path!  Don't try to update too soon.</span><span class="WHIT">
<span class='line'>2951</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Date.now</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this._lastTouchScrollTime</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2952</span> 
<span class='line'>2953</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inScrollClippingFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._inScrollClippingFrame</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2954</span> 
<span class='line'>2955</span> </span><span class="WHIT">    </span><span class="COMM">// Update the in-scroll clipping frame with the new values.</span><span class="WHIT">
<span class='line'>2956</span> </span><span class="WHIT">    </span><span class="NAME">inScrollClippingFrame.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2957</span> </span><span class="WHIT">    </span><span class="NAME">inScrollClippingFrame.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2958</span> 
<span class='line'>2959</span> </span><span class="WHIT">    </span><span class="COMM">// Indicate that nowShowing should be re-computed (this will use the</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">    </span><span class="COMM">// in-scroll clipping frame when it does).</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">    </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2962</span> </span><span class="WHIT">    </span><span class="NAME">this.invokeOnce</span><span class="PUNC">(</span><span class="STRN">'_cv_nowShowingDidChange'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2963</span> 
<span class='line'>2964</span> </span><span class="WHIT">    </span><span class="COMM">// Track the last time we updated.</span><span class="WHIT">
<span class='line'>2965</span> </span><span class="WHIT">    </span><span class="NAME">this._lastTouchScrollTime</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Date.now</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2966</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2967</span> 
<span class='line'>2968</span> </span><span class="WHIT">  </span><span class="COMM">/** @private SC.ScrollView */</span><span class="WHIT">
<span class='line'>2969</span> </span><span class="WHIT">  </span><span class="NAME">touchScrollDidEnd</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2970</span> </span><span class="WHIT">    </span><span class="COMM">// Clean up so that the regular clippingFrame is used again.</span><span class="WHIT">
<span class='line'>2971</span> </span><span class="WHIT">    </span><span class="NAME">this._inScrollClippingFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2972</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2973</span> 
<span class='line'>2974</span> </span><span class="WHIT">  </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>2975</span> </span><span class="WHIT">  </span><span class="COMM">// INTERNAL SUPPORT</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">  </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2977</span> 
<span class='line'>2978</span> </span><span class="WHIT">  </span><span class="COMM">/** @private - when we are about to become visible, reload if needed. */</span><span class="WHIT">
<span class='line'>2979</span> </span><span class="WHIT">  </span><span class="NAME">willShowInDocument</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2980</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._invalidIndexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.invokeOnce</span><span class="PUNC">(</span><span class="NAME">this.reloadIfNeeded</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2981</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._invalidSelection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2982</span> </span><span class="WHIT">      </span><span class="NAME">this.invokeOnce</span><span class="PUNC">(</span><span class="NAME">this.reloadSelectionIndexesIfNeeded</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2983</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2984</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2985</span> 
<span class='line'>2986</span> </span><span class="WHIT">  </span><span class="COMM">/** @private - when we are added, reload if needed. */</span><span class="WHIT">
<span class='line'>2987</span> </span><span class="WHIT">  </span><span class="NAME">didAppendToDocument</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._invalidIndexes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.invokeOnce</span><span class="PUNC">(</span><span class="NAME">this.reloadIfNeeded</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._invalidSelection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">      </span><span class="NAME">this.invokeOnce</span><span class="PUNC">(</span><span class="NAME">this.reloadSelectionIndexesIfNeeded</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2991</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2992</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2993</span> 
<span class='line'>2994</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2995</span>     Default delegate method implementation, returns YES if isSelectable
<span class='line'>2996</span>     is also true.
<span class='line'>2997</span>   */</span><span class="WHIT">
<span class='line'>2998</span> </span><span class="WHIT">  </span><span class="NAME">collectionViewShouldSelectItem</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isSelectable'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3001</span> 
<span class='line'>3002</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">  </span><span class="NAME">_TMP_DIFF1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3004</span> 
<span class='line'>3005</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>3006</span> </span><span class="WHIT">  </span><span class="NAME">_TMP_DIFF2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3007</span> 
<span class='line'>3008</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3009</span> 
<span class='line'>3010</span>     Whenever the nowShowing range changes, update the range observer on the
<span class='line'>3011</span>     content item and instruct the view to reload any indexes that are not in
<span class='line'>3012</span>     the previous nowShowing range.
<span class='line'>3013</span> 
<span class='line'>3014</span>   */</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="WHIT">  </span><span class="NAME">_cv_nowShowingDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">        </span><span class="NAME">last</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._sccv_lastNowShowing</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3018</span> </span><span class="WHIT">        </span><span class="NAME">diff</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">diff1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">diff2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3019</span> 
<span class='line'>3020</span> </span><span class="WHIT">    </span><span class="COMM">// find the differences between the two</span><span class="WHIT">
<span class='line'>3021</span> </span><span class="WHIT">    </span><span class="COMM">// NOTE: reuse a TMP IndexSet object to avoid creating lots of objects</span><span class="WHIT">
<span class='line'>3022</span> </span><span class="WHIT">    </span><span class="COMM">// during scrolling</span><span class="WHIT">
<span class='line'>3023</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3024</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3025</span> </span><span class="WHIT">        </span><span class="NAME">diff1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._TMP_DIFF1.add</span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="NAME">nowShowing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3026</span> </span><span class="WHIT">        </span><span class="NAME">diff2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._TMP_DIFF2.add</span><span class="PUNC">(</span><span class="NAME">nowShowing</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3027</span> </span><span class="WHIT">        </span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">diff1.add</span><span class="PUNC">(</span><span class="NAME">diff2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3028</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3029</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3030</span> 
<span class='line'>3031</span> </span><span class="WHIT">    </span><span class="COMM">// if nowShowing has actually changed, then update</span><span class="WHIT">
<span class='line'>3032</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">diff.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3033</span> </span><span class="WHIT">      </span><span class="NAME">this._sccv_lastNowShowing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nowShowing</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">nowShowing.frozenCopy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3034</span> </span><span class="WHIT">      </span><span class="NAME">this.updateContentRangeObserver</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3035</span> </span><span class="WHIT">      </span><span class="NAME">this.reload</span><span class="PUNC">(</span><span class="NAME">diff</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3036</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3037</span> 
<span class='line'>3038</span> </span><span class="WHIT">    </span><span class="COMM">// cleanup tmp objects</span><span class="WHIT">
<span class='line'>3039</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diff1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">diff1.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3040</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diff2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">diff2.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3041</span> 
<span class='line'>3042</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3043</span> 
<span class='line'>3044</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>3045</span> </span><span class="WHIT">  </span><span class="NAME">init</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3046</span> </span><span class="WHIT">    </span><span class="NAME">sc_super</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3047</span> 
<span class='line'>3048</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.useFastPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="WHIT">      </span><span class="COMM">//@if(debug)</span><span class="WHIT">
<span class='line'>3050</span> </span><span class="WHIT">      </span><span class="COMM">// Deprecation warning for those that were using SC.CollectionFastPath.</span><span class="WHIT">
<span class='line'>3051</span> </span><span class="WHIT">      </span><span class="NAME">SC.warn</span><span class="PUNC">(</span><span class="STRN">"Developer Warning: SC.CollectionView `useFastPath` has been deprecated.  The performance improvements have been integrated directly into SC.CollectionView as the default behavior.  Please disable the useFastPath property and refer to the SC.CollectionView documentation for more information."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3052</span> </span><span class="WHIT">      </span><span class="COMM">//@endif</span><span class="WHIT">
<span class='line'>3053</span> </span><span class="WHIT">      </span><span class="NAME">this.mixin</span><span class="PUNC">(</span><span class="NAME">SC.CollectionFastPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3054</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3055</span> 
<span class='line'>3056</span> </span><span class="WHIT">    </span><span class="COMM">//@if(debug)</span><span class="WHIT">
<span class='line'>3057</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.willReload</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.didReload</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3058</span> </span><span class="WHIT">      </span><span class="COMM">// Deprecation warning for willReload and didReload.  These don't seem to serve any purpose.</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="WHIT">      </span><span class="NAME">SC.warn</span><span class="PUNC">(</span><span class="STRN">"Developer Warning: SC.CollectionView no longer calls willReload and didReload on its subclasses because it includes item view and layer pooling in itself by default."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3061</span> </span><span class="WHIT">    </span><span class="COMM">//@endif</span><span class="WHIT">
<span class='line'>3062</span> 
<span class='line'>3063</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._cv_canReorderContentDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3064</span> </span><span class="WHIT">    </span><span class="NAME">this._sccv_lastNowShowing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'nowShowing'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3065</span> 
<span class='line'>3066</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._cv_contentDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3067</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._cv_selectionDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3068</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3069</span> 
<span class='line'>3070</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3071</span>     Become a drop target whenever reordering content is enabled.
<span class='line'>3072</span>   */</span><span class="WHIT">
<span class='line'>3073</span> </span><span class="WHIT">  </span><span class="NAME">_cv_canReorderContentDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3074</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3075</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isDropTarget'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'isDropTarget'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3076</span> </span><span class="WHIT">      </span><span class="NAME">SC.Drag.addDropTarget</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3077</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3078</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3079</span> 
<span class='line'>3080</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3081</span>     Fires an action after a selection if enabled.
<span class='line'>3082</span> 
<span class='line'>3083</span>     if actOnSelect is YES, then try to invoke the action, passing the
<span class='line'>3084</span>     current selection (saved as a separate array so that a change in sel
<span class='line'>3085</span>     in the meantime will not be lost)
<span class='line'>3086</span>   */</span><span class="WHIT">
<span class='line'>3087</span> </span><span class="WHIT">  </span><span class="NAME">_cv_performSelectAction</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clickCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3088</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3089</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3090</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">clickCount</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">clickCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3091</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">clickCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'actOnSelect'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3092</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._cv_reselectTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._cv_reselectTimer.invalidate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3093</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel.toArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._cv_actionTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._cv_actionTimer.invalidate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3096</span> </span><span class="WHIT">      </span><span class="NAME">this._cv_actionTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.invokeLater</span><span class="PUNC">(</span><span class="NAME">this._cv_action</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">view</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3097</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3098</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3099</span> 
<span class='line'>3100</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3101</span>     Perform the action.  Supports legacy behavior as well as newer style
<span class='line'>3102</span>     action dispatch.
<span class='line'>3103</span>   */</span><span class="WHIT">
<span class='line'>3104</span> </span><span class="WHIT">  </span><span class="NAME">_cv_action</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3105</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">action</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'action'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3106</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'target'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3107</span> 
<span class='line'>3108</span> </span><span class="WHIT">    </span><span class="NAME">this._cv_actionTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3109</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">action</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3110</span> </span><span class="WHIT">      </span><span class="COMM">// if the action is a function, just call it</span><span class="WHIT">
<span class='line'>3111</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">action</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_FUNCTION</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.action</span><span class="PUNC">(</span><span class="NAME">view</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3112</span> 
<span class='line'>3113</span> </span><span class="WHIT">      </span><span class="COMM">// otherwise, use the new sendAction style</span><span class="WHIT">
<span class='line'>3114</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pane</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'pane'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3115</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pane</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3116</span> </span><span class="WHIT">        </span><span class="NAME">pane.rootResponder.sendAction</span><span class="PUNC">(</span><span class="NAME">action</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pane</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3117</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3118</span> 
<span class='line'>3119</span> </span><span class="WHIT">    </span><span class="COMM">// if no action is specified, then trigger the support action,</span><span class="WHIT">
<span class='line'>3120</span> </span><span class="WHIT">    </span><span class="COMM">// if supported.</span><span class="WHIT">
<span class='line'>3121</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3122</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>3123</span> 
<span class='line'>3124</span> </span><span class="WHIT">    </span><span class="COMM">// if the target view has its own internal action handler,</span><span class="WHIT">
<span class='line'>3125</span> </span><span class="WHIT">    </span><span class="COMM">// trigger that.</span><span class="WHIT">
<span class='line'>3126</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">view._action</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">SC.T_FUNCTION</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3127</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">view._action</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3128</span> 
<span class='line'>3129</span> </span><span class="WHIT">    </span><span class="COMM">// otherwise call the action method to support older styles.</span><span class="WHIT">
<span class='line'>3130</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">view.action</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">SC.T_FUNCTION</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3131</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">view.action</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3132</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3133</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3134</span> 
<span class='line'>3135</span> </span><span class="WHIT">  </span><span class="NAME">_attrsForContentIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3136</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._TMP_ATTRS</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3137</span> </span><span class="WHIT">      </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3138</span> </span><span class="WHIT">      </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3139</span> </span><span class="WHIT">      </span><span class="NAME">isGroupView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._contentIndexIsGroup</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3140</span> </span><span class="WHIT">      </span><span class="NAME">isEditable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canEditContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3141</span> </span><span class="WHIT">      </span><span class="NAME">isReorderable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canReorderContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3142</span> </span><span class="WHIT">      </span><span class="NAME">isDeletable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'canDeleteContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3143</span> </span><span class="WHIT">      </span><span class="NAME">isEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexIsEnabled</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3144</span> </span><span class="WHIT">      </span><span class="NAME">isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexIsSelected</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3145</span> </span><span class="WHIT">      </span><span class="NAME">outlineLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexOutlineLevel</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3146</span> </span><span class="WHIT">      </span><span class="NAME">disclosureState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">del.contentIndexDisclosureState</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3147</span> 
<span class='line'>3148</span> </span><span class="WHIT">    </span><span class="NAME">attrs.contentIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3149</span> </span><span class="WHIT">    </span><span class="NAME">attrs.content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items.objectAt</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3150</span> </span><span class="WHIT">    </span><span class="NAME">attrs.disclosureState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">disclosureState</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3151</span> </span><span class="WHIT">    </span><span class="NAME">attrs.isEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isEnabled</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3152</span> </span><span class="WHIT">    </span><span class="NAME">attrs.isEditable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isEditable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3153</span> </span><span class="WHIT">    </span><span class="NAME">attrs.isReorderable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isReorderable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3154</span> </span><span class="WHIT">    </span><span class="NAME">attrs.isDeletable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isDeletable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3155</span> </span><span class="WHIT">    </span><span class="NAME">attrs.isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isSelected</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3156</span> </span><span class="WHIT">    </span><span class="NAME">attrs.isGroupView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isGroupView</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3157</span> </span><span class="WHIT">    </span><span class="NAME">attrs.layerId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.layerIdFor</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3158</span> </span><span class="WHIT">    </span><span class="NAME">attrs.owner</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attrs.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3159</span> </span><span class="WHIT">    </span><span class="NAME">attrs.page</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.page</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3160</span> </span><span class="WHIT">    </span><span class="NAME">attrs.outlineLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">outlineLevel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3161</span> 
<span class='line'>3162</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isGroupView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">attrs.classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._GROUP_COLLECTION_CLASS_NAMES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3163</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">attrs.classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._COLLECTION_CLASS_NAMES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3164</span> 
<span class='line'>3165</span> </span><span class="WHIT">    </span><span class="NAME">attrs.layout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.layoutForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3166</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">attrs.layout</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">attrs.layout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.View.prototype.layout</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3167</span> 
<span class='line'>3168</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3169</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3170</span> 
<span class='line'>3171</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3172</span>     A cache of the `contentGroupIndexes` value returned by the delegate.  This
<span class='line'>3173</span>     is frequently accessed and usually involves creating an `SC.IndexSet`
<span class='line'>3174</span>     object, so it's worthwhile to cache.
<span class='line'>3175</span>   */</span><span class="WHIT">
<span class='line'>3176</span> </span><span class="WHIT">  </span><span class="NAME">_contentGroupIndexes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3177</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentDelegate'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">contentGroupIndexes</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3178</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'contentDelegate'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3179</span> 
<span class='line'>3180</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3181</span>     Rather than calling contentIndexIsGroup on the delegate each time, first
<span class='line'>3182</span>     check if there are even any contentGroupIndexes.
<span class='line'>3183</span>   */</span><span class="WHIT">
<span class='line'>3184</span> </span><span class="WHIT">  </span><span class="NAME">_contentIndexIsGroup</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'_contentGroupIndexes'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3186</span> 
<span class='line'>3187</span> </span><span class="WHIT">    </span><span class="COMM">// If there are groupIndexes and the given index is within them, check</span><span class="WHIT">
<span class='line'>3188</span> </span><span class="WHIT">    </span><span class="COMM">// with the delegate.</span><span class="WHIT">
<span class='line'>3189</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">groupIndexes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">groupIndexes.contains</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3190</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3191</span> </span><span class="WHIT">        </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3192</span> 
<span class='line'>3193</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">del.contentIndexIsGroup</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3194</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3195</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3196</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3197</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3198</span> 
<span class='line'>3199</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3200</span>     Determines the example view for a content index.
<span class='line'>3201</span>   */</span><span class="WHIT">
<span class='line'>3202</span> </span><span class="WHIT">  </span><span class="NAME">_exampleViewForContentIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3203</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3204</span> </span><span class="WHIT">      </span><span class="NAME">ExampleView</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3205</span> </span><span class="WHIT">      </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3206</span> </span><span class="WHIT">      </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items.objectAt</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3207</span> 
<span class='line'>3208</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._contentIndexIsGroup</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3209</span> </span><span class="WHIT">      </span><span class="COMM">// so, if it is indeed a group view, we go that route to get the example view</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="WHIT">      </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentGroupExampleViewKey'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3211</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ExampleView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3212</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ExampleView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ExampleView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'groupExampleView'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'exampleView'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3213</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3214</span> </span><span class="WHIT">      </span><span class="COMM">// otherwise, we go through the normal example view</span><span class="WHIT">
<span class='line'>3215</span> </span><span class="WHIT">      </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentExampleViewKey'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3216</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ExampleView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3217</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ExampleView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ExampleView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'exampleView'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3218</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3219</span> 
<span class='line'>3220</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ExampleView</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3221</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3222</span> 
<span class='line'>3223</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3224</span>     Returns the pool for a given example view.
<span class='line'>3225</span> 
<span class='line'>3226</span>     The pool is calculated based on the guid for the example view class.
<span class='line'>3227</span> 
<span class='line'>3228</span>     @param {SC.View} exampleView
<span class='line'>3229</span>   */</span><span class="WHIT">
<span class='line'>3230</span> </span><span class="WHIT">  </span><span class="NAME">_poolForExampleView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exampleView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3231</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">poolKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.guidFor</span><span class="PUNC">(</span><span class="NAME">exampleView</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3232</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._pools</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._pools</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3233</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._pools</span><span class="PUNC">[</span><span class="NAME">poolKey</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._pools</span><span class="PUNC">[</span><span class="NAME">poolKey</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3234</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._pools</span><span class="PUNC">[</span><span class="NAME">poolKey</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3235</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3236</span> 
<span class='line'>3237</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3238</span>     Override to compute the hidden layout of the itemView for the content at the
<span class='line'>3239</span>     specified idnex.  This layout will be applied when it is moved to the
<span class='line'>3240</span>     pool for reuse and should be completely outside the visible portion
<span class='line'>3241</span>     of the collection.
<span class='line'>3242</span> 
<span class='line'>3243</span>     By default this layout is determined using the normal layout for the item.
<span class='line'>3244</span>     If the regular layout has a height, the pooled layout will be one height
<span class='line'>3245</span>     off the top (for top positioned) or off the bottom (for bottom positioned)
<span class='line'>3246</span>     and if the regular layout has a width, the pooled layout will be one
<span class='line'>3247</span>     width off the left (for left positioned) or off the right (for right
<span class='line'>3248</span>     positioned).
<span class='line'>3249</span> 
<span class='line'>3250</span>     @param Number contentIndex the index of the item in the content
<span class='line'>3251</span>     @returns Object a view layout
<span class='line'>3252</span>   */</span><span class="WHIT">
<span class='line'>3253</span> </span><span class="WHIT">  </span><span class="NAME">_poolLayoutForContentIndex</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3254</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.layoutForContentIndex</span><span class="PUNC">(</span><span class="NAME">contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3255</span> 
<span class='line'>3256</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layout</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">layout.height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3257</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layout.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">layout.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">layout.height</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3258</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">layout.bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">layout.height</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3259</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layout</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">layout.width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3260</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layout.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">layout.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">layout.width</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3261</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">layout.right</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">layout.width</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3263</span> </span><span class="WHIT">      </span><span class="COMM">// There is not really a valid layout for a collection.  Just shape it and</span><span class="WHIT">
<span class='line'>3264</span> </span><span class="WHIT">      </span><span class="COMM">// place it out of view.</span><span class="WHIT">
<span class='line'>3265</span> </span><span class="WHIT">      </span><span class="NAME">layout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3266</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3267</span> 
<span class='line'>3268</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">layout</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3269</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3270</span> 
<span class='line'>3271</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3272</span>     Configures an existing item view with new attributes.
<span class='line'>3273</span> 
<span class='line'>3274</span>     @param {SC.View} itemView
<span class='line'>3275</span>     @param {Hash} attrs
<span class='line'>3276</span>   */</span><span class="WHIT">
<span class='line'>3277</span> </span><span class="WHIT">  </span><span class="NAME">_reconfigureItemView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3278</span> </span><span class="WHIT">    </span><span class="NAME">itemView.beginPropertyChanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3279</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3280</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.contentIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3281</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isEnabled'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.isEnabled</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3282</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.isEditable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3283</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isReorderable'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.isReorderable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3284</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isDeletable'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.isDeletable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3285</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.isSelected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3286</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'layerId'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.layerId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3287</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'layout'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.layout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3288</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'outlineLevel'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.outlineLevel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3289</span> </span><span class="WHIT">    </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'disclosureState'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs.disclosureState</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3290</span> </span><span class="WHIT">    </span><span class="NAME">itemView.endPropertyChanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3291</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3292</span> 
<span class='line'>3293</span> </span><span class="WHIT">  </span><span class="COMM">/** @private
<span class='line'>3294</span>     Removes the item view, pooling it for re-use if possible.
<span class='line'>3295</span>   */</span><span class="WHIT">
<span class='line'>3296</span> </span><span class="WHIT">  </span><span class="NAME">_removeItemView</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3297</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">exampleView</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3298</span> </span><span class="WHIT">      </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3299</span> </span><span class="WHIT">      </span><span class="NAME">layout</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3300</span> </span><span class="WHIT">      </span><span class="NAME">pool</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3301</span> </span><span class="WHIT">      </span><span class="NAME">prototype</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3302</span> </span><span class="WHIT">      </span><span class="NAME">wasPooled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3303</span> 
<span class='line'>3304</span> </span><span class="WHIT">    </span><span class="COMM">// Don't pool views whose content has changed, because if the example</span><span class="WHIT">
<span class='line'>3305</span> </span><span class="WHIT">    </span><span class="COMM">// view used is different than the new content, we would pool the wrong</span><span class="WHIT">
<span class='line'>3306</span> </span><span class="WHIT">    </span><span class="COMM">// type of view.</span><span class="WHIT">
<span class='line'>3307</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">itemView.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">items.objectAt</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3308</span> 
<span class='line'>3309</span> </span><span class="WHIT">      </span><span class="NAME">exampleView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._exampleViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3310</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">exampleView.prototype.isReusable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">exampleView.prototype.isReusable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3311</span> </span><span class="WHIT">        </span><span class="COMM">// If the exampleView is reusable, send the view to its pool.</span><span class="WHIT">
<span class='line'>3312</span> </span><span class="WHIT">        </span><span class="NAME">pool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._poolForExampleView</span><span class="PUNC">(</span><span class="NAME">exampleView</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3313</span> 
<span class='line'>3314</span> </span><span class="WHIT">        </span><span class="COMM">//@if(debug)</span><span class="WHIT">
<span class='line'>3315</span> </span><span class="WHIT">        </span><span class="COMM">// Add a bit of developer support if they are migrating over from SC.CollectionFastPath</span><span class="WHIT">
<span class='line'>3316</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView.hibernateInPool</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3317</span> </span><span class="WHIT">          </span><span class="NAME">SC.error</span><span class="PUNC">(</span><span class="STRN">"Developer Error: Item views that want to do clean up before being pooled should implement sleepInPool not hibernateInPool.  This will be temporarily fixed up for development mode only, but must be changed before production."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3318</span> </span><span class="WHIT">          </span><span class="NAME">itemView.sleepInPool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemView.hibernateInPool</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3319</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3320</span> </span><span class="WHIT">        </span><span class="COMM">//@endif</span><span class="WHIT">
<span class='line'>3321</span> 
<span class='line'>3322</span> </span><span class="WHIT">        </span><span class="COMM">// Give the view a chance to do some clean up before sleeping.</span><span class="WHIT">
<span class='line'>3323</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemView.sleepInPool</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">itemView.sleepInPool</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3324</span> 
<span class='line'>3325</span> </span><span class="WHIT">        </span><span class="NAME">pool.push</span><span class="PUNC">(</span><span class="NAME">itemView</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3326</span> 
<span class='line'>3327</span> </span><span class="WHIT">        </span><span class="COMM">// If the exampleView's layer isn't reusable, destroy it.</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">        </span><span class="NAME">prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">exampleView.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3329</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">prototype.isLayerReusable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">prototype.isLayerReusable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3330</span> </span><span class="WHIT">          </span><span class="NAME">itemView.destroyLayer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3331</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3332</span> </span><span class="WHIT">          </span><span class="COMM">// If the layer is sticking around, be sure to move it out of view.</span><span class="WHIT">
<span class='line'>3333</span> </span><span class="WHIT">          </span><span class="NAME">layout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._poolLayoutForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3334</span> </span><span class="WHIT">          </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'layout'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">layout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3335</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3336</span> 
<span class='line'>3337</span> </span><span class="WHIT">        </span><span class="COMM">// Ensure that the id of views in the pool don't clash with ids that</span><span class="WHIT">
<span class='line'>3338</span> </span><span class="WHIT">        </span><span class="COMM">// are used outside of it.</span><span class="WHIT">
<span class='line'>3339</span> </span><span class="WHIT">        </span><span class="NAME">itemView.set</span><span class="PUNC">(</span><span class="STRN">'layerId'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.generateGuid</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'pool-'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3340</span> 
<span class='line'>3341</span> </span><span class="WHIT">        </span><span class="NAME">wasPooled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3343</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3344</span> 
<span class='line'>3345</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">wasPooled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3346</span> </span><span class="WHIT">      </span><span class="NAME">itemView.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3347</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3348</span> 
<span class='line'>3349</span> </span><span class="WHIT">    </span><span class="COMM">// Remove the cached view (can still exist in the pool)</span><span class="WHIT">
<span class='line'>3350</span> </span><span class="WHIT">    </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._sc_itemViews</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3351</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3352</span> 
<span class='line'>3353</span> 
<span class='line'>3354</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3355</span> </span></pre></body></html>